<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Data Analysis and Visualisation in R for Ecologists: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../site.webmanifest">
<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav data"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Data Carpentry" src="../assets/images/data-logo.svg">
</div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="../assets/images/data-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Data Analysis and Visualisation in R for Ecologists
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Data Analysis and Visualisation in R for Ecologists
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="reference.html">Learners' Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
<input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset>
</form>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Data Analysis and Visualisation in R for Ecologists
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->
      
            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Data Analysis and Visualization in R for Ecologists</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="00-before-we-start.html">1. Before we start</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="01-intro-to-r.html">2. Introduction to R</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="02-starting-with-data.html">3. Starting with data</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="03-dplyr.html">4. Manipulating, analyzing and exporting data with tidyverse</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="04-visualization-ggplot2.html">5. Data visualization with ggplot2</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="05-r-and-databases.html">6. SQL databases and R</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="reference.html">Learners' Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="../instructor/aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">
            
            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-00-before-we-start"><p>Content from <a href="00-before-we-start.html">Before we start</a></p>
<hr>
<p>Last updated on 2024-01-31 |
        
        <a href="https://github.com/datacarpentry/R-ecology-lesson/edit/main/episodes/00-before-we-start.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<hr>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is R and RStudio?</li>
<li>What is a working directory?</li>
<li>How should files be set up to import into R?</li>
<li>How can I look for help with R functions?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain what R and RStudio are, what they are used for, and how they
relate to each other.</li>
<li>Describe the purpose of the RStudio Script, Console, Environment,
and Plots panes.</li>
<li>Organize files and directories for a set of analyses as an R
Project, and understand the purpose of the working directory.</li>
<li>Use the built-in RStudio help interface to search for more
information on R functions.</li>
<li>Demonstrate how to provide sufficient information for
troubleshooting with the R user community.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<hr>
<section id="what-is-r-what-is-rstudio"><h2 class="section-heading">What is R? What is RStudio?<a class="anchor" aria-label="anchor" href="#what-is-r-what-is-rstudio"></a>
</h2>
<hr class="half-width">
<p>The term “<code>R</code>” is used to refer to both the programming
language and the software that interprets the scripts written using
it.</p>
<p><a href="https://rstudio.com" class="external-link">RStudio</a> is a popular way to write R
scripts and interact with the R software. To function correctly, RStudio
needs R and therefore both need to be installed on your computer.</p>
</section><section id="why-learn-r"><h2 class="section-heading">Why learn R?<a class="anchor" aria-label="anchor" href="#why-learn-r"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="r-does-not-involve-lots-of-pointing-and-clicking-and-thats-a-good-thing">R does not involve lots of pointing and clicking, and that’s a good
thing<a class="anchor" aria-label="anchor" href="#r-does-not-involve-lots-of-pointing-and-clicking-and-thats-a-good-thing"></a>
</h3>
<p>In R, the results of your analysis rely on a series of written
commands, and not on remembering a succession of pointing and clicking.
That is a good thing! So, if you want to redo your analysis because you
collected more data, you don’t have to remember which button you clicked
in which order to obtain your results. With a stored series of commands
in an R script, you can repeat running them and R will process the new
dataset exactly the same way as before.</p>
<p>Working with scripts makes the steps you used in your analysis clear,
and the code you write can be inspected by someone else who can give you
feedback and spot mistakes.</p>
<p>Working with scripts forces you to have a deeper understanding of
what you are doing, and facilitates your learning and comprehension of
the methods you use.</p>
</div>
<div class="section level3">
<h3 id="r-code-is-great-for-reproducibility">R code is great for reproducibility<a class="anchor" aria-label="anchor" href="#r-code-is-great-for-reproducibility"></a>
</h3>
<p>Reproducibility is when someone else, including your future self, can
obtain the same results from the same dataset when using the same
analysis.</p>
<p>R integrates with other tools to generate manuscripts from your code.
If you collect more data, or fix a mistake in your dataset, the figures
and the statistical tests in your manuscript are updated
automatically.</p>
<p>R is widely used in academia and in industries such as pharma and
biotech. These organisations expect analyses to be reproducible, so
knowing R will give you an edge with these requirements.</p>
</div>
<div class="section level3">
<h3 id="r-is-interdisciplinary-and-extensible">R is interdisciplinary and extensible<a class="anchor" aria-label="anchor" href="#r-is-interdisciplinary-and-extensible"></a>
</h3>
<p>With 10,000+ packages that can be installed to extend its
capabilities, R provides a framework that allows you to combine
statistical approaches from many scientific disciplines to best suit the
analytical framework you need to analyze your data. For instance, R has
packages for image analysis, GIS, time series, population genetics, and
a lot more.</p>
</div>
<div class="section level3">
<h3 id="r-works-on-data-of-all-shapes-and-sizes">R works on data of all shapes and sizes<a class="anchor" aria-label="anchor" href="#r-works-on-data-of-all-shapes-and-sizes"></a>
</h3>
<p>The skills you learn with R scale easily with the size of your
dataset. Whether your dataset has hundreds or millions of lines, it
won’t make much difference to you.</p>
<p>R is designed for data analysis. It comes with special data
structures and data types that make handling of missing data and
statistical factors convenient.</p>
<p>R can connect to spreadsheets, databases, and many other data
formats, on your computer or on the web.</p>
</div>
<div class="section level3">
<h3 id="r-produces-high-quality-graphics">R produces high-quality graphics<a class="anchor" aria-label="anchor" href="#r-produces-high-quality-graphics"></a>
</h3>
<p>The plotting functionalities in R are endless, and allow you to
adjust any aspect of your graph to visualize your data more
effectively.</p>
</div>
<div class="section level3">
<h3 id="r-has-a-large-and-welcoming-community">R has a large and welcoming community<a class="anchor" aria-label="anchor" href="#r-has-a-large-and-welcoming-community"></a>
</h3>
<p>Thousands of people use R daily. Many of them are willing to help you
through mailing lists and websites such as <a href="https://stackoverflow.com/" class="external-link">Stack Overflow</a>, <a href="https://community.rstudio.com/" class="external-link">RStudio community</a>, and Slack
channels such as the R for Data Science online community (<a href="https://www.rfordatasci.com/" class="external-link">https://www.rfordatasci.com/</a>).
In addition, there are numerous online and in person meetups organised
globally through organisations such as R Ladies Global (<a href="https://rladies.org/" class="external-link">https://rladies.org/</a>).</p>
</div>
<div class="section level3">
<h3 id="not-only-is-r-free-but-it-is-also-open-source-and-cross-platform">Not only is R free, but it is also open-source and
cross-platform<a class="anchor" aria-label="anchor" href="#not-only-is-r-free-but-it-is-also-open-source-and-cross-platform"></a>
</h3>
<p>Anyone can inspect the source code to see how R works. Because of
this transparency, there is less chance for mistakes, and if you (or
someone else) find some, you can report and fix bugs.</p>
</div>
</section><section id="knowing-your-way-around-rstudio"><h2 class="section-heading">Knowing your way around RStudio<a class="anchor" aria-label="anchor" href="#knowing-your-way-around-rstudio"></a>
</h2>
<hr class="half-width">
<p>Let’s start by learning about <a href="https://www.rstudio.com/" class="external-link">RStudio</a>, which is an Integrated
Development Environment (IDE) for working with R.</p>
<p>The RStudio IDE open-source product is free under the <a href="https://www.gnu.org/licenses/agpl-3.0.en.html" class="external-link">Affero General
Public License (AGPL) v3</a>. The RStudio IDE is also available with a
commercial license and priority email support from RStudio, PBC.</p>
<p>We will use RStudio IDE to write code, navigate the files on our
computer, inspect the variables we are going to create, and visualize
the plots we will generate. RStudio can also be used for other things
(e.g., version control, developing packages, writing Shiny apps) that we
will not cover during the workshop.</p>
<figure><img src="../fig/rstudio-screenshot.png" alt="RStudio interface screenshot. Clockwise from top left: Source,Environment/History, Files/Plots/Packages/Help/Viewer,Console." class="figure mx-auto d-block"></figure><p>RStudio is divided into 4 “panes”:</p>
<ul>
<li>The <strong>Source</strong> for your scripts and documents
(top-left, in the default layout)</li>
<li>Your <strong>Environment/History</strong> (top-right) which shows
all the objects in your working space (Environment) and your command
history (History)</li>
<li>Your <strong>Files/Plots/Packages/Help/Viewer</strong>
(bottom-right)</li>
<li>The R <strong>Console</strong> (bottom-left)</li>
</ul>
<p>The placement of these panes and their content can be customized (see
menu, Tools -&gt; Global Options -&gt; Pane Layout). For ease of use,
settings such as background color, font color, font size, and zoom level
can also be adjusted in this menu (Global Options -&gt; Appearance).</p>
<p>One of the advantages of using RStudio is that all the information
you need to write code is available in a single window. Additionally,
with many shortcuts, autocompletion, and highlighting for the major file
types you use while developing in R, RStudio will make typing easier and
less error-prone.</p>
</section><section id="getting-set-up"><h2 class="section-heading">Getting set up<a class="anchor" aria-label="anchor" href="#getting-set-up"></a>
</h2>
<hr class="half-width">
<p>It is good practice to keep a set of related data, analyses, and text
self-contained in a single folder, called the <strong>working
directory</strong>. All of the scripts within this folder can then use
<em>relative paths</em> to files that indicate where inside the project
a file is located (as opposed to absolute paths, which point to where a
file is on a specific computer). Working this way allows you to move
your project around on your computer and share it with others without
worrying about whether or not the underlying scripts will still
work.</p>
<p>RStudio provides a helpful set of tools to do this through its
“Projects” interface, which not only creates a working directory for
you, but also remembers its location (allowing you to quickly navigate
to it) and optionally preserves custom settings and (re-)open files to
assist resume work after a break. Go through the steps for creating an
“R Project” for this tutorial below.</p>
<ol style="list-style-type: decimal">
<li>Start RStudio.</li>
<li>Under the <code>File</code> menu, click on <code>New Project</code>.
Choose <code>New Directory</code>, then <code>New Project</code>.</li>
<li>Enter a name for this new folder (or “directory”), and choose a
convenient location for it. This will be your <strong>working
directory</strong> for the rest of the day (e.g.,
<code>~/data-carpentry</code>).</li>
<li>Click on <code>Create Project</code>.</li>
<li>Download the <a href="../files/code-handout.R">code handout</a>, place
it in your working directory and rename it (e.g.,
<code>data-carpentry-script.R</code>).</li>
<li>(Optional) Set Preferences to ‘Never’ save workspace in
RStudio.</li>
</ol>
<p>A workspace is your current working environment in R which includes
any user-defined object. By default, all of these objects will be saved,
and automatically loaded, when you reopen your project. Saving a
workspace to <code>.RData</code> can be cumbersome, especially if you
are working with larger datasets, and it can lead to hard to debug
errors by having objects in memory you forgot you had. Therefore, it is
often a good idea to turn this off. To do so, go to Tools –&gt; ‘Global
Options’ and select the ‘Never’ option for ‘Save workspace to .RData’ on
exit.’</p>
<figure><img src="../fig/rstudio-preferences.png" alt="Set 'Save workspace to .RData on exit' to'Never'" class="figure mx-auto d-block"></figure><div class="section level3">
<h3 id="organizing-your-working-directory">Organizing your working directory<a class="anchor" aria-label="anchor" href="#organizing-your-working-directory"></a>
</h3>
<p>Using a consistent folder structure across your projects will help
keep things organized, and will help you to find/file things in the
future. This can be especially helpful when you have multiple projects.
In general, you may create directories (folders) for
<strong>scripts</strong>, <strong>data</strong>, and
<strong>documents</strong>.</p>
<ul>
<li>
<strong><code>data_raw/</code> &amp; <code>data/</code></strong> Use
these folders to store raw data and intermediate datasets you may create
for the need of a particular analysis. For the sake of transparency and
<a href="https://en.wikipedia.org/wiki/Provenance" class="external-link">provenance</a>, you
should <em>always</em> keep a copy of your raw data accessible and do as
much of your data cleanup and preprocessing programmatically (i.e., with
scripts, rather than manually) as possible. Separating raw data from
processed data is also a good idea. For example, you could have files
<code>data_raw/tree_survey.plot1.txt</code> and
<code>...plot2.txt</code> kept separate from a
<code>data/tree.survey.csv</code> file generated by the
<code>scripts/01.preprocess.tree_survey.R</code> script.</li>
<li>
<strong><code>documents/</code></strong> This would be a place to
keep outlines, drafts, and other text.</li>
<li>
<strong><code>scripts/</code></strong> This would be the location to
keep your R scripts for different analyses or plotting, and potentially
a separate folder for your functions (more on that later).</li>
<li>
<strong>Additional (sub)directories</strong> depending on your
project needs.</li>
</ul>
<p>For this workshop, we will need a <code>data_raw/</code> folder to
store our raw data, and we will use <code>data/</code> for when we learn
how to export data as CSV files, and a <code>fig/</code> folder for the
figures that we will save.</p>
<ul>
<li>Under the <code>Files</code> tab on the right of the screen, click
on <code>New Folder</code> and create a folder named
<code>data_raw</code> within your newly created working directory (e.g.,
<code>~/data-carpentry/</code>). (Alternatively, type
<code>dir.create("data_raw")</code> at your R console.) Repeat these
operations to create a <code>data</code> and a <code>fig</code>
folder.</li>
</ul>
<p>We are going to keep the script in the root of our working directory
because we are only going to use one file. Later, when you start create
more complex projects, it might make sense to organize scripts in
sub-directories.</p>
<p>Your working directory should now look like this:</p>
<figure style="text-align: center"><img src="../fig/r-starting-how-it-should-look-like.png" alt="How it should look like at the beginning of this lesson" width="100%" class="figure mx-auto d-block"><figcaption>
How it should look like at the beginning of this lesson
</figcaption></figure>
</div>
<div class="section level3">
<h3 id="the-working-directory">The working directory<a class="anchor" aria-label="anchor" href="#the-working-directory"></a>
</h3>
<p>The working directory is an important concept to understand. It is
the place from where R will be looking for and saving the files. When
you write code for your project, it should refer to files in relation to
the root of your working directory and only need files within this
structure.</p>
<p>RStudio assists you in this regard and sets the working directory
automatically to the directory where you have placed your project in. If
you need to check it, you can use <code>getwd()</code>. If for some
reason your working directory is not what it should be, you can change
it in the RStudio interface by navigating in the file browser where your
working directory should be, and clicking on the blue gear icon “More”,
and select “Set As Working Directory”. Alternatively you can use
<code>setwd("/path/to/working/directory")</code> to reset your working
directory. However, your scripts should not include this line because it
will fail on someone else’s computer.</p>
</div>
</section><section id="interacting-with-r"><h2 class="section-heading">Interacting with R<a class="anchor" aria-label="anchor" href="#interacting-with-r"></a>
</h2>
<hr class="half-width">
<p>The basis of programming is that we write down instructions for the
computer to follow, and then we tell the computer to follow those
instructions. We write, or <em>code</em>, instructions in R because it
is a common language that both the computer and we can understand. We
call the instructions <em>commands</em> and we tell the computer to
follow the instructions by <em>executing</em> (also called
<em>running</em>) those commands.</p>
<p>There are two main ways of interacting with R: by using the console
or by using script files (plain text files that contain your code). The
console pane (in RStudio, the bottom left panel) is the place where
commands written in the R language can be typed and executed immediately
by the computer. It is also where the results will be shown for commands
that have been executed. You can type commands directly into the console
and press <code>Enter</code> to execute those commands, but they will be
forgotten when you close the session.</p>
<p>Because we want our code and workflow to be reproducible, it is
better to type the commands we want in the script editor, and save the
script. This way, there is a complete record of what we did, and anyone
(including our future selves!) can easily replicate the results on their
computer.</p>
<p>RStudio allows you to execute commands directly from the script
editor by using the <kbd>Ctrl</kbd> + <kbd>Enter</kbd> shortcut (on
Macs, <kbd>Cmd</kbd> + <kbd>Return</kbd> will work, too). The command on
the current line in the script (indicated by the cursor) or all of the
commands in the currently selected text will be sent to the console and
executed when you press <kbd>Ctrl</kbd> + <kbd>Enter</kbd>. You can find
other keyboard shortcuts in this <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/rstudio-ide.pdf" class="external-link">RStudio
cheatsheet about the RStudio IDE</a>.</p>
<p>At some point in your analysis you may want to check the content of a
variable or the structure of an object, without necessarily keeping a
record of it in your script. You can type these commands and execute
them directly in the console. RStudio provides the <kbd>Ctrl</kbd> +
<kbd>1</kbd> and <kbd>Ctrl</kbd> + <kbd>2</kbd> shortcuts allow you to
jump between the script and the console panes.</p>
<p>If R is ready to accept commands, the R console shows a
<code>&gt;</code> prompt. If it receives a command (by typing,
copy-pasting or sent from the script editor using <kbd>Ctrl</kbd> +
<kbd>Enter</kbd>), R will try to execute it, and when ready, will show
the results and come back with a new <code>&gt;</code> prompt to wait
for new commands.</p>
<p>If R is still waiting for you to enter more data because it isn’t
complete yet, the console will show a <code>+</code> prompt. It means
that you haven’t finished entering a complete command. This is because
you have not ‘closed’ a parenthesis or quotation, i.e. you don’t have
the same number of left-parentheses as right-parentheses, or the same
number of opening and closing quotation marks. When this happens, and
you thought you finished typing your command, click inside the console
window and press <kbd>Esc</kbd>; this will cancel the incomplete command
and return you to the <code>&gt;</code> prompt.</p>
</section><section id="seeking-help"><h2 class="section-heading">Seeking help<a class="anchor" aria-label="anchor" href="#seeking-help"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="searching-function-documentation-with-and">Searching function documentation with <code>?</code> and
<code>??</code>
<a class="anchor" aria-label="anchor" href="#searching-function-documentation-with-and"></a>
</h3>
<p>If you need help with a specific function, let’s say
<code>mean()</code>, you can type <code>?mean</code> or press
<kbd>F1</kbd> while your cursor is on the function name. If you are
looking for a function to do a particular task, but don’t know the
function name, you can use the double question mark <code>??</code>, for
example <code>??kruskall</code>. Both commands will open matching help
files in RStudio’s help panel in the lower right corner. You can also
use the help panel to search help directly, as seen in the
screenshot.</p>
<figure><img src="../fig/rstudiohelp.png" alt="RStudio help panel. When typing a word in the search field, it will showrelated suggestions." class="figure mx-auto d-block"></figure>
</div>
<div class="section level3">
<h3 id="automatic-code-completion">Automatic code completion<a class="anchor" aria-label="anchor" href="#automatic-code-completion"></a>
</h3>
<p>When you write code in RStudio, you can use its automatic code
completion to remind yourself of a function’s name or arguments. Start
typing the function name and pay attention to the suggestions that pop
up. Use the up and down arrow to select a suggested code completion and
<kbd>Tab</kbd> to apply it. You can also use code completion to complete
function’s argument names, object, names and file names. It even works
if you don’t get the spelling 100% correct.</p>
</div>
<div class="section level3">
<h3 id="package-vignettes-and-cheat-sheets">Package vignettes and cheat sheets<a class="anchor" aria-label="anchor" href="#package-vignettes-and-cheat-sheets"></a>
</h3>
<p>In addition to the documentation for individual functions, many
packages have <em>vignettes</em> – instructions for how to use the
package to do certain tasks. Vignettes are great for learning by
example. Vignettes are accessible via the package help and by using the
function <code>browseVignettes()</code>.</p>
<p>There is also a Help menu at the top of the RStudio window, that has
cheat sheets for popular packages, RStudio keyboard shortcuts, and
more.</p>
</div>
<div class="section level3">
<h3 id="finding-more-functions-and-packages">Finding more functions and packages<a class="anchor" aria-label="anchor" href="#finding-more-functions-and-packages"></a>
</h3>
<p>RStudio’s help only searches the packages that you have installed on
your machine, but there are many more available on <a href="https://cran.r-project.org/" class="external-link">CRAN</a> and <a href="https://github.com/" class="external-link">GitHub</a>. To search across all available R
packages, you can use the website <a href="https://www.rdocumentation.org" class="external-link">rdocumentation.org</a>. Often, a
generic Google or internet search “R &lt;task&gt;” will send you to the
appropriate package documentation or a forum where someone else has
already asked your question. Many packages also have websites with
additional help, tutorials, news and more (for example <a href="https://www.tidyverse.org/" class="external-link">tidyverse.org</a>).</p>
</div>
<div class="section level3">
<h3 id="dealing-with-error-messages">Dealing with error messages<a class="anchor" aria-label="anchor" href="#dealing-with-error-messages"></a>
</h3>
<p>Don’t get discouraged if your code doesn’t run immediately! Error
messages are common when programming, and fixing errors is part of any
programmer’s daily work. Often, the problem is a small typo in a
variable name or a missing parenthesis. Watch for the red x’s next to
your code in RStudio. These may provide helpful hints about the source
of the problem.</p>
<figure><img src="../fig/rstudioredx.png" alt="RStudio shows a red x next to a line of code that R doesn't understand." class="figure mx-auto d-block"></figure><p>If you can’t fix an error yourself, start by googling it. Some error
messages are too generic to diagnose a problem (e.g. “subscript out of
bounds”). In that case it might help to include the name of the function
or package you’re using in your query.</p>
</div>
<div class="section level3">
<h3 id="asking-for-help">Asking for help<a class="anchor" aria-label="anchor" href="#asking-for-help"></a>
</h3>
<p>If your Google search is unsuccessful, you may want to ask other R
users for help. There are different places where you can ask for help.
During this workshop, don’t hesitate to talk to your neighbor, compare
your answers, and ask for help. You might also be interested in
organizing regular meetings following the workshop to keep learning from
each other. If you have a friend or colleague with more experience than
you, they might also be able and willing to help you.</p>
<p>Besides that, there are a few places on the internet that provide
help:</p>
<ul>
<li>
<a href="https://stackoverflow.com/questions/tagged/r?tab=Votes" class="external-link">Stack
Overflow</a>: Many questions have already been answered, but the
challenge is to use the right words in your search to find them. If your
question hasn’t been answered before and is well crafted, chances are
you will get an answer in less than 5 min. Remember to follow their
guidelines on <a href="https://stackoverflow.com/help/how-to-ask" class="external-link">how to
ask a good question</a>.</li>
<li>The <a href="https://stat.ethz.ch/mailman/listinfo/r-help" class="external-link">R-help
mailing list</a>: it is used by a lot of people (including most of the R
core team). If your question is valid (read its <a href="https://www.r-project.org/posting-guide.html" class="external-link">Posting Guide</a>),
you are likely to get an answer very fast, but the tone can be pretty
dry and it is not always very welcoming to new users.</li>
<li>If your question is about a specific package rather than a base R
function, see if there is a mailing list for the package. Usually it’s
included in the DESCRIPTION file of the package that can be accessed
using <code>packageDescription("&lt;package-name&gt;")</code>.</li>
<li>You can also try to contact the package author directly, by emailing
them or opening an issue on the code repository (e.g., on GitHub).</li>
<li>There are also some topic-specific mailing lists (GIS,
phylogenetics, etc…). The complete list is <a href="https://www.r-project.org/mail.html" class="external-link">on the R mailing lists
website</a>.</li>
</ul>
<p>The key to receiving help from someone is for them to rapidly grasp
your problem. Thus, you should be as precise as possible when describing
your problem and help others to pinpoint where the issue might be. Try
to…</p>
<ul>
<li><p>Use the correct words to describe your problem. Otherwise you
might get an answer pointing to the misuse of your words rather than
answering your question.</p></li>
<li><p>Generalize what you are trying to do, so people outside your
field can understand the question.</p></li>
<li><p>Reduce what does not work to a simple <em>reproducible
example</em>. For instance, instead of using your real data set, create
a small generic one. For more information on how to write a reproducible
example see <a href="https://reprex.tidyverse.org/articles/reprex-dos-and-donts.html" class="external-link">this
article from the reprex package</a>. Learning how to use the <a href="https://cran.r-project.org/package=reprex" class="external-link">reprex</a> package is
also very helpful for this.</p></li>
<li><p>Include the output of <code>sessionInfo()</code> in your
question. It provides information about your platform, the versions of R
and the packages that you are using. As an example, here you can see the
versions of R and all the packages that we are using to run the code in
this lesson:</p></li>
</ul>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessionInfo</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; R version 4.3.2 (2023-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.0 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] RSQLite_2.3.4   lubridate_1.9.3 forcats_1.0.0   stringr_1.5.1  </span></span>
<span><span class="co">#&gt;  [5] dplyr_1.1.4     purrr_1.0.2     readr_2.1.4     tidyr_1.3.0    </span></span>
<span><span class="co">#&gt;  [9] tibble_3.2.1    ggplot2_3.4.4   tidyverse_2.0.0 knitr_1.45     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] bit_4.0.5        gtable_0.3.4     compiler_4.3.2   renv_1.0.3      </span></span>
<span><span class="co">#&gt;  [5] highr_0.10       tidyselect_1.2.0 blob_1.2.4       scales_1.3.0    </span></span>
<span><span class="co">#&gt;  [9] fastmap_1.1.1    yaml_2.3.8       R6_2.5.1         generics_0.1.3  </span></span>
<span><span class="co">#&gt; [13] munsell_0.5.0    DBI_1.2.0        pillar_1.9.0     tzdb_0.4.0      </span></span>
<span><span class="co">#&gt; [17] rlang_1.1.2      utf8_1.2.4       cachem_1.0.8     stringi_1.8.3   </span></span>
<span><span class="co">#&gt; [21] xfun_0.41        bit64_4.0.5      memoise_2.0.1    timechange_0.2.0</span></span>
<span><span class="co">#&gt; [25] cli_3.6.2        withr_2.5.2      magrittr_2.0.3   grid_4.3.2      </span></span>
<span><span class="co">#&gt; [29] hms_1.1.3        lifecycle_1.0.4  vctrs_0.6.5      evaluate_0.23   </span></span>
<span><span class="co">#&gt; [33] glue_1.6.2       fansi_1.0.6      colorspace_2.1-0 tools_4.3.2     </span></span>
<span><span class="co">#&gt; [37] pkgconfig_2.0.3</span></span></code></pre>
</div>
</div>
</section><section id="how-to-learn-more-after-the-workshop"><h2 class="section-heading">How to learn more after the workshop?<a class="anchor" aria-label="anchor" href="#how-to-learn-more-after-the-workshop"></a>
</h2>
<hr class="half-width">
<p>The material we cover during this workshop will give you a taste of
how you can use R to analyze data for your own research. However, to do
advanced operations such as cleaning your dataset, using statistical
methods, or creating beautiful graphics you will need to learn more.</p>
<p>The best way to become proficient and efficient at R, as with any
other tool, is to use it to address your actual research questions. As a
beginner, it can feel daunting to have to write a script from scratch,
and given that many people make their code available online, modifying
existing code to suit your purpose might get first hands-on experience
using R for your own work and help you become comfortable eventually
creating your own scripts.</p>
<figure><img src="../fig/kitten-try-things.jpg" width="400px" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="more-resources"><h2 class="section-heading">More resources<a class="anchor" aria-label="anchor" href="#more-resources"></a>
</h2>
<hr class="half-width">
<div class="section level4">
<h4 id="more-about-r">More about R<a class="anchor" aria-label="anchor" href="#more-about-r"></a>
</h4>
<ul>
<li>The <a href="https://cran.r-project.org/doc/manuals/R-intro.pdf" class="external-link">Introduction
to R</a> can also be dense for people with little programming experience
but it is a good place to understand the underpinnings of the R
language.</li>
<li>The <a href="https://cran.r-project.org/doc/FAQ/R-FAQ.html" class="external-link">R
FAQ</a> is dense and technical but it is full of useful
information.</li>
<li>To stay up to date, follow <code>#rstats</code> on twitter. Twitter
can also be a way to get questions answered and learn about useful R
packages and tipps (e.g., <span class="citation">[@RLangTips]</span>)</li>
</ul>
</div>
<div class="section level4">
<h4 id="how-to-ask-good-programming-questions">How to ask good programming questions?<a class="anchor" aria-label="anchor" href="#how-to-ask-good-programming-questions"></a>
</h4>
<ul>
<li>The rOpenSci community call “How to ask questions so they get
answered”, (<a href="https://ropensci.org/commcalls/2017-03-07/" class="external-link">rOpenSci site</a> and
<a href="https://vimeo.com/208749032" class="external-link">video recording</a>) includes a
presentation of the reprex package and of its philosophy.</li>
<li>
<a href="https://blog.revolutionanalytics.com/2014/01/how-to-ask-for-r-help.html" class="external-link">blog.Revolutionanalytics.com</a>
and <a href="https://codeblog.jonskeet.uk/2010/08/29/writing-the-perfect-question/" class="external-link">this
blog post by Jon Skeet</a> have comprehensive advice on how to ask
programming questions.</li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>R is a programming language and RStudio is the IDE that assists in
using R.</li>
<li>There are many benefits to learning R, including writing
reproducibile code, ability to use a variety of datasets, and a broad,
open-source community of practioners.</li>
<li>Files related to analysis should be organized within a single
working directory.</li>
<li>R uses commands containing functions to tell the computer what to
do.</li>
<li>Documentation for each function is available within RStudio, or
users can ask for help from one of many online forums, cheatsheets, or
email lists.</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-01-intro-to-r"><p>Content from <a href="01-intro-to-r.html">Introduction to R</a></p>
<hr>
<p>Last updated on 2024-01-31 |
        
        <a href="https://github.com/datacarpentry/R-ecology-lesson/edit/main/episodes/01-intro-to-r.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<hr>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you create objects in R?</li>
<li>How do you save R code for later use?</li>
<li>How do you manipulate data in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Define the following terms as they relate to R: object, assign,
call, function, arguments, options.</li>
<li>Create objects and assign values to them in R.</li>
<li>Learn how to <em>name</em> objects.</li>
<li>Save a script file for later use.</li>
<li>Use comments to inform script.</li>
<li>Solve simple arithmetic operations in R.</li>
<li>Call functions and use arguments to change their default
options.</li>
<li>Inspect the content of vectors and manipulate their content.</li>
<li>Subset and extract values from vectors.</li>
<li>Analyze vectors with missing data.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<hr>
<section id="creating-objects-in-r"><h2 class="section-heading">Creating objects in R<a class="anchor" aria-label="anchor" href="#creating-objects-in-r"></a>
</h2>
<hr class="half-width">
<p>You can get output from R simply by typing math in the console:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">3</span> <span class="op">+</span> <span class="fl">5</span></span>
<span><span class="fl">12</span> <span class="op">/</span> <span class="fl">7</span></span></code></pre>
</div>
<p>However, to do useful and interesting things, we need to assign
<em>values</em> to <em>objects</em>. To create an object, we need to
give it a name followed by the assignment operator <code>&lt;-</code>,
and the value we want to give it:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_kg</span> <span class="op">&lt;-</span> <span class="fl">55</span></span></code></pre>
</div>
<p><code>&lt;-</code> is the assignment operator we will use in this
course. It assigns values on the right to objects on the left. So, after
executing <code>x &lt;- 3</code>, the value of <code>x</code> is
<code>3</code>. For historical reasons, you can also use <code>=</code>
for assignments, but not in every context. Because of the <a href="https://blog.revolutionanalytics.com/2008/12/use-equals-or-arrow-for-assignment.html" class="external-link">slight</a>
<a href="https://renkun.me/2014/01/28/difference-between-assignment-operators-in-r/" class="external-link">differences</a>
in syntax, it is good practice to always use <code>&lt;-</code> for
assignments.</p>
<p>In RStudio, typing <kbd>Alt</kbd> + <kbd>-</kbd> (push <kbd>Alt</kbd>
at the same time as the <kbd>-</kbd> key) will write <code>&lt;-</code>
in a single keystroke in a PC, while typing <kbd>Option</kbd> +
<kbd>-</kbd> (push <kbd>Option</kbd> at the same time as the
<kbd>-</kbd> key) does the same in a Mac.</p>
<p>Objects can be given almost any name such as <code>x</code>,
<code>current_temperature</code>, or <code>subject_id</code>. Here are
some further guidelines on naming objects:</p>
<ul>
<li>You want your object names to be explicit and not too long.</li>
<li>They cannot start with a number (<code>2x</code> is not valid, but
<code>x2</code> is).</li>
<li>R is case sensitive, so for example, <code>weight_kg</code> is
different from <code>Weight_kg</code>.</li>
<li>There are some names that cannot be used because they are the names
of fundamental functions in R (e.g., <code>if</code>, <code>else</code>,
<code>for</code>, see <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Reserved.html" class="external-link">here</a>
for a complete list). In general, even if it’s allowed, it’s best to not
use other function names (e.g., <code>c</code>, <code>T</code>,
<code>mean</code>, <code>data</code>, <code>df</code>,
<code>weights</code>). If in doubt, check the help to see if the name is
already in use.</li>
<li>It’s best to avoid dots (<code>.</code>) within names. Many function
names in R itself have them and dots also have a special meaning
(methods) in R and other programming languages. To avoid confusion,
don’t include dots in names.</li>
<li>It is recommended to use nouns for object names and verbs for
function names.</li>
<li>Be consistent in the styling of your code, such as where you put
spaces, how you name objects, etc. Styles can include “lower_snake”,
“UPPER_SNAKE”, “lowerCamelCase”, “UpperCamelCase”, etc. Using a
consistent coding style makes your code clearer to read for your future
self and your collaborators. In R, three popular style guides come from
<a href="https://google.github.io/styleguide/Rguide.xml" class="external-link">Google</a>, <a href="https://jef.works/R-style-guide/" class="external-link">Jean Fan</a> and the <a href="https://style.tidyverse.org/" class="external-link">tidyverse</a>. The tidyverse style
is very comprehensive and may seem overwhelming at first. You can
install the <a href="https://github.com/jimhester/lintr" class="external-link"><strong><code>lintr</code></strong></a>
package to automatically check for issues in the styling of your
code.</li>
</ul>
<div id="objects-vs.-variables" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="objects-vs.-variables" class="callout-inner">
<h3 class="callout-title">Objects vs. variables<a class="anchor" aria-label="anchor" href="#objects-vs.-variables"></a>
</h3>
<div class="callout-content">
<p>What are known as <code>objects</code> in <code>R</code> are known as
<code>variables</code> in many other programming languages. Depending on
the context, <code>object</code> and <code>variable</code> can have
drastically different meanings. However, in this lesson, the two words
are used synonymously. For more information see: <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Objects" class="external-link">https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Objects</a></p>
</div>
</div>
</div>
<p>When assigning a value to an object, R does not print anything. You
can force R to print the value by using parentheses or by typing the
object name:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_kg</span> <span class="op">&lt;-</span> <span class="fl">55</span>    <span class="co"># doesn't print anything</span></span>
<span><span class="op">(</span><span class="va">weight_kg</span> <span class="op">&lt;-</span> <span class="fl">55</span><span class="op">)</span>  <span class="co"># but putting parenthesis around the call prints the value of `weight_kg`</span></span>
<span><span class="va">weight_kg</span>          <span class="co"># and so does typing the name of the object</span></span></code></pre>
</div>
<p>Now that R has <code>weight_kg</code> in memory, we can do arithmetic
with it. For instance, we may want to convert this weight into pounds
(weight in pounds is 2.2 times the weight in kg):</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">2.2</span> <span class="op">*</span> <span class="va">weight_kg</span></span></code></pre>
</div>
<p>We can also change an object’s value by assigning it a new one:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_kg</span> <span class="op">&lt;-</span> <span class="fl">57.5</span></span>
<span><span class="fl">2.2</span> <span class="op">*</span> <span class="va">weight_kg</span></span></code></pre>
</div>
<p>This means that assigning a value to one object does not change the
values of other objects. For example, let’s store the animal’s weight in
pounds in a new object, <code>weight_lb</code>:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_lb</span> <span class="op">&lt;-</span> <span class="fl">2.2</span> <span class="op">*</span> <span class="va">weight_kg</span></span></code></pre>
</div>
<p>and then change <code>weight_kg</code> to 100.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_kg</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></code></pre>
</div>
<p>What do you think is the current content of the object
<code>weight_lb</code>? 126.5 or 220?</p>
<div class="section level3">
<h3 id="saving-your-code">Saving your code<a class="anchor" aria-label="anchor" href="#saving-your-code"></a>
</h3>
<p>Up to now, your code has been in the console. This is useful for
quick queries but not so helpful if you want to revisit your work for
any reason. A script can be opened by pressing <kbd>Ctrl</kbd> +
<kbd>Shift</kbd> + <kbd>N</kbd>. It is wise to save your script file
immediately. To do this press <kbd>Ctrl</kbd> + <kbd>S</kbd>. This will
open a dialogue box where you can decide where to save your script file,
and what to name it. The <code>.R</code> file extension is added
automatically and ensures your file will open with RStudio.</p>
<p>Don’t forget to save your work periodically by pressing
<kbd>Ctrl</kbd> + <kbd>S</kbd>.</p>
</div>
<div class="section level3">
<h3 id="comments">Comments<a class="anchor" aria-label="anchor" href="#comments"></a>
</h3>
<p>The comment character in R is <code>#</code>. Anything to the right
of a <code>#</code> in a script will be ignored by R. It is useful to
leave notes and explanations in your scripts. For convenience, RStudio
provides a keyboard shortcut to comment or uncomment a paragraph: after
selecting the lines you want to comment, press at the same time on your
keyboard <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>C</kbd>. If you only
want to comment out one line, you can put the cursor at any location of
that line (i.e. no need to select the whole line), then press
<kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>C</kbd>.</p>
<div id="challenge" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge"></a>
</h3>
<div class="callout-content">
<p>What are the values after each statement in the following?</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="fl">47.5</span>            <span class="co"># mass?</span></span>
<span><span class="va">age</span>  <span class="op">&lt;-</span> <span class="fl">122</span>             <span class="co"># age?</span></span>
<span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="va">mass</span> <span class="op">*</span> <span class="fl">2.0</span>      <span class="co"># mass?</span></span>
<span><span class="va">age</span>  <span class="op">&lt;-</span> <span class="va">age</span> <span class="op">-</span> <span class="fl">20</span>        <span class="co"># age?</span></span>
<span><span class="va">mass_index</span> <span class="op">&lt;-</span> <span class="va">mass</span><span class="op">/</span><span class="va">age</span>  <span class="co"># mass_index?</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="functions-and-their-arguments">Functions and their arguments<a class="anchor" aria-label="anchor" href="#functions-and-their-arguments"></a>
</h3>
<p>Functions are “canned scripts” that automate more complicated sets of
commands including operations assignments, etc. Many functions are
predefined, or can be made available by importing R <em>packages</em>
(more on that later). A function usually takes one or more inputs called
<em>arguments</em>. Functions often (but not always) return a
<em>value</em>. A typical example would be the function
<code>sqrt()</code>. The input (the argument) must be a number, and the
return value (in fact, the output) is the square root of that number.
Executing a function (‘running it’) is called <em>calling</em> the
function. An example of a function call is:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_kg</span> <span class="op">&lt;-</span> <span class="fu">sqrt</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<p>Here, the value of 10 is given to the <code>sqrt()</code> function,
the <code>sqrt()</code> function calculates the square root, and returns
the value which is then assigned to the object <code>weight_kg</code>.
This function takes one argument, other functions might take
several.</p>
<p>The return ‘value’ of a function need not be numerical (like that of
<code>sqrt()</code>), and it also does not need to be a single item: it
can be a set of things, or even a dataset. We’ll see that when we read
data files into R.</p>
<p>Arguments can be anything, not only numbers or filenames, but also
other objects. Exactly what each argument means differs per function,
and must be looked up in the documentation (see below). Some functions
take arguments which may either be specified by the user, or, if left
out, take on a <em>default</em> value: these are called
<em>options</em>. Options are typically used to alter the way the
function operates, such as whether it ignores ‘bad values’, or what
symbol to use in a plot. However, if you want something specific, you
can specify a value of your choice which will be used instead of the
default.</p>
<p>Let’s try a function that can take multiple arguments:
<code>round()</code>.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">round</span><span class="op">(</span><span class="fl">3.14159</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] 3</span></span></code></pre>
</div>
<p>Here, we’ve called <code>round()</code> with just one argument,
<code>3.14159</code>, and it has returned the value <code>3</code>.
That’s because the default is to round to the nearest whole number. If
we want more digits we can see how to do that by getting information
about the <code>round</code> function. We can use
<code>args(round)</code> to find what arguments it takes, or look at the
help for this function using <code>?round</code>.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">args</span><span class="op">(</span><span class="va">round</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; function (x, digits = 0) </span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">round</span></span></code></pre>
</div>
<p>We see that if we want a different number of digits, we can type
<code>digits = 2</code> or however many we want.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">round</span><span class="op">(</span><span class="fl">3.14159</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] 3.14</span></span></code></pre>
</div>
<p>If you provide the arguments in the exact same order as they are
defined you don’t have to name them:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">round</span><span class="op">(</span><span class="fl">3.14159</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] 3.14</span></span></code></pre>
</div>
<p>And if you do name the arguments, you can switch their order:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">round</span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span>, x <span class="op">=</span> <span class="fl">3.14159</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] 3.14</span></span></code></pre>
</div>
<p>It’s good practice to put the non-optional arguments (like the number
you’re rounding) first in your function call, and to then specify the
names of all optional arguments. If you don’t, someone reading your code
might have to look up the definition of a function with unfamiliar
arguments to understand what you’re doing.</p>
</div>
</section><section id="vectors-and-data-types"><h2 class="section-heading">Vectors and data types<a class="anchor" aria-label="anchor" href="#vectors-and-data-types"></a>
</h2>
<hr class="half-width">
<p>A vector is the most common and basic data type in R, and is pretty
much the workhorse of R. A vector is composed by a series of values,
which can be either numbers or characters. We can assign a series of
values to a vector using the <code>c()</code> function. For example we
can create a vector of animal weights and assign it to a new object
<code>weight_g</code>:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_g</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">50</span>, <span class="fl">60</span>, <span class="fl">65</span>, <span class="fl">82</span><span class="op">)</span></span>
<span><span class="va">weight_g</span></span></code></pre>
</div>
<p>A vector can also contain characters:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">animals</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"mouse"</span>, <span class="st">"rat"</span>, <span class="st">"dog"</span><span class="op">)</span></span>
<span><span class="va">animals</span></span></code></pre>
</div>
<p>The quotes around “mouse”, “rat”, etc. are essential here. Without
the quotes R will assume objects have been created called
<code>mouse</code>, <code>rat</code> and <code>dog</code>. As these
objects don’t exist in R’s memory, there will be an error message.</p>
<p>There are many functions that allow you to inspect the content of a
vector. <code>length()</code> tells you how many elements are in a
particular vector:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">length</span><span class="op">(</span><span class="va">weight_g</span><span class="op">)</span></span>
<span><span class="fu">length</span><span class="op">(</span><span class="va">animals</span><span class="op">)</span></span></code></pre>
</div>
<p>An important feature of a vector, is that all of the elements are the
same type of data. The function <code>class()</code> indicates what kind
of object you are working with:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">weight_g</span><span class="op">)</span></span>
<span><span class="fu">class</span><span class="op">(</span><span class="va">animals</span><span class="op">)</span></span></code></pre>
</div>
<p>The function <code>str()</code> provides an overview of the structure
of an object and its elements. It is a useful function when working with
large and complex objects:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">weight_g</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">animals</span><span class="op">)</span></span></code></pre>
</div>
<p>You can use the <code>c()</code> function to add other elements to
your vector:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_g</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">weight_g</span>, <span class="fl">90</span><span class="op">)</span> <span class="co"># add to the end of the vector</span></span>
<span><span class="va">weight_g</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">30</span>, <span class="va">weight_g</span><span class="op">)</span> <span class="co"># add to the beginning of the vector</span></span>
<span><span class="va">weight_g</span></span></code></pre>
</div>
<p>In the first line, we take the original vector <code>weight_g</code>,
add the value <code>90</code> to the end of it, and save the result back
into <code>weight_g</code>. Then we add the value <code>30</code> to the
beginning, again saving the result back into <code>weight_g</code>.</p>
<p>We can do this over and over again to grow a vector, or assemble a
dataset. As we program, this may be useful to add results that we are
collecting or calculating.</p>
<p>An <strong>atomic vector</strong> is the simplest R <strong>data
type</strong> and is a linear vector of a single type. Above, we saw 2
of the 6 main <strong>atomic vector</strong> types that R uses:
<code>"character"</code> and <code>"numeric"</code> (or
<code>"double"</code>). These are the basic building blocks that all R
objects are built from. The other 4 <strong>atomic vector</strong> types
are:</p>
<ul>
<li>
<code>"logical"</code> for <code>TRUE</code> and <code>FALSE</code>
(the boolean data type)</li>
<li>
<code>"integer"</code> for integer numbers (e.g., <code>2L</code>,
the <code>L</code> indicates to R that it’s an integer)</li>
<li>
<code>"complex"</code> to represent complex numbers with real and
imaginary parts (e.g., <code>1 + 4i</code>) and that’s all we’re going
to say about them</li>
<li>
<code>"raw"</code> for bitstreams that we won’t discuss further</li>
</ul>
<p>You can check the type of your vector using the <code>typeof()</code>
function and inputting your vector as the argument.</p>
<p>Vectors are one of the many <strong>data structures</strong> that R
uses. Other important ones are lists (<code>list</code>), matrices
(<code>matrix</code>), data frames (<code>data.frame</code>), factors
(<code>factor</code>) and arrays (<code>array</code>).</p>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<ul>
<li>We’ve seen that atomic vectors can be of type character, numeric (or
double), integer, and logical. But what happens if we try to mix these
types in a single vector?</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>R implicitly converts them to all be the same type</p>
</div>
</div>
</div>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge<em>(continued)</em><a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<ul>
<li>
<p>What will happen in each of these examples? (hint: use
<code>class()</code> to check the data type of your objects):</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">num_char</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="st">"a"</span><span class="op">)</span></span>
<span><span class="va">num_logical</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">char_logical</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">tricky</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="st">"4"</span><span class="op">)</span></span></code></pre>
</div>
</li>
<li><p>Why do you think it happens?</p></li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Vectors can be of only one data type. R tries to convert (coerce) the
content of this vector to find a “common denominator” that doesn’t lose
any information.</p>
</div>
</div>
</div>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge<em>(continued)</em><a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<ul>
<li>
<p>How many values in <code>combined_logical</code> are
<code>"TRUE"</code> (as a character) in the following example (reusing
the 2 <code>..._logical</code>s from above):</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined_logical</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">num_logical</span>, <span class="va">char_logical</span><span class="op">)</span></span></code></pre>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>Only one. There is no memory of past data types, and the coercion
happens the first time the vector is evaluated. Therefore, the
<code>TRUE</code> in <code>num_logical</code> gets converted into a
<code>1</code> before it gets converted into <code>"1"</code> in
<code>combined_logical</code>.</p>
</div>
</div>
</div>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge<em>(continued)</em><a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<ul>
<li>You’ve probably noticed that objects of different types get
converted into a single, shared type within a vector. In R, we call
converting objects from one class into another class <em>coercion</em>.
These conversions happen according to a hierarchy, whereby some types
get preferentially coerced into other types. Can you draw a diagram that
represents the hierarchy of how these data types are coerced?</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>logical → numeric → character ← logical</p>
</div>
</div>
</div>
</div>
</section><section id="subsetting-vectors"><h2 class="section-heading">Subsetting vectors<a class="anchor" aria-label="anchor" href="#subsetting-vectors"></a>
</h2>
<hr class="half-width">
<p>If we want to extract one or several values from a vector, we must
provide one or several indices in square brackets. For instance:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">animals</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"mouse"</span>, <span class="st">"rat"</span>, <span class="st">"dog"</span>, <span class="st">"cat"</span><span class="op">)</span></span>
<span><span class="va">animals</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] "rat"</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">animals</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] "dog" "rat"</span></span></code></pre>
</div>
<p>We can also repeat the indices to create an object with more elements
than the original one:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">more_animals</span> <span class="op">&lt;-</span> <span class="va">animals</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">more_animals</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] "mouse" "rat"   "dog"   "rat"   "mouse" "cat"</span></span></code></pre>
</div>
<p>R indices start at 1. Programming languages like Fortran, MATLAB,
Julia, and R start counting at 1, because that’s what human beings
typically do. Languages in the C family (including C++, Java, Perl, and
Python) count from 0 because that’s simpler for computers to do.</p>
<div class="section level3">
<h3 id="conditional-subsetting">Conditional subsetting<a class="anchor" aria-label="anchor" href="#conditional-subsetting"></a>
</h3>
<p>Another common way of subsetting is by using a logical vector.
<code>TRUE</code> will select the element with the same index, while
<code>FALSE</code> will not:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_g</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">21</span>, <span class="fl">34</span>, <span class="fl">39</span>, <span class="fl">54</span>, <span class="fl">55</span><span class="op">)</span></span>
<span><span class="va">weight_g</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] 21 54 55</span></span></code></pre>
</div>
<p>Typically, these logical vectors are not typed by hand, but are the
output of other functions or logical tests. For instance, if you wanted
to select only the values above 50:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_g</span> <span class="op">&gt;</span> <span class="fl">50</span>    <span class="co"># will return logicals with TRUE for the indices that meet the condition</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] FALSE FALSE FALSE  TRUE  TRUE</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## so we can use this to select only the values above 50</span></span>
<span><span class="va">weight_g</span><span class="op">[</span><span class="va">weight_g</span> <span class="op">&gt;</span> <span class="fl">50</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] 54 55</span></span></code></pre>
</div>
<p>You can combine multiple tests using <code>&amp;</code> (both
conditions are true, AND) or <code>|</code> (at least one of the
conditions is true, OR):</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_g</span><span class="op">[</span><span class="va">weight_g</span> <span class="op">&gt;</span> <span class="fl">30</span> <span class="op">&amp;</span> <span class="va">weight_g</span> <span class="op">&lt;</span> <span class="fl">50</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] 34 39</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_g</span><span class="op">[</span><span class="va">weight_g</span> <span class="op">&lt;=</span> <span class="fl">30</span> <span class="op">|</span> <span class="va">weight_g</span> <span class="op">==</span> <span class="fl">55</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] 21 55</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_g</span><span class="op">[</span><span class="va">weight_g</span> <span class="op">&gt;=</span> <span class="fl">30</span> <span class="op">&amp;</span> <span class="va">weight_g</span> <span class="op">==</span> <span class="fl">21</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; numeric(0)</span></span></code></pre>
</div>
<p>Here, <code>&gt;</code> for “greater than”, <code>&lt;</code> stands
for “less than”, <code>&lt;=</code> for “less than or equal to”, and
<code>==</code> for “equal to”. The double equal sign <code>==</code> is
a test for numerical equality between the left and right hand sides, and
should not be confused with the single <code>=</code> sign, which
performs variable assignment (similar to <code>&lt;-</code>).</p>
<p>A common task is to search for certain strings in a vector. One could
use the “or” operator <code>|</code> to test for equality to multiple
values, but this can quickly become tedious. The function
<code>%in%</code> allows you to test if any of the elements of a search
vector are found:</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">animals</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"mouse"</span>, <span class="st">"rat"</span>, <span class="st">"dog"</span>, <span class="st">"cat"</span>, <span class="st">"cat"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># return both rat and cat</span></span>
<span><span class="va">animals</span><span class="op">[</span><span class="va">animals</span> <span class="op">==</span> <span class="st">"cat"</span> <span class="op">|</span> <span class="va">animals</span> <span class="op">==</span> <span class="st">"rat"</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] "rat" "cat" "cat"</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># return a logical vector that is TRUE for the elements within animals</span></span>
<span><span class="co"># that are found in the character vector and FALSE for those that are not</span></span>
<span><span class="va">animals</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"rat"</span>, <span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"duck"</span>, <span class="st">"goat"</span>, <span class="st">"bird"</span>, <span class="st">"fish"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] FALSE  TRUE  TRUE  TRUE  TRUE</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use the logical vector created by %in% to return elements from animals</span></span>
<span><span class="co"># that are found in the character vector</span></span>
<span><span class="va">animals</span><span class="op">[</span><span class="va">animals</span> <span class="op">%in%</span> <span class="fu">c</span><span class="op">(</span><span class="st">"rat"</span>, <span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"duck"</span>, <span class="st">"goat"</span>, <span class="st">"bird"</span>, <span class="st">"fish"</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] "rat" "dog" "cat" "cat"</span></span></code></pre>
</div>
<div id="challenge-optional" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-optional" class="callout-inner">
<h3 class="callout-title">Challenge (optional)<a class="anchor" aria-label="anchor" href="#challenge-optional"></a>
</h3>
<div class="callout-content">
<ul>
<li>Can you figure out why <code>"four" &gt; "five"</code> returns
<code>TRUE</code>?</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">Show me the solution</h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<p>When using “&gt;” or “&lt;” on strings, R compares their alphabetical
order. Here “four” comes after “five”, and therefore is “greater than”
it.</p>
</div>
</div>
</div>
</div>
</div>
</section><section id="missing-data"><h2 class="section-heading">Missing data<a class="anchor" aria-label="anchor" href="#missing-data"></a>
</h2>
<hr class="half-width">
<p>As R was designed to analyze datasets, it includes the concept of
missing data (which is uncommon in other programming languages). Missing
data are represented in vectors as <code>NA</code>.</p>
<p>When doing operations on numbers, most functions will return
<code>NA</code> if the data you are working with include missing values.
This feature makes it harder to overlook the cases where you are dealing
with missing data. You can add the argument <code>na.rm = TRUE</code> to
calculate the result as if the missing values were removed
(<code>rm</code> stands for ReMoved) first.</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">heights</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="cn">NA</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu">mean</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span></span>
<span><span class="fu">max</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span></span>
<span><span class="fu">mean</span><span class="op">(</span><span class="va">heights</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">max</span><span class="op">(</span><span class="va">heights</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>If your data include missing values, you may want to become familiar
with the functions <code>is.na()</code>, <code>na.omit()</code>, and
<code>complete.cases()</code>. See below for examples.</p>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extract those elements which are not missing values.</span></span>
<span><span class="va">heights</span><span class="op">[</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Returns the object with incomplete cases removed.</span></span>
<span><span class="co">#The returned object is an atomic vector of type `"numeric"` (or #`"double"`).</span></span>
<span><span class="fu">na.omit</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Extract those elements which are complete cases.</span></span>
<span><span class="co">#The returned object is an atomic vector of type `"numeric"` (or #`"double"`).</span></span>
<span><span class="va">heights</span><span class="op">[</span><span class="fu">complete.cases</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span><span class="op">]</span></span></code></pre>
</div>
<p>Recall that you can use the <code>typeof()</code> function to find
the type of your atomic vector.</p>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Using this vector of heights in inches, create a new vector,
<code>heights_no_na</code>, with the NAs removed.</li>
</ol>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">heights</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">63</span>, <span class="fl">69</span>, <span class="fl">60</span>, <span class="fl">65</span>, <span class="cn">NA</span>, <span class="fl">68</span>, <span class="fl">61</span>, <span class="fl">70</span>, <span class="fl">61</span>, <span class="fl">59</span>, <span class="fl">64</span>, <span class="fl">69</span>, <span class="fl">63</span>, <span class="fl">63</span>, <span class="cn">NA</span>, <span class="fl">72</span>, <span class="fl">65</span>, <span class="fl">64</span>, <span class="fl">70</span>, <span class="fl">63</span>, <span class="fl">65</span><span class="op">)</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li><p>Use the function <code>median()</code> to calculate the median of
the <code>heights</code> vector.</p></li>
<li><p>Use R to figure out how many people in the set are taller than 67
inches.</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">Show me the solution</h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">heights</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">63</span>, <span class="fl">69</span>, <span class="fl">60</span>, <span class="fl">65</span>, <span class="cn">NA</span>, <span class="fl">68</span>, <span class="fl">61</span>, <span class="fl">70</span>, <span class="fl">61</span>, <span class="fl">59</span>, <span class="fl">64</span>, <span class="fl">69</span>, <span class="fl">63</span>, <span class="fl">63</span>, <span class="cn">NA</span>, <span class="fl">72</span>, <span class="fl">65</span>, <span class="fl">64</span>, <span class="fl">70</span>, <span class="fl">63</span>, <span class="fl">65</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1.</span></span>
<span><span class="va">heights_no_na</span> <span class="op">&lt;-</span> <span class="va">heights</span><span class="op">[</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># or</span></span>
<span><span class="va">heights_no_na</span> <span class="op">&lt;-</span> <span class="fu">na.omit</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span></span>
<span><span class="co"># or</span></span>
<span><span class="va">heights_no_na</span> <span class="op">&lt;-</span> <span class="va">heights</span><span class="op">[</span><span class="fu">complete.cases</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># 2.</span></span>
<span><span class="fu">median</span><span class="op">(</span><span class="va">heights</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3.</span></span>
<span><span class="va">heights_above_67</span> <span class="op">&lt;-</span> <span class="va">heights_no_na</span><span class="op">[</span><span class="va">heights_no_na</span> <span class="op">&gt;</span> <span class="fl">67</span><span class="op">]</span></span>
<span><span class="fu">length</span><span class="op">(</span><span class="va">heights_above_67</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Now that we have learned how to write scripts, and the basics of R’s
data structures, we are ready to start working with the Portal dataset
we have been using in the other lessons, and learn about data
frames.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>
<code>&lt;-</code> is used to assign values on the right to objects
on the left</li>
<li>Code should be saved within the Source pane in RStudio to help you
return to your code later.<br>
</li>
<li>‘#’ can be used to add comments to your code.</li>
<li>Functions can automate more complicated sets of commands, and
require arguments as inputs.</li>
<li>Vectors are composed by a series of values and can take many
forms.</li>
<li>Data structures in R include ‘vector’, ‘list’, ‘matrix’,
‘data.frame’, ‘factor’, and ‘array’.</li>
<li>Vectors can be subset by indexing or through logical vectors.</li>
<li>Many functions exist to remove missing data from data
structures.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-02-starting-with-data"><p>Content from <a href="02-starting-with-data.html">Starting with data</a></p>
<hr>
<p>Last updated on 2024-01-31 |
        
        <a href="https://github.com/datacarpentry/R-ecology-lesson/edit/main/episodes/02-starting-with-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a data.frame?</li>
<li>How can I read a complete csv file into R?</li>
<li>How can I get basic summary information about my dataset?</li>
<li>How can extract specific information from a dataframe?</li>
<li>What are factors, and how are they different from other
datatypes?</li>
<li>How can I rename factors?</li>
<li>How are dates represented in R and how can I change the format?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Load external data from a .csv file into a data frame.</li>
<li>Install and load packages.</li>
<li>Describe what a data frame is.</li>
<li>Summarize the contents of a data frame.</li>
<li>Use indexing to subset specific portions of data frames.</li>
<li>Describe what a factor is.</li>
<li>Convert between strings and factors.</li>
<li>Reorder and rename factors.</li>
<li>Change how character strings are handled in a data frame.</li>
<li>Format dates.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="loading-the-survey-data"><h2 class="section-heading">Loading the survey data<a class="anchor" aria-label="anchor" href="#loading-the-survey-data"></a>
</h2>
<hr class="half-width">
<p>We are investigating the animal species diversity and weights found
within plots at our study site. The dataset is stored as a comma
separated value (CSV) file. Each row holds information for a single
animal, and the columns represent:</p>
<table class="table">
<thead><tr class="header">
<th>Column</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>record_id</td>
<td>Unique id for the observation</td>
</tr>
<tr class="even">
<td>month</td>
<td>month of observation</td>
</tr>
<tr class="odd">
<td>day</td>
<td>day of observation</td>
</tr>
<tr class="even">
<td>year</td>
<td>year of observation</td>
</tr>
<tr class="odd">
<td>plot_id</td>
<td>ID of a particular experimental plot of land</td>
</tr>
<tr class="even">
<td>species_id</td>
<td>2-letter code</td>
</tr>
<tr class="odd">
<td>sex</td>
<td>sex of animal (“M”, “F”)</td>
</tr>
<tr class="even">
<td>hindfoot_length</td>
<td>length of the hindfoot in mm</td>
</tr>
<tr class="odd">
<td>weight</td>
<td>weight of the animal in grams</td>
</tr>
<tr class="even">
<td>genus</td>
<td>genus of animal</td>
</tr>
<tr class="odd">
<td>species</td>
<td>species of animal</td>
</tr>
<tr class="even">
<td>taxon</td>
<td>e.g. Rodent, Reptile, Bird, Rabbit</td>
</tr>
<tr class="odd">
<td>plot_type</td>
<td>type of plot</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="downloading-the-data">Downloading the data<a class="anchor" aria-label="anchor" href="#downloading-the-data"></a>
</h3>
<p>We created the folder that will store the downloaded data
(<code>data_raw</code>) in the chapter <a href="https://datacarpentry.org/R-ecology-lesson/00-before-we-start.html#Organizing_your_working_directory" class="external-link">“Before
we start”</a>. If you skipped that part, it may be a good idea to have a
look now, to make sure your working directory is set up properly.</p>
<p>We are going to use the R function <code>download.file()</code> to
download the CSV file that contains the survey data from Figshare, and
we will use <code>read_csv()</code> to load the content of the CSV file
into R.</p>
<p>Inside the <code>download.file</code> command, the first entry is a
character string with the source URL (“<a href="https://ndownloader.figshare.com/files/2292169" class="external-link uri">https://ndownloader.figshare.com/files/2292169</a>”). This
source URL downloads a CSV file from figshare. The text after the comma
(“data_raw/portal_data_joined.csv”) is the destination of the file on
your local machine. You’ll need to have a folder on your machine called
“data_raw” where you’ll download the file. So this command downloads a
file from Figshare, names it “portal_data_joined.csv” and adds it to a
preexisting folder named “data_raw”.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">download.file</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://ndownloader.figshare.com/files/2292169"</span>,</span>
<span>              destfile <span class="op">=</span> <span class="st">"data_raw/portal_data_joined.csv"</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="reading-the-data-into-r">Reading the data into R<a class="anchor" aria-label="anchor" href="#reading-the-data-into-r"></a>
</h3>
<p>The file has now been downloaded to the destination you specified,
but R has not yet loaded the data from the file into memory. To do this,
we can use the <code>read_csv()</code> function from the
<strong><code>tidyverse</code></strong> package.</p>
<p>Packages in R are basically sets of additional functions that let you
do more stuff. The functions we’ve been using so far, like
<code>round()</code>, <code>sqrt()</code>, or <code>c()</code> come
built into R. Packages give you access to additional functions beyond
base R. A similar function to <code>read_csv()</code> from the tidyverse
package is <code>read.csv()</code> from base R. We don’t have time to
cover their differences but notice that the exact spelling determines
which function is used. Before you use a package for the first time you
need to install it on your machine, and then you should import it in
every subsequent R session when you need it.</p>
<p>To install the <strong><code>tidyverse</code></strong> package, we
can type <code>install.packages("tidyverse")</code> straight into the
console. In fact, it’s better to write this in the console than in our
script for any package, as there’s no need to re-install packages every
time we run the script. Then, to load the package type:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## load the tidyverse packages, incl. dplyr</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can use the functions from the
<strong><code>tidyverse</code></strong> package. Let’s use
<code>read_csv()</code> to read the data into a data frame (we will
learn more about data frames later):</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data_raw/portal_data_joined.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; Rows: 34786 Columns: 13</span></span>
<span><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Delimiter: ","</span></span>
<span><span class="co">#&gt; chr (6): species_id, sex, genus, species, taxa, plot_type</span></span>
<span><span class="co">#&gt; dbl (7): record_id, month, day, year, plot_id, hindfoot_length, weight</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
</div>
<p>When you execute <code>read_csv</code> on a data file, it looks
through the first 1000 rows of each column and guesses its data type.
For example, in this dataset, <code>read_csv()</code> reads
<code>weight</code> as <code>col_double</code> (a numeric data type),
and <code>species</code> as <code>col_character</code>. You have the
option to specify the data type for a column manually by using the
<code>col_types</code> argument in <code>read_csv</code>.</p>
<div id="note" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="note" class="callout-inner">
<h3 class="callout-title">Note<a class="anchor" aria-label="anchor" href="#note"></a>
</h3>
<div class="callout-content">
<p><code>read_csv()</code> assumes that fields are delineated by commas.
However, in several countries, the comma is used as a decimal separator
and the semicolon (;) is used as a field delineator. If you want to read
in this type of files in R, you can use the <code>read_csv2()</code>
function. It behaves like <code>read_csv()</code> but uses different
parameters for the decimal and the field separators. There is also the
<code>read_tsv()</code> for tab separated data files and
<code>read_delim()</code> for less common formats. Check out the help
for <code>read_csv()</code> by typing <code>?read_csv</code> to learn
more.</p>
<p>In addition to the above versions of the csv format, you should
develop the habits of looking at and recording some parameters of your
csv files. For instance, the character encoding, control characters used
for line ending, date format (if the date is not split into three
variables), and the presence of unexpected <a href="https://en.wikipedia.org/wiki/Newline" class="external-link">newlines</a> are important
characteristics of your data files. Those parameters will ease up the
import step of your data in R.</p>
</div>
</div>
</div>
<p>We can see the contents of the first few lines of the data by typing
its name: <code>surveys</code>. By default, this will show you as many
rows and columns of the data as fit on your screen. If you wanted the
first 50 rows, you could type <code>print(surveys, n = 50)</code></p>
<p>We can also extract the first few lines of this data using the
function <code>head()</code>:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; # A tibble: 6 × 13</span></span>
<span><span class="co">#&gt;   record_id month   day  year plot_id species_id sex   hindfoot_length weight</span></span>
<span><span class="co">#&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1         1     7    16  1977       2 NL         M                  32     NA</span></span>
<span><span class="co">#&gt; 2        72     8    19  1977       2 NL         M                  31     NA</span></span>
<span><span class="co">#&gt; 3       224     9    13  1977       2 NL         &lt;NA&gt;               NA     NA</span></span>
<span><span class="co">#&gt; 4       266    10    16  1977       2 NL         &lt;NA&gt;               NA     NA</span></span>
<span><span class="co">#&gt; 5       349    11    12  1977       2 NL         &lt;NA&gt;               NA     NA</span></span>
<span><span class="co">#&gt; 6       363    11    12  1977       2 NL         &lt;NA&gt;               NA     NA</span></span>
<span><span class="co">#&gt; # ℹ 4 more variables: genus &lt;chr&gt;, species &lt;chr&gt;, taxa &lt;chr&gt;, plot_type &lt;chr&gt;</span></span></code></pre>
</div>
<p>Unlike the <code>print()</code> function, <code>head()</code> returns
the extracted data. You could use it to assign the first 100 rows of
<code>surveys</code> to an object using
<code>surveys_sample &lt;- head(surveys, 100)</code>. This can be useful
if you want to try out complex computations on a subset of your data
before you apply them to the whole data set. There is a similar function
that lets you extract the last few lines of the data set. It is called
(you might have guessed it) <code>tail()</code>.</p>
<p>To open the dataset in RStudio’s Data Viewer, use the
<code>view()</code> function:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">view</span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span></span></code></pre>
</div>
<div id="note-1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="note-1" class="callout-inner">
<h3 class="callout-title">Note<a class="anchor" aria-label="anchor" href="#note-1"></a>
</h3>
<div class="callout-content">
<p>There are two functions for viewing which are case-sensitive. Using
<code>view()</code> with a lowercase ‘v’ is part of tidyverse, whereas
using <code>View()</code> with an uppercase ‘V’ is loaded through base R
in the <code>utils</code> package.</p>
</div>
</div>
</div>
</div>
</section><section id="what-are-data-frames"><h2 class="section-heading">What are data frames?<a class="anchor" aria-label="anchor" href="#what-are-data-frames"></a>
</h2>
<hr class="half-width">
<p>When we loaded the data into R, it got stored as an object of class
<code>tibble</code>, which is a special kind of data frame (the
difference is not important for our purposes, but you can learn more
about tibbles <a href="https://tibble.tidyverse.org/" class="external-link">here</a>). Data
frames are the <em>de facto</em> data structure for most tabular data,
and what we use for statistics and plotting. Data frames can be created
by hand, but most commonly they are generated by functions like
<code>read_csv()</code>; in other words, when importing spreadsheets
from your hard drive or the web.</p>
<p>A data frame is the representation of data in the format of a table
where the columns are vectors that all have the same length. Because
columns are vectors, each column must contain a single type of data
(e.g., characters, integers, factors). For example, here is a figure
depicting a data frame comprising a numeric, a character, and a logical
vector.</p>
<figure><img src=".././fig/data-frame.svg" class="figure mx-auto d-block"></figure><p>We can see this also when inspecting the <b>str</b>ucture of a data
frame with the function <code>str()</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="inspecting-data-frames"><h2 class="section-heading">Inspecting data frames<a class="anchor" aria-label="anchor" href="#inspecting-data-frames"></a>
</h2>
<hr class="half-width">
<p>We already saw how the functions <code>head()</code> and
<code>str()</code> can be useful to check the content and the structure
of a data frame. Here is a non-exhaustive list of functions to get a
sense of the content/structure of the data. Let’s try them out!</p>
<ul>
<li>
<p>Size:</p>
<ul>
<li>
<code>dim(surveys)</code> - returns a vector with the number of rows
in the first element, and the number of columns as the second element
(the <strong>dim</strong>ensions of the object)</li>
<li>
<code>nrow(surveys)</code> - returns the number of rows</li>
<li>
<code>ncol(surveys)</code> - returns the number of columns</li>
</ul>
</li>
<li>
<p>Content:</p>
<ul>
<li>
<code>head(surveys)</code> - shows the first 6 rows</li>
<li>
<code>tail(surveys)</code> - shows the last 6 rows</li>
</ul>
</li>
<li>
<p>Names:</p>
<ul>
<li>
<code>names(surveys)</code> - returns the column names (synonym of
<code>colnames()</code> for <code>data.frame</code> objects)</li>
<li>
<code>rownames(surveys)</code> - returns the row names</li>
</ul>
</li>
<li>
<p>Summary:</p>
<ul>
<li>
<code>str(surveys)</code> - structure of the object and information
about the class, length and content of each column</li>
<li>
<code>summary(surveys)</code> - summary statistics for each
column</li>
</ul>
</li>
</ul>
<p>Note: most of these functions are “generic”, they can be used on
other types of objects besides <code>data.frame</code>.</p>
<div id="challenge" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge"></a>
</h3>
<div class="callout-content">
<p>Based on the output of <code>str(surveys)</code>, can you answer the
following questions?</p>
<ul>
<li>What is the class of the object <code>surveys</code>?</li>
<li>How many rows and how many columns are in this object?</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; spc_tbl_ [34,786 × 13] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ record_id      : num [1:34786] 1 72 224 266 349 363 435 506 588 661 ...</span></span>
<span><span class="co">#&gt;  $ month          : num [1:34786] 7 8 9 10 11 11 12 1 2 3 ...</span></span>
<span><span class="co">#&gt;  $ day            : num [1:34786] 16 19 13 16 12 12 10 8 18 11 ...</span></span>
<span><span class="co">#&gt;  $ year           : num [1:34786] 1977 1977 1977 1977 1977 ...</span></span>
<span><span class="co">#&gt;  $ plot_id        : num [1:34786] 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">#&gt;  $ species_id     : chr [1:34786] "NL" "NL" "NL" "NL" ...</span></span>
<span><span class="co">#&gt;  $ sex            : chr [1:34786] "M" "M" NA NA ...</span></span>
<span><span class="co">#&gt;  $ hindfoot_length: num [1:34786] 32 31 NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ weight         : num [1:34786] NA NA NA NA NA NA NA NA 218 NA ...</span></span>
<span><span class="co">#&gt;  $ genus          : chr [1:34786] "Neotoma" "Neotoma" "Neotoma" "Neotoma" ...</span></span>
<span><span class="co">#&gt;  $ species        : chr [1:34786] "albigula" "albigula" "albigula" "albigula" ...</span></span>
<span><span class="co">#&gt;  $ taxa           : chr [1:34786] "Rodent" "Rodent" "Rodent" "Rodent" ...</span></span>
<span><span class="co">#&gt;  $ plot_type      : chr [1:34786] "Control" "Control" "Control" "Control" ...</span></span>
<span><span class="co">#&gt;  - attr(*, "spec")=</span></span>
<span><span class="co">#&gt;   .. cols(</span></span>
<span><span class="co">#&gt;   ..   record_id = col_double(),</span></span>
<span><span class="co">#&gt;   ..   month = col_double(),</span></span>
<span><span class="co">#&gt;   ..   day = col_double(),</span></span>
<span><span class="co">#&gt;   ..   year = col_double(),</span></span>
<span><span class="co">#&gt;   ..   plot_id = col_double(),</span></span>
<span><span class="co">#&gt;   ..   species_id = col_character(),</span></span>
<span><span class="co">#&gt;   ..   sex = col_character(),</span></span>
<span><span class="co">#&gt;   ..   hindfoot_length = col_double(),</span></span>
<span><span class="co">#&gt;   ..   weight = col_double(),</span></span>
<span><span class="co">#&gt;   ..   genus = col_character(),</span></span>
<span><span class="co">#&gt;   ..   species = col_character(),</span></span>
<span><span class="co">#&gt;   ..   taxa = col_character(),</span></span>
<span><span class="co">#&gt;   ..   plot_type = col_character()</span></span>
<span><span class="co">#&gt;   .. )</span></span>
<span><span class="co">#&gt;  - attr(*, "problems")=&lt;externalptr&gt;</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## * class: data frame</span></span>
<span><span class="co">## * how many rows: 34786,  how many columns: 13</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="indexing-and-subsetting-data-frames"><h2 class="section-heading">Indexing and subsetting data frames<a class="anchor" aria-label="anchor" href="#indexing-and-subsetting-data-frames"></a>
</h2>
<hr class="half-width">
<p>Our survey data frame has rows and columns (it has 2 dimensions), if
we want to extract some specific data from it, we need to specify the
“coordinates” we want from it. Row numbers come first, followed by
column numbers. However, note that different ways of specifying these
coordinates lead to results with different classes.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can extract specific values by specifying row and column indices</span></span>
<span><span class="co"># in the format: </span></span>
<span><span class="co"># data_frame[row_index, column_index]</span></span>
<span><span class="co"># For instance, to extract the first row and column from surveys:</span></span>
<span><span class="va">surveys</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># First row, sixth column:</span></span>
<span><span class="va">surveys</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">6</span><span class="op">]</span>   </span>
<span></span>
<span><span class="co"># We can also use shortcuts to select a number of rows or columns at once</span></span>
<span><span class="co"># To select all columns, leave the column index blank</span></span>
<span><span class="co"># For instance, to select all columns for the first row:</span></span>
<span><span class="va">surveys</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># The same shortcut works for rows --</span></span>
<span><span class="co"># To select the first column across all rows:</span></span>
<span><span class="va">surveys</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># An even shorter way to select first column across all rows:</span></span>
<span><span class="va">surveys</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co"># No comma! </span></span>
<span></span>
<span><span class="co"># To select multiple rows or columns, use vectors!</span></span>
<span><span class="co"># To select the first three rows of the 5th and 6th column</span></span>
<span><span class="va">surveys</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu">c</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span> </span>
<span></span>
<span><span class="co"># We can use the : operator to create those vectors for us:</span></span>
<span><span class="va">surveys</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> </span>
<span></span>
<span><span class="co"># This is equivalent to head_surveys &lt;- head(surveys)</span></span>
<span><span class="va">head_surveys</span> <span class="op">&lt;-</span> <span class="va">surveys</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># As we've seen, when working with tibbles </span></span>
<span><span class="co"># subsetting with single square brackets ("[]") always returns a data frame.</span></span>
<span><span class="co"># If you want a vector, use double square brackets ("[[]]")</span></span>
<span></span>
<span><span class="co"># For instance, to get the first column as a vector:</span></span>
<span><span class="va">surveys</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># To get the first value in our data frame:</span></span>
<span><span class="va">surveys</span><span class="op">[[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<p><code>:</code> is a special function that creates numeric vectors of
integers in increasing or decreasing order, test <code>1:10</code> and
<code>10:1</code> for instance.</p>
<p>You can also exclude certain indices of a data frame using the
“<code>-</code>” sign:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>                 <span class="co"># The whole data frame, except the first column</span></span>
<span><span class="va">surveys</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="fu">nrow</span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span> <span class="co"># Equivalent to head(surveys)</span></span></code></pre>
</div>
<p>Data frames can be subset by calling indices (as shown previously),
but also by calling their column names directly:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># As before, using single brackets returns a data frame:</span></span>
<span><span class="va">surveys</span><span class="op">[</span><span class="st">"species_id"</span><span class="op">]</span></span>
<span><span class="va">surveys</span><span class="op">[</span>, <span class="st">"species_id"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Double brackets returns a vector:</span></span>
<span><span class="va">surveys</span><span class="op">[[</span><span class="st">"species_id"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># We can also use the $ operator with column names instead of double brackets</span></span>
<span><span class="co"># This returns a vector:</span></span>
<span><span class="va">surveys</span><span class="op">$</span><span class="va">species_id</span></span></code></pre>
</div>
<p>In RStudio, you can use the autocompletion feature to get the full
and correct names of the columns.</p>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li><p>Create a <code>data.frame</code> (<code>surveys_200</code>)
containing only the data in row 200 of the <code>surveys</code>
dataset.</p></li>
<li><p>Notice how <code>nrow()</code> gave you the number of rows in a
<code>data.frame</code>?</p></li>
</ol>
<ul>
<li>Use that number to pull out just that last row from the
<code>surveys</code> dataset.</li>
<li>Compare that with what you see as the last row using
<code>tail()</code> to make sure it’s meeting expectations.</li>
<li>Pull out that last row using <code>nrow()</code> instead of the row
number.</li>
<li>Create a new data frame (<code>surveys_last</code>) from that last
row.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><p>Use <code>nrow()</code> to extract the row that is in the middle
of the data frame. Store the content of this row in an object named
<code>surveys_middle</code>.</p></li>
<li><p>Combine <code>nrow()</code> with the <code>-</code> notation
above to reproduce the behavior of <code>head(surveys)</code>, keeping
just the first through 6th rows of the surveys dataset.</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 1.</span></span>
<span><span class="va">surveys_200</span> <span class="op">&lt;-</span> <span class="va">surveys</span><span class="op">[</span><span class="fl">200</span>, <span class="op">]</span></span>
<span><span class="co">## 2.</span></span>
<span><span class="co"># Saving `n_rows` to improve readability and reduce duplication</span></span>
<span><span class="va">n_rows</span> <span class="op">&lt;-</span> <span class="fu">nrow</span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span></span>
<span><span class="va">surveys_last</span> <span class="op">&lt;-</span> <span class="va">surveys</span><span class="op">[</span><span class="va">n_rows</span>, <span class="op">]</span></span>
<span><span class="co">## 3.</span></span>
<span><span class="va">surveys_middle</span> <span class="op">&lt;-</span> <span class="va">surveys</span><span class="op">[</span><span class="va">n_rows</span> <span class="op">/</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span><span class="co">## 4.</span></span>
<span><span class="va">surveys_head</span> <span class="op">&lt;-</span> <span class="va">surveys</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="va">n_rows</span><span class="op">)</span>, <span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="factors"><h2 class="section-heading">Factors<a class="anchor" aria-label="anchor" href="#factors"></a>
</h2>
<hr class="half-width">
<p>When we did <code>str(surveys)</code> we saw that several of the
columns consist of integers. The columns <code>genus</code>,
<code>species</code>, <code>sex</code>, <code>plot_type</code>, …
however, are of the class <code>character</code>. Arguably, these
columns contain categorical data, that is, they can only take on a
limited number of values.</p>
<p>R has a special class for working with categorical data, called
<code>factor</code>. Factors are very useful and actually contribute to
making R particularly well suited to working with data. So we are going
to spend a little time introducing them.</p>
<p>Once created, factors can only contain a pre-defined set of values,
known as <em>levels</em>. Factors are stored as integers associated with
labels and they can be ordered or unordered. While factors look (and
often behave) like character vectors, they are actually treated as
integer vectors by R. So you need to be very careful when treating them
as strings.</p>
<p>When importing a data frame with <code>read_csv()</code>, the columns
that contain text are not automatically coerced (=converted) into the
<code>factor</code> data type, but once we have loaded the data we can
do the conversion using the <code>factor()</code> function:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span><span class="op">$</span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">surveys</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<p>We can see that the conversion has worked by using the
<code>summary()</code> function again. This produces a table with the
counts for each factor level:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">surveys</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<p>By default, R always sorts levels in alphabetical order. For
instance, if you have a factor with 2 levels:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span>, <span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>R will assign <code>1</code> to the level <code>"female"</code> and
<code>2</code> to the level <code>"male"</code> (because <code>f</code>
comes before <code>m</code>, even though the first element in this
vector is <code>"male"</code>). You can see this by using the function
<code>levels()</code> and you can find the number of levels using
<code>nlevels()</code>:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="fu">nlevels</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<p>Sometimes, the order of the factors does not matter, other times you
might want to specify the order because it is meaningful (e.g., “low”,
“medium”, “high”), it improves your visualization, or it is required by
a particular type of analysis. Here, one way to reorder our levels in
the <code>sex</code> vector would be:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sex</span> <span class="co"># current order</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] male   female female male  </span></span>
<span><span class="co">#&gt; Levels: female male</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">sex</span>, levels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sex</span> <span class="co"># after re-ordering</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] male   female female male  </span></span>
<span><span class="co">#&gt; Levels: male female</span></span></code></pre>
</div>
<p>In R’s memory, these factors are represented by integers (1, 2, 3),
but are more informative than integers because factors are self
describing: <code>"female"</code>, <code>"male"</code> is more
descriptive than <code>1</code>, <code>2</code>. Which one is “male”?
You wouldn’t be able to tell just from the integer data. Factors, on the
other hand, have this information built in. It is particularly helpful
when there are many levels (like the species names in our example
dataset).</p>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li><p>Change the columns <code>taxa</code> and <code>genus</code> in
the <code>surveys</code> data frame into a factor.</p></li>
<li><p>Using the functions you learned before, can you find
out…</p></li>
</ol>
<ul>
<li>How many rabbits were observed?</li>
<li>How many different genera are in the <code>genus</code> column?</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span><span class="op">$</span><span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">surveys</span><span class="op">$</span><span class="va">taxa</span><span class="op">)</span></span>
<span><span class="va">surveys</span><span class="op">$</span><span class="va">genus</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">surveys</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span></span>
<span><span class="fu">nlevels</span><span class="op">(</span><span class="va">surveys</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## * how many genera: There are 26 unique genera in the `genus` column.</span></span>
<span><span class="co">## * how many rabbts: There are 75 rabbits in the `taxa` column.</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="converting-factors">Converting factors<a class="anchor" aria-label="anchor" href="#converting-factors"></a>
</h3>
<p>If you need to convert a factor to a character vector, you use
<code>as.character(x)</code>.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">as.character</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<p>In some cases, you may have to convert factors where the levels
appear as numbers (such as concentration levels or years) to a numeric
vector. For instance, in one part of your analysis the years might need
to be encoded as factors (e.g., comparing average weights across years)
but in another part of your analysis they may need to be stored as
numeric values (e.g., doing math operations on the years). This
conversion from factor to numeric is a little trickier. The
<code>as.numeric()</code> function returns the index values of the
factor, not its levels, so it will result in an entirely new (and
unwanted in this case) set of numbers. One method to avoid this is to
convert factors to characters, and then to numbers.</p>
<p>Another method is to use the <code>levels()</code> function.
Compare:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_fct</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">1983</span>, <span class="fl">1977</span>, <span class="fl">1998</span>, <span class="fl">1990</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">as.numeric</span><span class="op">(</span><span class="va">year_fct</span><span class="op">)</span>               <span class="co"># Wrong! And there is no warning...</span></span>
<span><span class="fu">as.numeric</span><span class="op">(</span><span class="fu">as.character</span><span class="op">(</span><span class="va">year_fct</span><span class="op">)</span><span class="op">)</span> <span class="co"># Works...</span></span>
<span><span class="fu">as.numeric</span><span class="op">(</span><span class="fu">levels</span><span class="op">(</span><span class="va">year_fct</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="va">year_fct</span><span class="op">]</span>    <span class="co"># The recommended way.</span></span></code></pre>
</div>
<p>Notice that in the <code>levels()</code> approach, three important
steps occur:</p>
<ul>
<li>We obtain all the factor levels using
<code>levels(year_fct)</code>
</li>
<li>We convert these levels to numeric values using
<code>as.numeric(levels(year_fct))</code>
</li>
<li>We then access these numeric values using the underlying integers of
the vector <code>year_fct</code> inside the square brackets</li>
</ul>
</div>
<div class="section level3">
<h3 id="renaming-factors">Renaming factors<a class="anchor" aria-label="anchor" href="#renaming-factors"></a>
</h3>
<p>When your data is stored as a factor, you can use the
<code>plot()</code> function to get a quick glance at the number of
observations represented by each factor level. Let’s look at the number
of males and females captured over the course of the experiment:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## bar plot of the number of females and males captured during the experiment:</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">surveys</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/02-starting-with-data-rendered-unnamed-chunk-27-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>However, as we saw when we used <code>summary(surveys$sex)</code>,
there are about 1700 individuals for which the sex information hasn’t
been recorded. To show them in the plot, we can turn the missing values
into a factor level with the <code>addNA()</code> function. We will also
have to give the new factor level a label. We are going to work with a
copy of the <code>sex</code> column, so we’re not modifying the working
copy of the data frame:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="va">surveys</span><span class="op">$</span><span class="va">sex</span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] "F" "M"</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu">addNA</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] "F" "M" NA</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] M    M    &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;</span></span>
<span><span class="co">#&gt; Levels: F M &lt;NA&gt;</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"undetermined"</span></span>
<span><span class="fu">levels</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] "F"            "M"            "undetermined"</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] M            M            undetermined undetermined undetermined</span></span>
<span><span class="co">#&gt; [6] undetermined</span></span>
<span><span class="co">#&gt; Levels: F M undetermined</span></span></code></pre>
</div>
<p>Now we can plot the data again, using <code>plot(sex)</code>.</p>
<figure><img src="../fig/02-starting-with-data-rendered-unnamed-chunk-29-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-3"></a>
</h3>
<div class="callout-content">
<ul>
<li>Rename “F” and “M” to “female” and “male” respectively.</li>
<li>Now that we have renamed the factor level to “undetermined”, can you
recreate the barplot such that “undetermined” is first (before
“female”)?</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">levels</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span></span>
<span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu">factor</span><span class="op">(</span><span class="va">sex</span>, levels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"undetermined"</span>, <span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/02-starting-with-data-rendered-unnamed-chunk-30-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="challenge-4" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge-4" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-4"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>We have seen how data frames are created when using
<code>read_csv()</code>, but they can also be created by hand with the
<code>data.frame()</code> function. There are a few mistakes in this
hand-crafted <code>data.frame</code>. Can you spot and fix them? Don’t
hesitate to experiment!</li>
</ol>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>animal_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">animal =</span> <span class="fu">c</span>(dog, cat, sea cucumber, sea urchin),</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">feel =</span> <span class="fu">c</span>(<span class="st">"furry"</span>, <span class="st">"squishy"</span>, <span class="st">"spiny"</span>),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">weight =</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">8</span> <span class="fl">1.1</span>, <span class="fl">0.8</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>          )</span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Can you predict the class for each of the columns in the following
example? Check your guesses using
<code>str(country_climate)</code>:</li>
</ol>
<ul>
<li>Are they what you expected? Why? Why not?</li>
<li>What would you need to change to ensure that each column had the
accurate data type?</li>
</ul>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">country_climate</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span></span>
<span>       country <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"Canada"</span>, <span class="st">"Panama"</span>, <span class="st">"South Africa"</span>, <span class="st">"Australia"</span><span class="op">)</span>,</span>
<span>       climate <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"cold"</span>, <span class="st">"hot"</span>, <span class="st">"temperate"</span>, <span class="st">"hot/temperate"</span><span class="op">)</span>,</span>
<span>       temperature <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">10</span>, <span class="fl">30</span>, <span class="fl">18</span>, <span class="st">"15"</span><span class="op">)</span>,</span>
<span>       northern_hemisphere <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="st">"FALSE"</span><span class="op">)</span>,</span>
<span>       has_kangaroo <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>       <span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>The automatic conversion of data type is sometimes a blessing,
sometimes an annoyance. Be aware that it exists, learn the rules, and
double check that data you import in R are of the correct type within
your data frame. If not, use it to your advantage to detect mistakes
that might have been introduced during data entry (for instance, a
letter in a column that should only contain numbers).</p>
<p>Learn more in this <a href="https://support.rstudio.com/hc/en-us/articles/218611977-Importing-Data-with-RStudio" class="external-link">RStudio
tutorial</a></p>
</div>
</section><section id="formatting-dates"><h2 class="section-heading">Formatting dates<a class="anchor" aria-label="anchor" href="#formatting-dates"></a>
</h2>
<hr class="half-width">
<p>A common issue that new (and experienced!) R users have is converting
date and time information into a variable that is suitable for analyses.
One way to store date information is to store each component of the date
in a separate column. Using <code>str()</code>, we can confirm that our
data frame does indeed have a separate column for day, month, and year,
and that each of these columns contains integer values.</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span></span></code></pre>
</div>
<p>We are going to use the <code>ymd()</code> function from the package
<strong><code>lubridate</code></strong> (which belongs to the
<strong><code>tidyverse</code></strong>; learn more <a href="https://www.tidyverse.org/" class="external-link">here</a>).
<strong><code>lubridate</code></strong> gets installed as part as the
<strong><code>tidyverse</code></strong> installation. When you load the
<strong><code>tidyverse</code></strong>
(<code><a href="https://tidyverse.tidyverse.org" class="external-link">library(tidyverse)</a></code>), the core packages (the packages used
in most data analyses) get loaded.
<strong><code>lubridate</code></strong> however does not belong to the
core tidyverse, so you have to load it explicitly with
<code><a href="https://lubridate.tidyverse.org" class="external-link">library(lubridate)</a></code></p>
<p>Start by loading the required package:</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">lubridate</span><span class="op">)</span></span></code></pre>
</div>
<p>The <strong><code>lubridate</code></strong> package has many useful
functions for working with dates. These can help you extract dates from
different string representations, convert between timezones, calculate
time differences and more. You can find an overview of them in the <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/lubridate.pdf" class="external-link">lubridate
cheat sheet</a>.</p>
<p>Here we will use the function <code>ymd()</code>, which takes a
vector representing year, month, and day, and converts it to a
<code>Date</code> vector. <code>Date</code> is a class of data
recognized by R as being a date and can be manipulated as such. The
argument that the function requires is flexible, but, as a best
practice, is a character vector formatted as “YYYY-MM-DD”.</p>
<p>Let’s create a date object and inspect the structure:</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_date</span> <span class="op">&lt;-</span> <span class="fu">ymd</span><span class="op">(</span><span class="st">"2015-01-01"</span><span class="op">)</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">my_date</span><span class="op">)</span></span></code></pre>
</div>
<p>Now let’s paste the year, month, and day separately - we get the same
result:</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sep indicates the character to use to separate each component</span></span>
<span><span class="va">my_date</span> <span class="op">&lt;-</span> <span class="fu">ymd</span><span class="op">(</span><span class="fu">paste</span><span class="op">(</span><span class="st">"2015"</span>, <span class="st">"1"</span>, <span class="st">"1"</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">my_date</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we apply this function to the surveys dataset. Create a character
vector from the <code>year</code>, <code>month</code>, and
<code>day</code> columns of <code>surveys</code> using
<code>paste()</code>:</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="va">surveys</span><span class="op">$</span><span class="va">year</span>, <span class="va">surveys</span><span class="op">$</span><span class="va">month</span>, <span class="va">surveys</span><span class="op">$</span><span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></span></code></pre>
</div>
<p>This character vector can be used as the argument for
<code>ymd()</code>:</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ymd</span><span class="op">(</span><span class="fu">paste</span><span class="op">(</span><span class="va">surveys</span><span class="op">$</span><span class="va">year</span>, <span class="va">surveys</span><span class="op">$</span><span class="va">month</span>, <span class="va">surveys</span><span class="op">$</span><span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code><span><span class="co">#&gt; Warning: 129 failed to parse.</span></span></code></pre>
</div>
<p>There is a warning telling us that some dates could not be parsed
(understood) by the <code>ymd()</code> function. For these dates, the
function has returned <code>NA</code>, which means they are treated as
missing values. We will deal with this problem later, but first we add
the resulting <code>Date</code> vector to the <code>surveys</code> data
frame as a new column called <code>date</code>:</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu">ymd</span><span class="op">(</span><span class="fu">paste</span><span class="op">(</span><span class="va">surveys</span><span class="op">$</span><span class="va">year</span>, <span class="va">surveys</span><span class="op">$</span><span class="va">month</span>, <span class="va">surveys</span><span class="op">$</span><span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code><span><span class="co">#&gt; Warning: 129 failed to parse.</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span> <span class="co"># notice the new column, with 'date' as the class</span></span></code></pre>
</div>
<p>Let’s make sure everything worked correctly. One way to inspect the
new column is to use <code>summary()</code>:</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">surveys</span><span class="op">$</span><span class="va">date</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt;         Min.      1st Qu.       Median         Mean      3rd Qu.         Max. </span></span>
<span><span class="co">#&gt; "1977-07-16" "1984-03-12" "1990-07-22" "1990-12-15" "1997-07-29" "2002-12-31" </span></span>
<span><span class="co">#&gt;         NA's </span></span>
<span><span class="co">#&gt;        "129"</span></span></code></pre>
</div>
<p>Let’s investigate why some dates could not be parsed.</p>
<p>We can use the functions we saw previously to deal with missing data
to identify the rows in our data frame that are failing. If we combine
them with what we learned about subsetting data frames earlier, we can
extract the columns “year,”month”, “day” from the records that have
<code>NA</code> in our new column <code>date</code>. We will also use
<code>head()</code> so we don’t clutter the output:</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">missing_dates</span> <span class="op">&lt;-</span> <span class="va">surveys</span><span class="op">[</span><span class="fu">is.na</span><span class="op">(</span><span class="va">surveys</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>, <span class="fu">c</span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">missing_dates</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;    year month   day</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2000     9    31</span></span>
<span><span class="co">#&gt; 2  2000     4    31</span></span>
<span><span class="co">#&gt; 3  2000     4    31</span></span>
<span><span class="co">#&gt; 4  2000     4    31</span></span>
<span><span class="co">#&gt; 5  2000     4    31</span></span>
<span><span class="co">#&gt; 6  2000     9    31</span></span></code></pre>
</div>
<p>Why did these dates fail to parse? If you had to use these data for
your analyses, how would you deal with this situation?</p>
<p>The answer is because the dates provided as input for the
<code>ymd()</code> function do not actually exist. If we refer to the
output we got above, September and April only have 30 days, not 31 days
as it is specified in our dataset.</p>
<p>There are several ways you could deal with situation:</p>
<ul>
<li>If you have access to the raw data (e.g., field sheets) or
supporting information (e.g., field trip reports/logs), check them and
ensure the electronic database matches the information in the original
data source.</li>
<li>If you are able to contact the person responsible for collecting the
data, you could refer to them and ask for clarification.</li>
<li>You could also check the rest of the dataset for clues about the
correct value for the erroneous dates.</li>
<li>If your project has guidelines on how to correct this sort of
errors, refer to them and apply any recommendations.</li>
<li>If it is not possible to ascertain the correct value for these
observations, you may want to leave them as missing data.</li>
</ul>
<p>Regardless of the option you choose, it is important that you
document the error and the corrections (if any) that you apply to your
data.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use <code>read.csv</code> to read tabular data in R.</li>
<li>A data frame is the representation of data in the format of a table
where the columns are vectors that all have the same length.</li>
<li>
<code>dplyr</code> provides many methods for inspecting and
summarizing data in data frames.</li>
<li>Use factors to represent categorical data in R.</li>
<li>The <strong><code>lubridate</code></strong> package has many useful
functions for working with dates.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-03-dplyr"><p>Content from <a href="03-dplyr.html">Manipulating, analyzing and exporting data with tidyverse</a></p>
<hr>
<p>Last updated on 2024-01-31 |
        
        <a href="https://github.com/datacarpentry/R-ecology-lesson/edit/main/episodes/03-dplyr.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are dplyr and tidyr?</li>
<li>How can I select specific rows and/or columns from a dataframe?</li>
<li>How can I combine multiple commands into a single command?</li>
<li>How can I create new columns or remove existing columns from a
dataframe?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Describe the purpose of the <strong><code>dplyr</code></strong> and
<strong><code>tidyr</code></strong> packages.</li>
<li>Select certain columns in a data frame with the
<strong><code>dplyr</code></strong> function <code>select</code>.</li>
<li>Extract certain rows in a data frame according to logical (boolean)
conditions with the <strong><code>dplyr</code></strong> function
<code>filter</code> .</li>
<li>Link the output of one <strong><code>dplyr</code></strong> function
to the input of another function with the ‘pipe’ operator
<code>%&gt;%</code>.</li>
<li>Add new columns to a data frame that are functions of existing
columns with <code>mutate</code>.</li>
<li>Use the split-apply-combine concept for data analysis.</li>
<li>Use <code>summarize</code>, <code>group_by</code>, and
<code>count</code> to split a data frame into groups of observations,
apply summary statistics for each group, and then combine the
results.</li>
<li>Describe the concept of a wide and a long table format and for which
purpose those formats are useful.</li>
<li>Describe what key-value pairs are.</li>
<li>Reshape a data frame from long to wide format and back with the
<code>pivot_wider</code> and <code>pivot_longer</code> commands from the
<strong><code>tidyr</code></strong> package.</li>
<li>Export a data frame to a .csv file.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="data-manipulation-using-dplyr-and-tidyr">Data manipulation using <strong><code>dplyr</code></strong> and
<strong><code>tidyr</code></strong>
<a class="anchor" aria-label="anchor" href="#data-manipulation-using-dplyr-and-tidyr"></a>
</h1>
<p>Bracket subsetting is handy, but it can be cumbersome and difficult
to read, especially for complicated operations. Enter
<strong><code>dplyr</code></strong>. <strong><code>dplyr</code></strong>
is a package for helping with tabular data manipulation. It pairs nicely
with <strong><code>tidyr</code></strong> which enables you to swiftly
convert between different data formats for plotting and analysis.</p>
<p>The <strong><code>tidyverse</code></strong> package is an
“umbrella-package” that installs <strong><code>tidyr</code></strong>,
<strong><code>dplyr</code></strong>, and several other useful packages
for data analysis, such as <strong><code>ggplot2</code></strong>,
<strong><code>tibble</code></strong>, etc.</p>
<p>The <strong><code>tidyverse</code></strong> package tries to address
3 common issues that arise when doing data analysis in R:</p>
<ol style="list-style-type: decimal">
<li>The results from a base R function sometimes depend on the type of
data.</li>
<li>R expressions are used in a non standard way, which can be confusing
for new learners.</li>
<li>The existence of hidden arguments having default operations that new
learners are not aware of.</li>
</ol>
<p>You should already have installed and loaded the
<strong><code>tidyverse</code></strong> package. If you haven’t already
done so, you can type <code>install.packages("tidyverse")</code>
straight into the console. Then, type <code><a href="https://tidyverse.tidyverse.org" class="external-link">library(tidyverse)</a></code> to
load the package.</p>
<div class="section level2">
<h2 id="what-are-dplyr-and-tidyr">What are <strong><code>dplyr</code></strong> and
<strong><code>tidyr</code></strong>?<a class="anchor" aria-label="anchor" href="#what-are-dplyr-and-tidyr"></a>
</h2>
<p>The package <strong><code>dplyr</code></strong> provides helper tools
for the most common data manipulation tasks. It is built to work
directly with data frames, with many common tasks optimized by being
written in a compiled language (C++). An additional feature is the
ability to work directly with data stored in an external database. The
benefits of doing this are that the data can be managed natively in a
relational database, queries can be conducted on that database, and only
the results of the query are returned.</p>
<p>This addresses a common problem with R in that all operations are
conducted in-memory and thus the amount of data you can work with is
limited by available memory. The database connections essentially remove
that limitation in that you can connect to a database of many hundreds
of GB, conduct queries on it directly, and pull back into R only what
you need for analysis.</p>
<p>The package <strong><code>tidyr</code></strong> addresses the common
problem of wanting to reshape your data for plotting and usage by
different R functions. For example, sometimes we want data sets where we
have one row per measurement. Other times we want a data frame where
each measurement type has its own column, and rows are instead more
aggregated groups (e.g., a time period, an experimental unit like a plot
or a batch number). Moving back and forth between these formats is
non-trivial, and <strong><code>tidyr</code></strong> gives you tools for
this and more sophisticated data manipulation.</p>
<p>To learn more about <strong><code>dplyr</code></strong> and
<strong><code>tidyr</code></strong> after the workshop, you may want to
check out this <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf" class="external-link">handy
data transformation with <strong><code>dplyr</code></strong>
cheatsheet</a> and this <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-import.pdf" class="external-link">one
about <strong><code>tidyr</code></strong></a>.</p>
<p>As before, we’ll read in our data using the <code>read_csv()</code>
function from the tidyverse package
<strong><code>readr</code></strong>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data_raw/portal_data_joined.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; Rows: 34786 Columns: 13</span></span>
<span><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Delimiter: ","</span></span>
<span><span class="co">#&gt; chr (6): species_id, sex, genus, species, taxa, plot_type</span></span>
<span><span class="co">#&gt; dbl (7): record_id, month, day, year, plot_id, hindfoot_length, weight</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## inspect the data</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## preview the data</span></span>
<span><span class="fu">view</span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span></span></code></pre>
</div>
<p>Next, we’re going to learn some of the most common
<strong><code>dplyr</code></strong> functions:</p>
<ul>
<li>
<code>select()</code>: subset columns</li>
<li>
<code>filter()</code>: subset rows on conditions</li>
<li>
<code>mutate()</code>: create new columns by using information from
other columns</li>
<li>
<code>group_by()</code> and <code>summarize()</code>: create summary
statistics on grouped data</li>
<li>
<code>arrange()</code>: sort results</li>
<li>
<code>count()</code>: count discrete values</li>
</ul>
</div>
<div class="section level2">
<h2 id="selecting-columns-and-filtering-rows">Selecting columns and filtering rows<a class="anchor" aria-label="anchor" href="#selecting-columns-and-filtering-rows"></a>
</h2>
<p>To select columns of a data frame, use <code>select()</code>. The
first argument to this function is the data frame
(<code>surveys</code>), and the subsequent arguments are the columns to
keep.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">select</span><span class="op">(</span><span class="va">surveys</span>, <span class="va">plot_id</span>, <span class="va">species_id</span>, <span class="va">weight</span><span class="op">)</span></span></code></pre>
</div>
<p>To select all columns <em>except</em> certain ones, put a “-” in
front of the variable to exclude it.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">select</span><span class="op">(</span><span class="va">surveys</span>, <span class="op">-</span><span class="va">record_id</span>, <span class="op">-</span><span class="va">species_id</span><span class="op">)</span></span></code></pre>
</div>
<p>This will select all the variables in <code>surveys</code> except
<code>record_id</code> and <code>species_id</code>.</p>
<p>To choose rows based on a specific criterion, use
<code>filter()</code>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">filter</span><span class="op">(</span><span class="va">surveys</span>, <span class="va">year</span> <span class="op">==</span> <span class="fl">1995</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="pipes">Pipes<a class="anchor" aria-label="anchor" href="#pipes"></a>
</h2>
<p>What if you want to select and filter at the same time? There are
three ways to do this: use intermediate steps, nested functions, or
pipes.</p>
<p>With intermediate steps, you create a temporary data frame and use
that as input to the next function, like this:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys2</span> <span class="op">&lt;-</span> <span class="fu">filter</span><span class="op">(</span><span class="va">surveys</span>, <span class="va">weight</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">surveys_sml</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">surveys2</span>, <span class="va">species_id</span>, <span class="va">sex</span>, <span class="va">weight</span><span class="op">)</span></span></code></pre>
</div>
<p>This is readable, but can clutter up your workspace with lots of
objects that you have to name individually. With multiple steps, that
can be hard to keep track of.</p>
<p>You can also nest functions (i.e. one function inside of another),
like this:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_sml</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="fu">filter</span><span class="op">(</span><span class="va">surveys</span>, <span class="va">weight</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span>, <span class="va">species_id</span>, <span class="va">sex</span>, <span class="va">weight</span><span class="op">)</span></span></code></pre>
</div>
<p>This is handy, but can be difficult to read if too many functions are
nested, as R evaluates the expression from the inside out (in this case,
filtering, then selecting).</p>
<p>The last option, <em>pipes</em>, are a recent addition to R. Pipes
let you take the output of one function and send it directly to the
next, which is useful when you need to do many things to the same
dataset. Pipes in R look like <code>%&gt;%</code> and are made available
via the <strong><code>magrittr</code></strong> package, installed
automatically with <strong><code>dplyr</code></strong>. If you use
RStudio, you can type the pipe with <kbd>Ctrl</kbd></p>
<ul>
<li>
<kbd>Shift</kbd> + <kbd>M</kbd> if you have a PC or <kbd>Cmd</kbd> +
<kbd>Shift</kbd> + <kbd>M</kbd> if you have a Mac.</li>
</ul>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">weight</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span>, <span class="va">weight</span><span class="op">)</span></span></code></pre>
</div>
<p>In the above code, we use the pipe to send the <code>surveys</code>
dataset first through <code>filter()</code> to keep rows where
<code>weight</code> is less than 5, then through <code>select()</code>
to keep only the <code>species_id</code>, <code>sex</code>, and
<code>weight</code> columns. Since <code>%&gt;%</code> takes the object
on its left and passes it as the first argument to the function on its
right, we don’t need to explicitly include the data frame as an argument
to the <code>filter()</code> and <code>select()</code> functions any
more.</p>
<p>Some may find it helpful to read the pipe like the word “then.” For
instance, in the example above, we took the data frame
<code>surveys</code>, <em>then</em> we <code>filter</code>ed for rows
with <code>weight &lt; 5</code>, <em>then</em> we <code>select</code>ed
columns <code>species_id</code>, <code>sex</code>, and
<code>weight</code>. The <strong><code>dplyr</code></strong> functions
by themselves are somewhat simple, but by combining them into linear
workflows with the pipe we can accomplish more complex manipulations of
data frames.</p>
<p>If we want to create a new object with this smaller version of the
data, we can assign it a new name:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_sml</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">weight</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span>, <span class="va">weight</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surveys_sml</span></span></code></pre>
</div>
<p>Note that the final data frame is the leftmost part of this
expression.</p>
<div id="challenge" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge"></a>
</h3>
<div class="callout-content">
<p>Using pipes, subset the <code>surveys</code> data to include animals
collected before 1995 and retain only the columns <code>year</code>,
<code>sex</code>, and <code>weight</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">&lt;</span> <span class="fl">1995</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">sex</span>, <span class="va">weight</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="mutate">Mutate<a class="anchor" aria-label="anchor" href="#mutate"></a>
</h3>
<p>Frequently you’ll want to create new columns based on the values in
existing columns, for example to do unit conversions, or to find the
ratio of values in two columns. For this we’ll use
<code>mutate()</code>.</p>
<p>To create a new column of weight in kg:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>weight_kg <span class="op">=</span> <span class="va">weight</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre>
</div>
<p>You can also create a second new column based on the first new column
within the same call of <code>mutate()</code>:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>weight_kg <span class="op">=</span> <span class="va">weight</span> <span class="op">/</span> <span class="fl">1000</span>,</span>
<span>         weight_lb <span class="op">=</span> <span class="va">weight_kg</span> <span class="op">*</span> <span class="fl">2.2</span><span class="op">)</span></span></code></pre>
</div>
<p>If this runs off your screen and you just want to see the first few
rows, you can use a pipe to view the <code>head()</code> of the data.
(Pipes work with non-<strong><code>dplyr</code></strong> functions, too,
as long as the <strong><code>dplyr</code></strong> or
<code>magrittr</code> package is loaded).</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>weight_kg <span class="op">=</span> <span class="va">weight</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">head</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>The first few rows of the output are full of <code>NA</code>s, so if
we wanted to remove those we could insert a <code>filter()</code> in the
chain:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>weight_kg <span class="op">=</span> <span class="va">weight</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">head</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><code>is.na()</code> is a function that determines whether something
is an <code>NA</code>. The <code>!</code> symbol negates the result, so
we’re asking for every row where weight <em>is not</em> an
<code>NA</code>.</p>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>Create a new data frame from the <code>surveys</code> data that meets
the following criteria: contains only the <code>species_id</code> column
and a new column called <code>hindfoot_cm</code> containing the
<code>hindfoot_length</code> values (currently in mm) converted to
centimeters. In this <code>hindfoot_cm</code> column, there are no
<code>NA</code>s and all values are less than 3.</p>
<p><strong>Hint</strong>: think about how the commands should be ordered
to produce this data frame!</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_hindfoot_cm</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">hindfoot_length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>hindfoot_cm <span class="op">=</span> <span class="va">hindfoot_length</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">hindfoot_cm</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">species_id</span>, <span class="va">hindfoot_cm</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="split-apply-combine-data-analysis-and-the-summarize-function">Split-apply-combine data analysis and the <code>summarize()</code>
function<a class="anchor" aria-label="anchor" href="#split-apply-combine-data-analysis-and-the-summarize-function"></a>
</h3>
<p>Many data analysis tasks can be approached using the
<em>split-apply-combine</em> paradigm: split the data into groups, apply
some analysis to each group, and then combine the results. Key functions
of <strong><code>dplyr</code></strong> for this workflow are
<code>group_by()</code> and <code>summarize()</code>.</p>
<div class="section level4">
<h4 id="the-group_by-and-summarize-functions">The <code>group_by()</code> and <code>summarize()</code>
functions<a class="anchor" aria-label="anchor" href="#the-group_by-and-summarize-functions"></a>
</h4>
<p><code>group_by()</code> is often used together with
<code>summarize()</code>, which collapses each group into a single-row
summary of that group. <code>group_by()</code> takes as arguments the
column names that contain the <strong>categorical</strong> variables for
which you want to calculate the summary statistics. So to compute the
mean <code>weight</code> by sex:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">weight</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>You may also have noticed that the output from these calls doesn’t
run off the screen anymore. It’s one of the advantages of
<code>tbl_df</code> over data frame.</p>
<p>You can also group by multiple columns:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sex</span>, <span class="va">species_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">weight</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tail</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; `summarise()` has grouped output by 'sex'. You can override using the `.groups`</span></span>
<span><span class="co">#&gt; argument.</span></span></code></pre>
</div>
<p>Here, we used <code>tail()</code> to look at the last six rows of our
summary. Before, we had used <code>head()</code> to look at the first
six rows. We can see that the <code>sex</code> column contains
<code>NA</code> values because some animals had escaped before their sex
and body weights could be determined. The resulting
<code>mean_weight</code> column does not contain <code>NA</code> but
<code>NaN</code> (which refers to “Not a Number”) because
<code>mean()</code> was called on a vector of <code>NA</code> values
while at the same time setting <code>na.rm = TRUE</code>. To avoid this,
we can remove the missing values for weight before we attempt to
calculate the summary statistics on weight. Because the missing values
are removed first, we can omit <code>na.rm = TRUE</code> when computing
the mean:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sex</span>, <span class="va">species_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; `summarise()` has grouped output by 'sex'. You can override using the `.groups`</span></span>
<span><span class="co">#&gt; argument.</span></span></code></pre>
</div>
<p>Here, again, the output from these calls doesn’t run off the screen
anymore. If you want to display more data, you can use the
<code>print()</code> function at the end of your chain with the argument
<code>n</code> specifying the number of rows to display:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sex</span>, <span class="va">species_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">print</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; `summarise()` has grouped output by 'sex'. You can override using the `.groups`</span></span>
<span><span class="co">#&gt; argument.</span></span></code></pre>
</div>
<p>Once the data are grouped, you can also summarize multiple variables
at the same time (and not necessarily on the same variable). For
instance, we could add a column indicating the minimum weight for each
species for each sex:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sex</span>, <span class="va">species_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>,</span>
<span>            min_weight <span class="op">=</span> <span class="fu">min</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; `summarise()` has grouped output by 'sex'. You can override using the `.groups`</span></span>
<span><span class="co">#&gt; argument.</span></span></code></pre>
</div>
<p>It is sometimes useful to rearrange the result of a query to inspect
the values. For instance, we can sort on <code>min_weight</code> to put
the lighter species first:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sex</span>, <span class="va">species_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>,</span>
<span>            min_weight <span class="op">=</span> <span class="fu">min</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">min_weight</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; `summarise()` has grouped output by 'sex'. You can override using the `.groups`</span></span>
<span><span class="co">#&gt; argument.</span></span></code></pre>
</div>
<p>To sort in descending order, we need to add the <code>desc()</code>
function. If we want to sort the results by decreasing order of mean
weight:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sex</span>, <span class="va">species_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>,</span>
<span>            min_weight <span class="op">=</span> <span class="fu">min</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">mean_weight</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; `summarise()` has grouped output by 'sex'. You can override using the `.groups`</span></span>
<span><span class="co">#&gt; argument.</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="counting">Counting<a class="anchor" aria-label="anchor" href="#counting"></a>
</h4>
<p>When working with data, we often want to know the number of
observations found for each factor or combination of factors. For this
task, <strong><code>dplyr</code></strong> provides <code>count()</code>.
For example, if we wanted to count the number of rows of data for each
sex, we would do:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<p>The <code>count()</code> function is shorthand for something we’ve
already seen: grouping by a variable, and summarizing it by counting the
number of observations in that group. In other words,
<code>surveys %&gt;% count()</code> is equivalent to:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>count <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>For convenience, <code>count()</code> provides the <code>sort</code>
argument:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="va">sex</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Previous example shows the use of <code>count()</code> to count the
number of rows/observations for <em>one</em> factor (i.e.,
<code>sex</code>). If we wanted to count <em>combination of
factors</em>, such as <code>sex</code> and <code>species</code>, we
would specify the first and the second factor as the arguments of
<code>count()</code>:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">sex</span>, <span class="va">species</span><span class="op">)</span></span></code></pre>
</div>
<p>With the above code, we can proceed with <code>arrange()</code> to
sort the table according to a number of criteria so that we have a
better comparison. For instance, we might want to arrange the table
above in (i) an alphabetical order of the levels of the species and (ii)
in descending order of the count:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">sex</span>, <span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">species</span>, <span class="fu">desc</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>From the table above, we may learn that, for instance, there are 75
observations of the <em>albigula</em> species that are not specified for
its sex (i.e. <code>NA</code>).</p>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>How many animals were caught in each <code>plot_type</code>
surveyed?</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="va">plot_type</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge<em>(continued)</em><a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<ol start="2" style="list-style-type: decimal">
<li>Use <code>group_by()</code> and <code>summarize()</code> to find the
mean, min, and max hindfoot length for each species (using
<code>species_id</code>). Also add the number of observations (hint: see
<code>?n</code>).</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">hindfoot_length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">species_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span></span>
<span>        mean_hindfoot_length <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">hindfoot_length</span><span class="op">)</span>,</span>
<span>        min_hindfoot_length <span class="op">=</span> <span class="fu">min</span><span class="op">(</span><span class="va">hindfoot_length</span><span class="op">)</span>,</span>
<span>        max_hindfoot_length <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">hindfoot_length</span><span class="op">)</span>,</span>
<span>        n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge<em>(continued)</em><a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<ol start="3" style="list-style-type: decimal">
<li>What was the heaviest animal measured in each year? Return the
columns <code>year</code>, <code>genus</code>, <code>species_id</code>,
and <code>weight</code>.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">Show me the solution</h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">weight</span> <span class="op">==</span> <span class="fu">max</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">genus</span>, <span class="va">species</span>, <span class="va">weight</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="va">year</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="reshaping-with-pivot_longer-and-pivot_wider">Reshaping with pivot_longer and pivot_wider<a class="anchor" aria-label="anchor" href="#reshaping-with-pivot_longer-and-pivot_wider"></a>
</h3>
<p>In the <a href="https://datacarpentry.org/spreadsheet-ecology-lesson/01-format-data/" class="external-link">spreadsheet
lesson</a>, we discussed how to structure our data leading to the four
rules defining a tidy dataset:</p>
<ol style="list-style-type: decimal">
<li>Each variable has its own column</li>
<li>Each observation has its own row</li>
<li>Each value must have its own cell</li>
<li>Each type of observational unit forms a table</li>
</ol>
<p>Here we examine the fourth rule: Each type of observational unit
forms a table.</p>
<p>In <code>surveys</code>, the rows of <code>surveys</code> contain the
values of variables associated with each record (the unit), values such
as the weight or sex of each animal associated with each record. What if
instead of comparing records, we wanted to compare the different mean
weight of each genus between plots? (Ignoring <code>plot_type</code> for
simplicity).</p>
<p>We’d need to create a new table where each row (the unit) is
comprised of values of variables associated with each plot. In practical
terms this means the values in <code>genus</code> would become the names
of column variables and the cells would contain the values of the mean
weight observed on each plot.</p>
<p>Having created a new table, it is therefore straightforward to
explore the relationship between the weight of different genera within,
and between, the plots. The key point here is that we are still
following a tidy data structure, but we have <strong>reshaped</strong>
the data according to the observations of interest: average genus weight
per plot instead of recordings per date.</p>
<p>The opposite transformation would be to transform column names into
values of a variable.</p>
<p>We can do both these of transformations with two <code>tidyr</code>
functions, <code>pivot_wider()</code> and
<code>pivot_longer()</code>.</p>
<p>These may sound like dramatically different data layouts, but there
are some tools that make transitions between these layouts more
straightforward than you might think! The gif below shows how these two
formats relate to each other, and gives you an idea of how we can use R
to shift from one format to the other.</p>
<figure><img src="../fig/tidyr-pivot_wider_longer.gif" class="figure mx-auto d-block"></figure><div class="section level4">
<h4 id="pivoting-from-long-to-wide-format">Pivoting from long to wide format<a class="anchor" aria-label="anchor" href="#pivoting-from-long-to-wide-format"></a>
</h4>
<p><code>pivot_wider()</code> takes three principal arguments:</p>
<ol style="list-style-type: decimal">
<li>the data</li>
<li>the <em>names_from</em> column variable whose values will become new
column names.</li>
<li>the <em>values_from</em> column variable whose values will fill the
new column variables.</li>
</ol>
<p>Further arguments include <code>values_fill</code> which, if set,
fills in missing values with the value provided.</p>
<p>Let’s use <code>pivot_wider()</code> to transform surveys to find the
mean weight of each genus in each plot over the entire survey period. We
use <code>filter()</code>, <code>group_by()</code> and
<code>summarize()</code> to filter our observations and variables of
interest, and create a new variable for the
<code>mean_weight</code>.</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_gw</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">plot_id</span>, <span class="va">genus</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_weight <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; `summarise()` has grouped output by 'plot_id'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">str</span><span class="op">(</span><span class="va">surveys_gw</span><span class="op">)</span></span></code></pre>
</div>
<p>This yields <code>surveys_gw</code> where the observations for each
plot are distributed across multiple rows, 196 observations of 3
variables. Using <code>pivot_wider()</code> with the names from
<code>genus</code> and with values from <code>mean_weight</code> this
becomes 24 observations of 11 variables, one row for each plot.</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_wide</span> <span class="op">&lt;-</span> <span class="va">surveys_gw</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">genus</span>, values_from <span class="op">=</span> <span class="va">mean_weight</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">surveys_wide</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/pivot_wider_graphic.png" class="figure mx-auto d-block"></figure><p>We could now plot comparisons between the weight of genera (one is
called a genus, multiple are called genera) in different plots, although
we may wish to fill in the missing values first.</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_gw</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">genus</span>, values_from <span class="op">=</span> <span class="va">mean_weight</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">head</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="pivoting-from-wide-to-long-format">Pivoting from wide to long format<a class="anchor" aria-label="anchor" href="#pivoting-from-wide-to-long-format"></a>
</h4>
<p>The opposing situation could occur if we had been provided with data
in the form of <code>surveys_wide</code>, where the genus names are
column names, but we wish to treat them as values of a genus variable
instead.</p>
<p>In this situation we are reshaping the column names and turning them
into a pair of new variables. One variable represents the column names
as values, and the other variable contains the values previously
associated with the column names.</p>
<p><code>pivot_longer()</code> takes four principal arguments:</p>
<ol style="list-style-type: decimal">
<li>the data</li>
<li>the <em>names_to</em> column variable we wish to create from column
names.</li>
<li>the <em>values_to</em> column variable we wish to create and fill
with values.</li>
<li>
<em>cols</em> are the name of the columns we use to make this pivot
(or to drop).</li>
</ol>
<p>To recreate <code>surveys_gw</code> from <code>surveys_wide</code> we
would create a names variable called <code>genus</code> and value
variable called <code>mean_weight</code>.</p>
<p>In pivoting longer, we also need to specify what columns to reshape.
If the columns are directly adjacent as they are here, we don’t even
need to list the all out: we can just use the <code>:</code>
operator!</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_long</span> <span class="op">&lt;-</span> <span class="va">surveys_wide</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"genus"</span>, values_to <span class="op">=</span> <span class="st">"mean_weight"</span>, cols <span class="op">=</span> <span class="op">-</span><span class="va">plot_id</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">surveys_long</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/pivot_longer_graphic.png" class="figure mx-auto d-block"></figure><p>Note that now the <code>NA</code> genera are included in the long
format data frame. Pivoting wider and then longer can be a useful way to
balance out a dataset so that every replicate has the same
composition</p>
<p>We could also have used a specification for what columns to exclude.
In this example, we will use all columns <em>except</em>
<code>plot_id</code> for the names variable. By using the minus sign in
the <code>cols</code> argument, we omit <code>plot_id</code> from being
reshaped</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_wide</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"genus"</span>, values_to <span class="op">=</span> <span class="st">"mean_weight"</span>, cols <span class="op">=</span> <span class="op">-</span><span class="va">plot_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">head</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div id="challenge-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-3"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li>Reshape the <code>surveys</code> data frame with <code>year</code>
as columns, <code>plot_id</code> as rows, and the number of genera per
plot as the values. You will need to summarize before reshaping, and use
the function <code>n_distinct()</code> to get the number of unique
genera within a particular chunk of data. It’s a powerful function! See
<code>?n_distinct</code> for more.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6">Show me the solution</h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_wide_genera</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">plot_id</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>n_genera <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">year</span>, values_from <span class="op">=</span> <span class="va">n_genera</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; `summarise()` has grouped output by 'plot_id'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">surveys_wide_genera</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge<em>(continued)</em><a class="anchor" aria-label="anchor" href="#challenge-3"></a>
</h3>
<div class="callout-content">
<ol start="2" style="list-style-type: decimal">
<li>Now take that data frame and <code>pivot_longer()</code> it, so each
row is a unique <code>plot_id</code> by <code>year</code>
combination.</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7">Show me the solution</h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" aria-labelledby="headingSolution7" data-bs-parent="#accordionSolution7">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_wide_genera</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"year"</span>, values_to <span class="op">=</span> <span class="st">"n_genera"</span>, cols <span class="op">=</span> <span class="op">-</span><span class="va">plot_id</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-3" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge-3" class="callout-inner">
<h3 class="callout-title">Challenge<em>(continued)</em><a class="anchor" aria-label="anchor" href="#challenge-3"></a>
</h3>
<div class="callout-content">
<ol start="3" style="list-style-type: decimal">
<li>The <code>surveys</code> data set has two measurement columns:
<code>hindfoot_length</code> and <code>weight</code>. This makes it
difficult to do things like look at the relationship between mean values
of each measurement per year in different plot types. Let’s walk through
a common solution for this type of problem. First, use
<code>pivot_longer()</code> to create a dataset where we have a names
column called <code>measurement</code> and a <code>value</code> column
that takes on the value of either <code>hindfoot_length</code> or
<code>weight</code>. <em>Hint</em>: You’ll need to specify which columns
will be part of the reshape.</li>
</ol>
</div>
</div>
</div>
<div class="blockquote">
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8">Show me the solution</h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" aria-labelledby="headingSolution8" data-bs-parent="#accordionSolution8">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_long</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"measurement"</span>, values_to <span class="op">=</span> <span class="st">"value"</span>, cols <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="va">hindfoot_length</span>, <span class="va">weight</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<ol start="4" style="list-style-type: decimal">
<li>With this new data set, calculate the average of each
<code>measurement</code> in each <code>year</code> for each different
<code>plot_type</code>. Then <code>pivot_wider()</code> them into a data
set with a column for <code>hindfoot_length</code> and
<code>weight</code>. <em>Hint</em>: You only need to specify the names
and values columns for <code>pivot_wider()</code>.</li>
</ol>
<div id="accordionSolution9" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution9" aria-expanded="false" aria-controls="collapseSolution9">
  <h4 class="accordion-header" id="headingSolution9">Show me the solution</h4>
</button>
<div id="collapseSolution9" class="accordion-collapse collapse" aria-labelledby="headingSolution9" data-bs-parent="#accordionSolution9">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_long</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">measurement</span>, <span class="va">plot_type</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_value <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">value</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">measurement</span>, values_from <span class="op">=</span> <span class="va">mean_value</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; `summarise()` has grouped output by 'year', 'measurement'. You can override</span></span>
<span><span class="co">#&gt; using the `.groups` argument.</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level1">
<h1 id="exporting-data">Exporting data<a class="anchor" aria-label="anchor" href="#exporting-data"></a>
</h1>
<p>Now that you have learned how to use
<strong><code>dplyr</code></strong> to extract information from or
summarize your raw data, you may want to export these new data sets to
share them with your collaborators or for archival.</p>
<p>Similar to the <code>read_csv()</code> function used for reading CSV
files into R, there is a <code>write_csv()</code> function that
generates CSV files from data frames.</p>
<p>Before using <code>write_csv()</code>, we are going to create a new
folder, <code>data</code>, in our working directory that will store this
generated dataset. We don’t want to write generated datasets in the same
directory as our raw data. It’s good practice to keep them separate. The
<code>data_raw</code> folder should only contain the raw, unaltered
data, and should be left alone to make sure we don’t delete or modify
it. In contrast, our script will generate the contents of the
<code>data</code> directory, so even if the files it contains are
deleted, we can always re-generate them.</p>
<p>In preparation for our next lesson on plotting, we are going to
prepare a cleaned up version of the data set that doesn’t include any
missing data.</p>
<p>Let’s start by removing observations of animals for which
<code>weight</code> and <code>hindfoot_length</code> are missing, or the
<code>sex</code> has not been determined:</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_complete</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>,           <span class="co"># remove missing weight</span></span>
<span>         <span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">hindfoot_length</span><span class="op">)</span>,  <span class="co"># remove missing hindfoot_length</span></span>
<span>         <span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span>                <span class="co"># remove missing sex</span></span></code></pre>
</div>
<p>Because we are interested in plotting how species abundances have
changed through time, we are also going to remove observations for rare
species (i.e., that have been observed less than 50 times). We will do
this in two steps: first we are going to create a data set that counts
how often each species has been observed, and filter out the rare
species; then, we will extract only the observations for these more
common species:</p>
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extract the most common species_id</span></span>
<span><span class="va">species_counts</span> <span class="op">&lt;-</span> <span class="va">surveys_complete</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="va">species_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Only keep the most common species</span></span>
<span><span class="va">surveys_complete</span> <span class="op">&lt;-</span> <span class="va">surveys_complete</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">species_id</span> <span class="op">%in%</span> <span class="va">species_counts</span><span class="op">$</span><span class="va">species_id</span><span class="op">)</span></span></code></pre>
</div>
<p>To make sure that everyone has the same data set, check that
<code>surveys_complete</code> has 30463 rows and 13 columns by typing
<code>dim(surveys_complete)</code>.</p>
<p>Now that our data set is ready, we can save it as a CSV file in our
<code>data</code> folder.</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write_csv</span><span class="op">(</span><span class="va">surveys_complete</span>, file <span class="op">=</span> <span class="st">"data/surveys_complete.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use the <code>dplyr</code> package to manipulate data frames.</li>
<li>Use <code>select()</code> to choose variables from a data
frame.</li>
<li>Use <code>filter()</code> to choose data based on values.</li>
<li>Use <code>mutate()</code> to create new variables.</li>
<li>Use <code>group_by()</code> and <code>summarize()</code> to work
with subsets of data.</li>
</ul>
</div>
</div>
</div>
</div></section><section id="aio-04-visualization-ggplot2"><p>Content from <a href="04-visualization-ggplot2.html">Data visualization with ggplot2</a></p>
<hr>
<p>Last updated on 2024-01-31 |
        
        <a href="https://github.com/datacarpentry/R-ecology-lesson/edit/main/episodes/04-visualization-ggplot2.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<hr>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you make plots using R?</li>
<li>How do you customize and modify plots?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Produce scatter plots, boxplots, and time series plots using
ggplot.</li>
<li>Set universal plot settings.</li>
<li>Describe what faceting is and apply faceting in ggplot.</li>
<li>Modify the aesthetics of an existing ggplot plot (including axis
labels and color).</li>
<li>Build complex and customized plots from data in a data frame.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<hr>
<p>We start by loading the required packages.
<strong><code>ggplot2</code></strong> is included in the
<strong><code>tidyverse</code></strong> package.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<p>If not still in the workspace, load the data we saved in the previous
lesson.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_complete</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/surveys_complete.csv"</span><span class="op">)</span></span></code></pre>
</div>
<section id="plotting-with-ggplot2"><h2 class="section-heading">Plotting with <strong><code>ggplot2</code></strong><a class="anchor" aria-label="anchor" href="#plotting-with-ggplot2"></a>
</h2>
<hr class="half-width">
<p><strong><code>ggplot2</code></strong> is a plotting package that
provides helpful commands to create complex plots from data in a data
frame. It provides a more programmatic interface for specifying what
variables to plot, how they are displayed, and general visual
properties. Therefore, we only need minimal changes if the underlying
data change or if we decide to change from a bar plot to a scatterplot.
This helps in creating publication quality plots with minimal amounts of
adjustments and tweaking.</p>
<p><strong><code>ggplot2</code></strong> refers to the name of the
package itself. When using the package we use the function
<strong><code>ggplot()</code></strong> to generate the plots, and so
references to using the function will be referred to as
<strong><code>ggplot()</code></strong> and the package as a whole as
<strong><code>ggplot2</code></strong></p>
<p><strong><code>ggplot2</code></strong> plots work best with data in
the ‘long’ format, i.e., a column for every variable, and a row for
every observation. Well-structured data will save you lots of time when
making figures with <strong><code>ggplot2</code></strong></p>
<p>ggplot graphics are built layer by layer by adding new elements.
Adding layers in this fashion allows for extensive flexibility and
customization of plots.</p>
<p>To build a ggplot, we will use the following basic template that can
be used for different types of plots:</p>
<pre><code>ggplot(data = &lt;DATA&gt;, mapping = aes(&lt;MAPPINGS&gt;)) +  &lt;GEOM_FUNCTION&gt;()</code></pre>
<ul>
<li>use the <code>ggplot()</code> function and bind the plot to a
specific data frame using the <code>data</code> argument</li>
</ul>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveys_complete</span><span class="op">)</span></span></code></pre>
</div>
<ul>
<li>define an aesthetic mapping (using the aesthetic (<code>aes</code>)
function), by selecting the variables to be plotted and specifying how
to present them in the graph, e.g., as x/y positions or characteristics
such as size, shape, color, etc.</li>
</ul>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveys_complete</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight</span>, y <span class="op">=</span> <span class="va">hindfoot_length</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<ul>
<li>
<p>add ‘geoms’ – graphical representations of the data in the plot
(points, lines, bars). <strong><code>ggplot2</code></strong> offers many
different geoms; we will use some common ones today, including:</p>
<ul>
<li>
<code>geom_point()</code> for scatter plots, dot plots, etc.</li>
<li>
<code>geom_boxplot()</code> for, well, boxplots!</li>
<li>
<code>geom_line()</code> for trend lines, time series, etc.</li>
</ul>
</li>
</ul>
<p>To add a geom to the plot use <code>+</code> operator. Because we
have two continuous variables, let’s use <code>geom_point()</code>
first:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveys_complete</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight</span>, y <span class="op">=</span> <span class="va">hindfoot_length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-first-ggplot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The <code>+</code> in the <strong><code>ggplot2</code></strong>
package is particularly useful because it allows you to modify existing
<code>ggplot</code> objects. This means you can easily set up plot
“templates” and conveniently explore different types of plots, so the
above plot can also be generated with code like this:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign plot to a variable</span></span>
<span><span class="va">surveys_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveys_complete</span>,</span>
<span>                       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight</span>, y <span class="op">=</span> <span class="va">hindfoot_length</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Draw the plot</span></span>
<span><span class="va">surveys_plot</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><strong>Notes</strong></p>
<ul>
<li>Anything you put in the <code>ggplot()</code> function can be seen
by any geom layers that you add (i.e., these are universal plot
settings). This includes the x- and y-axis you set up in
<code>aes()</code>.</li>
<li>You can also specify aesthetics for a given geom independently of
the aesthetics defined globally in the <code>ggplot()</code>
function.</li>
<li>The <code>+</code> sign used to add layers must be placed at the end
of each line containing a layer. If, instead, the <code>+</code> sign is
added in the line before the other layer,
<strong><code>ggplot2</code></strong> will not add the new layer and
will return an error message.</li>
<li>You may notice that we sometimes reference ‘ggplot2’ and sometimes
‘ggplot’. To clarify, ‘ggplot2’ is the name of the most recent version
of the package. However, any time we call the function itself, it’s just
called ‘ggplot’.</li>
<li>The previous version of the <strong><code>ggplot2</code></strong>
package, called <strong><code>ggplot</code></strong>, which also
contained the <code>ggplot()</code> function is now unsupported and has
been removed from CRAN in order to reduce accidental installations and
further confusion.</li>
</ul>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This is the correct syntax for adding layers</span></span>
<span><span class="va">surveys_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This will not add the new layer and will return an error message</span></span>
<span><span class="va">surveys_plot</span></span>
<span>  <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div id="challenge-optional" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge-optional" class="callout-inner">
<h3 class="callout-title">Challenge (optional)<a class="anchor" aria-label="anchor" href="#challenge-optional"></a>
</h3>
<div class="callout-content">
<p>Scatter plots can be useful exploratory tools for small datasets. For
data sets with large numbers of observations, such as the
<code>surveys_complete</code> data set, overplotting of points can be a
limitation of scatter plots. One strategy for handling such settings is
to use hexagonal binning of observations. The plot space is tessellated
into hexagons. Each hexagon is assigned a color based on the number of
observations that fall within its boundaries. To use hexagonal binning
with <strong><code>ggplot2</code></strong>, first install the R package
<code>hexbin</code> from CRAN:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"hexbin"</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">hexbin</span><span class="op">)</span></span></code></pre>
</div>
<p>Then use the <code>geom_hex()</code> function:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys_plot</span> <span class="op">+</span></span>
<span> <span class="fu">geom_hex</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<ul>
<li>What are the relative strengths and weaknesses of a hexagonal bin
plot compared to a scatter plot? Examine the above scatter plot and
compare it with the hexagonal bin plot that you created.</li>
</ul>
</div>
</div>
</div>
</section><section id="building-your-plots-iteratively"><h2 class="section-heading">Building your plots iteratively<a class="anchor" aria-label="anchor" href="#building-your-plots-iteratively"></a>
</h2>
<hr class="half-width">
<p>Building plots with <strong><code>ggplot2</code></strong> is
typically an iterative process. We start by defining the dataset we’ll
use, lay out the axes, and choose a geom:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveys_complete</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight</span>, y <span class="op">=</span> <span class="va">hindfoot_length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-create-ggplot-object-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Then, we start modifying this plot to extract more information from
it. For instance, we can add transparency (<code>alpha</code>) to avoid
overplotting:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveys_complete</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight</span>, y <span class="op">=</span> <span class="va">hindfoot_length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-adding-transparency-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can also add colors for all the points:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveys_complete</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight</span>, y <span class="op">=</span> <span class="va">hindfoot_length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-adding-colors-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Or to color each species in the plot differently, you could use a
vector as an input to the argument <strong>color</strong>.
<strong><code>ggplot2</code></strong> will provide a different color
corresponding to different values in the vector. Here is an example
where we color with <strong><code>species_id</code></strong>:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveys_complete</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">weight</span>, y <span class="op">=</span> <span class="va">hindfoot_length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span>, <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">species_id</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-color-by-species-1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge"></a>
</h3>
<div class="callout-content">
<p>Use what you just learned to create a scatter plot of
<code>weight</code> over <code>species_id</code> with the plot types
showing in different colors. Is this a good way to show this type of
data?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveys_complete</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species_id</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">plot_type</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-scatter-challenge-answer-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section id="boxplot"><h2 class="section-heading">Boxplot<a class="anchor" aria-label="anchor" href="#boxplot"></a>
</h2>
<hr class="half-width">
<p>We can use boxplots to visualize the distribution of weight within
each species:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveys_complete</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species_id</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-boxplot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>By adding points to the boxplot, we can have a better idea of the
number of measurements and of their distribution. Because the boxplot
will show the outliers by default these points will be plotted twice –
by <code>geom_boxplot</code> and <code>geom_jitter</code>. To avoid this
we must specify that no outliers should be added to the boxplot by
specifying <code>outlier.shape = NA</code>.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveys_complete</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species_id</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span>outlier.shape <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>, color <span class="op">=</span> <span class="st">"tomato"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-boxplot-with-points-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Notice how the boxplot layer is behind the jitter layer? What do you
need to change in the code to put the boxplot in front of the points
such that it’s not hidden?</p>
<div id="challenges" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenges" class="callout-inner">
<h3 class="callout-title">Challenges<a class="anchor" aria-label="anchor" href="#challenges"></a>
</h3>
<div class="callout-content">
<p>Boxplots are useful summaries, but hide the <em>shape</em> of the
distribution. For example, if there is a bimodal distribution, it would
not be observed with a boxplot. An alternative to the boxplot is the
violin plot (sometimes known as a beanplot), where the shape (of the
density of points) is drawn.</p>
<ul>
<li>Replace the box plot with a violin plot; see
<code>geom_violin()</code>.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveys_complete</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species_id</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>, color <span class="op">=</span> <span class="st">"tomato"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_violin</span><span class="op">(</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-unnamed-chunk-9-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="challenges" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenges" class="callout-inner">
<h3 class="callout-title">Challenges<em>(continued)</em><a class="anchor" aria-label="anchor" href="#challenges"></a>
</h3>
<div class="callout-content">
<p>In many types of data, it is important to consider the <em>scale</em>
of the observations. For example, it may be worth changing the scale of
the axis to better distribute the observations in the space of the plot.
Changing the scale of the axes is done similarly to adding/modifying
other components (i.e., by incrementally adding commands). Try making
these modifications:</p>
<ul>
<li>Represent weight on the log<sub>10</sub> scale; see
<code>scale_y_log10()</code>.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3">Show me the solution</h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveys_complete</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species_id</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>, color <span class="op">=</span> <span class="st">"tomato"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_boxplot</span><span class="op">(</span>outlier.shape <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-unnamed-chunk-10-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="challenges" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenges" class="callout-inner">
<h3 class="callout-title">Challenges<em>(continued)</em><a class="anchor" aria-label="anchor" href="#challenges"></a>
</h3>
<div class="callout-content">
<p>So far, we’ve looked at the distribution of weight within species.
Try making a new plot to explore the distribution of another variable
within each species.</p>
<ul>
<li>Create boxplot for <code>hindfoot_length</code>. Overlay the boxplot
layer on a jitter layer to show actual measurements.</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4">Show me the solution</h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveys_complete</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species_id</span>, y <span class="op">=</span> <span class="va">hindfoot_length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span>, color <span class="op">=</span> <span class="st">"tomato"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_boxplot</span><span class="op">(</span>outlier.shape <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-unnamed-chunk-11-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<div id="challenges" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenges" class="callout-inner">
<h3 class="callout-title">Challenges<em>(continued)</em><a class="anchor" aria-label="anchor" href="#challenges"></a>
</h3>
<div class="callout-content">
<ul>
<li>Add color to the data points on your boxplot according to the plot
from which the sample was taken (<code>plot_id</code>).</li>
</ul>
<p>Hint: Check the class for <code>plot_id</code>. Consider changing the
class of <code>plot_id</code> from integer to factor. Why does this
change how R makes the graph?</p>
</div>
</div>
</div>
</section><section id="plotting-time-series-data"><h2 class="section-heading">Plotting time series data<a class="anchor" aria-label="anchor" href="#plotting-time-series-data"></a>
</h2>
<hr class="half-width">
<p>Let’s calculate number of counts per year for each genus. First we
need to group the data and count records within each group:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yearly_counts</span> <span class="op">&lt;-</span> <span class="va">surveys_complete</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">year</span>, <span class="va">genus</span><span class="op">)</span></span></code></pre>
</div>
<p>Timelapse data can be visualized as a line plot with years on the
x-axis and counts on the y-axis:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_counts</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-first-time-series-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Unfortunately, this does not work because we plotted data for all the
genera together. We need to tell ggplot to draw a line for each genus by
modifying the aesthetic function to include
<code>group = genus</code>:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_counts</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span>, group <span class="op">=</span> <span class="va">genus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-time-series-by-species-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We will be able to distinguish genera in the plot if we add colors
(using <code>color</code> also automatically groups the data):</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_counts</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">genus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-time-series-with-colors-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="integrating-the-pipe-operator-with-ggplot2"><h2 class="section-heading">Integrating the pipe operator with ggplot2<a class="anchor" aria-label="anchor" href="#integrating-the-pipe-operator-with-ggplot2"></a>
</h2>
<hr class="half-width">
<p>In the previous lesson, we saw how to use the pipe operator
<code>%&gt;%</code> to use different functions in a sequence and create
a coherent workflow. We can also use the pipe operator to pass the
<code>data</code> argument to the <code>ggplot()</code> function. The
hard part is to remember that to build your ggplot, you need to use
<code>+</code> and not <code>%&gt;%</code>.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yearly_counts</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">genus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-integrating-the-pipe-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The pipe operator can also be used to link data manipulation with
consequent data visualization.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yearly_counts_graph</span> <span class="op">&lt;-</span> <span class="va">surveys_complete</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="va">year</span>, <span class="va">genus</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">genus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">yearly_counts_graph</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-pipes-and-manipulation-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section id="faceting"><h2 class="section-heading">Faceting<a class="anchor" aria-label="anchor" href="#faceting"></a>
</h2>
<hr class="half-width">
<p><code>ggplot</code> has a special technique called <em>faceting</em>
that allows the user to split one plot into multiple plots based on a
factor included in the dataset. We will use it to make a time series
plot for each genus:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_counts</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span>facets <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-first-facet-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Now we would like to split the line in each plot by the sex of each
individual measured. To do that we need to make counts in the data frame
grouped by <code>year</code>, <code>genus</code>, and
<code>sex</code>:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">yearly_sex_counts</span> <span class="op">&lt;-</span> <span class="va">surveys_complete</span> <span class="op">%&gt;%</span></span>
<span>                      <span class="fu">count</span><span class="op">(</span><span class="va">year</span>, <span class="va">genus</span>, <span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<p>We can now make the faceted plot by splitting further by sex using
<code>color</code> (within a single plot):</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_sex_counts</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span>facets <span class="op">=</span>  <span class="fu">vars</span><span class="op">(</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-facet-by-genus-and-sex-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can also facet both by sex and genus:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_sex_counts</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>rows <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span>, cols <span class="op">=</span>  <span class="fu">vars</span><span class="op">(</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-average-weight-time-facet-both-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>You can also organise the panels only by rows (or only by
columns):</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># One column, facet by rows</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_sex_counts</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>rows <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-average-weight-time-facet-sex-rows-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># One row, facet by column</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_sex_counts</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-average-weight-time-facet-sex-columns-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p><strong>Note:</strong> <code>ggplot2</code> before version 3.0.0 used
formulas to specify how plots are faceted. If you encounter
<code>facet_grid</code>/<code>wrap(...)</code> code containing
<code>~</code>, please read <a href="https://ggplot2.tidyverse.org/news/#tidy-evaluation" class="external-link">https://ggplot2.tidyverse.org/news/#tidy-evaluation</a>.</p>
</section><section id="ggplot2-themes"><h2 class="section-heading">
<strong><code>ggplot2</code></strong> themes<a class="anchor" aria-label="anchor" href="#ggplot2-themes"></a>
</h2>
<hr class="half-width">
<p>Usually plots with white background look more readable when printed.
Every single component of a <code>ggplot</code> graph can be customized
using the generic <code>theme()</code> function, as we will see below.
However, there are pre-loaded themes available that change the overall
appearance of the graph without much effort.</p>
<p>For example, we can change our previous graph to have a simpler white
background using the <code>theme_bw()</code> function:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_sex_counts</span>,</span>
<span>        mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-facet-by-species-and-sex-white-bg-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>In addition to <code>theme_bw()</code>, which changes the plot
background to white, <strong><code>ggplot2</code></strong> comes with
several other themes which can be useful to quickly change the look of
your visualization. The complete list of themes is available at <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">https://ggplot2.tidyverse.org/reference/ggtheme.html</a>.
<code>theme_minimal()</code> and <code>theme_light()</code> are popular,
and <code>theme_void()</code> can be useful as a starting point to
create a new hand-crafted theme.</p>
<p>The <a href="https://jrnold.github.io/ggthemes/reference/index.html" class="external-link">ggthemes</a>
package provides a wide variety of options.</p>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>Use what you just learned to create a plot that depicts how the
average weight of each species changes through the years.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5">Show me the solution</h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yearly_weight</span> <span class="op">&lt;-</span> <span class="va">surveys_complete</span> <span class="op">%&gt;%</span></span>
<span>                <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">species_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                 <span class="fu">summarize</span><span class="op">(</span>avg_weight <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; `summarise()` has grouped output by 'year'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_weight</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y<span class="op">=</span><span class="va">avg_weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">species_id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-average-weight-time-series-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section id="customization"><h2 class="section-heading">Customization<a class="anchor" aria-label="anchor" href="#customization"></a>
</h2>
<hr class="half-width">
<p>Take a look at the <a href="https://posit.co/wp-content/uploads/2022/10/data-visualization-1.pdf" class="external-link"><strong><code>ggplot2</code></strong>
cheat sheet</a>, and think of ways you could improve the plot.</p>
<p>Now, let’s change names of axes to something more informative than
‘year’ and ‘n’ and add a title to the figure:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_sex_counts</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Observed genera through time"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Year of observation"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Number of individuals"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-number-species-year-with-right-labels-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The axes have more informative names, but their readability can be
improved by increasing the font size. This can be done with the generic
<code>theme()</code> function:</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_sex_counts</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Observed genera through time"</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Year of observation"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Number of individuals"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>text<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-number-species-year-with-right-labels-xfont-size-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Note that it is also possible to change the fonts of your plots. If
you are on Windows, you may have to install the <a href="https://github.com/wch/extrafont" class="external-link"><strong><code>extrafont</code></strong>
package</a>, and follow the instructions included in the README for this
package.</p>
<p>After our manipulations, you may notice that the values on the x-axis
are still not properly readable. Let’s change the orientation of the
labels and adjust them vertically and horizontally so they don’t
overlap. You can use a 90 degree angle, or experiment to find the
appropriate angle for diagonally oriented labels. We can also modify the
facet label text (<code>strip.text</code>) to italicize the genus
names:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_sex_counts</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Observed genera through time"</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Year of observation"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Number of individuals"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey20"</span>, size <span class="op">=</span> <span class="fl">12</span>, angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                        axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey20"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>                        strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span>,</span>
<span>                        text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-number-species-year-with-theme-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>If you like the changes you created better than the default theme,
you can save them as an object to be able to easily apply them to other
plots you may create:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grey_theme</span> <span class="op">&lt;-</span> <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour<span class="op">=</span><span class="st">"grey20"</span>, size <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                                               angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                               vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey20"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>                    text<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">surveys_complete</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species_id</span>, y <span class="op">=</span> <span class="va">hindfoot_length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">grey_theme</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-number-species-year-with-right-labels-xfont-orientation-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="challenge-2" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<p>With all of this information in hand, please take another five
minutes to either improve one of the plots generated in this exercise or
create a beautiful graph of your own. Use the RStudio <a href="https://posit.co/wp-content/uploads/2022/10/data-visualization-1.pdf" class="external-link"><strong><code>ggplot2</code></strong>
cheat sheet</a> for inspiration.</p>
<p>Here are some ideas:</p>
<ul>
<li>See if you can change the thickness of the lines.</li>
<li>Can you find a way to change the name of the legend? What about its
labels?</li>
<li>Try using a different color palette (see <a href="https://r-graphics.org/chapter-colors" class="external-link">https://r-graphics.org/chapter-colors</a>).</li>
</ul>
</div>
</div>
</div>
</section><section id="arranging-plots"><h2 class="section-heading">Arranging plots<a class="anchor" aria-label="anchor" href="#arranging-plots"></a>
</h2>
<hr class="half-width">
<p>Faceting is a great tool for splitting one plot into multiple plots,
but sometimes you may want to produce a single figure that contains
multiple plots using different variables or even different data frames.
The <strong><code>patchwork</code></strong> package allows us to combine
separate ggplots into a single figure while keeping everything aligned
properly. Like most R packages, we can install <code>patchwork</code>
from CRAN, the R package repository:</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"patchwork"</span><span class="op">)</span></span></code></pre>
</div>
<p>After you have loaded the <code>patchwork</code> package you can use
<code>+</code> to place plots next to each other, <code>/</code> to
arrange them vertically, and <code>plot_layout()</code> to determine how
much space each plot uses:</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">patchwork</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_weight</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveys_complete</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species_id</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Species"</span>, y <span class="op">=</span> <span class="fu">expression</span><span class="op">(</span><span class="va">log</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">(</span><span class="va">Weight</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_count</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_counts</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">genus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Abundance"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_weight</span> <span class="op">/</span> <span class="va">plot_count</span> <span class="op">+</span> <span class="fu">plot_layout</span><span class="op">(</span>heights <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/04-visualization-ggplot2-rendered-patchwork-example-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>You can also use parentheses <code>()</code> to create more complex
layouts. There are many useful examples on the <a href="https://patchwork.data-imaginist.com/" class="external-link">patchwork website</a></p>
</section><section id="exporting-plots"><h2 class="section-heading">Exporting plots<a class="anchor" aria-label="anchor" href="#exporting-plots"></a>
</h2>
<hr class="half-width">
<p>After creating your plot, you can save it to a file in your favorite
format. The Export tab in the <strong>Plot</strong> pane in RStudio will
save your plots at low resolution, which will not be accepted by many
journals and will not scale well for posters. The <a href="https://exts.ggplot2.tidyverse.org/" class="external-link"><strong><code>ggplot2</code></strong>
extensions website</a> provides a list of packages that extend the
capabilities of <strong><code>ggplot2</code></strong>, including
additional themes.</p>
<p>Instead, use the <code>ggsave()</code> function, which allows you to
easily change the dimension and resolution of your plot by adjusting the
appropriate arguments (<code>width</code>, <code>height</code> and
<code>dpi</code>):</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">yearly_sex_counts</span>,</span>
<span>                  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Observed genera through time"</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Year of observation"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Number of individuals"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey20"</span>, size <span class="op">=</span> <span class="fl">12</span>, angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>                                     hjust <span class="op">=</span> <span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey20"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>          text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"name_of_file.png"</span>, <span class="va">my_plot</span>, width <span class="op">=</span> <span class="fl">15</span>, height <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## This also works for plots combined with patchwork</span></span>
<span><span class="va">plot_combined</span> <span class="op">&lt;-</span> <span class="va">plot_weight</span> <span class="op">/</span> <span class="va">plot_count</span> <span class="op">+</span> <span class="fu">plot_layout</span><span class="op">(</span>heights <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"plot_combined.png"</span>, <span class="va">plot_combined</span>, width <span class="op">=</span> <span class="fl">10</span>, dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code></pre>
</div>
<p>Note: The parameters <code>width</code> and <code>height</code> also
determine the font size in the saved plot.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>start simple and build your plots iteratively</li>
<li>the <code>ggplot()</code> function initiates a plot, and
<code>geom_</code> functions add representations of your data</li>
<li>use <code>aes()</code> when mapping a variable from the data to a
part of the plot</li>
<li>use <code>facet_</code> to partition a plot into multiple plots
based on a factor included in the dataset</li>
<li>use premade <code>theme_</code> functions to broadly change
appearance, and the <code>theme()</code> function to fine-tune</li>
<li>the <code>patchwork</code> library can combine separate plots into a
single figure</li>
<li>use <code>ggsave()</code> to save plots in your favorite format and
dimensions</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-05-r-and-databases"><p>Content from <a href="05-r-and-databases.html">SQL databases and R</a></p>
<hr>
<p>Last updated on 2024-01-31 |
        
        <a href="https://github.com/datacarpentry/R-ecology-lesson/edit/main/episodes/05-r-and-databases.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<hr>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I connect and get data from a database in R?</li>
<li>How can I retrieve data from multiple database tables?</li>
<li>How can I create an SQLite database?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Access a database from R.</li>
<li>Run SQL queries in R using <strong><code>RSQLite</code></strong> and
<strong><code>dplyr</code></strong>.</li>
<li>Describe the lazy behavior of dplyr on data stored in a database
outside of R.</li>
<li>Prototype queries and retrieve all final results.</li>
<li>Create complex queries across one or multiple database tables.</li>
<li>Create an SQLite database from existing .csv files.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<hr>
<section id="introduction"><h2 class="section-heading">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>So far, we have dealt with small datasets that easily fit into your
computer’s memory. But what about datasets that are too large for your
computer to handle as a whole? In this case, storing the data outside of
R and organizing it in a database is helpful. Connecting to the database
allows you to retrieve only the chunks needed for the current
analysis.</p>
<p>Even better, many large datasets are already available in public or
private databases. You can query them without having to download the
data first.</p>
<p>R can connect to almost any existing database type. Most common
database types have R packages that allow you to connect to them (e.g.,
<strong><code>RSQLite</code></strong>, RMySQL, etc). Furthermore, the <a href="https://cran.r-project.org/web/packages/dplyr/index.html" class="external-link"><strong><code>dplyr</code></strong></a>
package you used in the previous chapter, in conjunction with <a href="https://cran.r-project.org/package=dbplyr" class="external-link"><strong><code>dbplyr</code></strong></a>
supports connecting to the widely-used open source databases <a href="https://sqlite.org/" class="external-link">sqlite</a>, <a href="https://www.mysql.com/" class="external-link">mysql</a> and <a href="https://www.postgresql.org/" class="external-link">postgresql</a>, as well as Google’s
<a href="https://cloud.google.com/bigquery/" class="external-link">bigquery</a>, and it can
also be extended to other database types (a <a href="https://cran.r-project.org/web/packages/dbplyr/vignettes/new-backend.html" class="external-link">vignette</a>
in the <strong><code>dplyr</code></strong> package explains how to do
it). RStudio has created <a href="https://db.rstudio.com/" class="external-link">a website</a>
that provides documentation and best practices to work on database
interfaces.</p>
<p>Interfacing with databases using <strong><code>dplyr</code></strong>
focuses on retrieving and analyzing datasets by generating
<code>SELECT</code> SQL statements, but it doesn’t modify the database
itself. <strong><code>dplyr</code></strong> does not offer functions to
<code>UPDATE</code> or <code>DELETE</code> entries. If you need these
functionalities, you will need to use additional R packages (e.g.,
<strong><code>RSQLite</code></strong>). Here we will demonstrate how to
interact with a database using <strong><code>dplyr</code></strong>,
using both the <strong><code>dplyr</code></strong>’s verb syntax and the
SQL syntax.</p>
<div class="section level3">
<h3 id="the-portal_mammals-database">The portal_mammals database<a class="anchor" aria-label="anchor" href="#the-portal_mammals-database"></a>
</h3>
<p>We will continue to explore the <code>surveys</code> data you are
already familiar with from previous lessons. First, we are going to
install the <strong><code>dbplyr</code></strong> package:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"dbplyr"</span>, <span class="st">"RSQLite"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>The SQLite database is contained in a single file
<code>portal_mammals.sqlite</code> that you generated during <a href="https://datacarpentry.org/sql-ecology-lesson/00-sql-introduction/index.html" class="external-link">the
SQL lesson</a>. If you don’t have it, you can download it from Figshare
into the <code>data_raw</code> subdirectory using:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dir.create</span><span class="op">(</span><span class="st">"data_raw"</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">download.file</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://ndownloader.figshare.com/files/2292171"</span>,</span>
<span>              destfile <span class="op">=</span> <span class="st">"data_raw/portal_mammals.sqlite"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span></code></pre>
</div>
</div>
</section><section id="connecting-to-databases"><h2 class="section-heading">Connecting to databases<a class="anchor" aria-label="anchor" href="#connecting-to-databases"></a>
</h2>
<hr class="half-width">
<p>We can point R to this database using:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dbplyr</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dbplyr'</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; The following objects are masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     ident, sql</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mammals</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu">dbConnect</span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu">SQLite</span><span class="op">(</span><span class="op">)</span>, <span class="st">"data_raw/portal_mammals.sqlite"</span><span class="op">)</span></span></code></pre>
</div>
<p>This command uses 2 packages that helps
<strong><code>dbplyr</code></strong> and
<strong><code>dplyr</code></strong> talk to the SQLite database.
<strong><code>DBI</code></strong> is not something that you’ll use
directly as a user. It allows R to send commands to databases
irrespective of the database management system used. The
<strong><code>RSQLite</code></strong> package allows R to interface with
SQLite databases.</p>
<p>This command does not load the data into the R session (as the
<code>read_csv()</code> function did). Instead, it merely instructs R to
connect to the <code>SQLite</code> database contained in the
<code>portal_mammals.sqlite</code> file.</p>
<p>Using a similar approach, you could connect to many other database
management systems that are supported by R including MySQL, PostgreSQL,
BigQuery, etc.</p>
<p>Let’s take a closer look at the <code>mammals</code> database we just
connected to:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">src_dbi</span><span class="op">(</span><span class="va">mammals</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; src:  sqlite 3.44.2 [/home/runner/work/R-ecology-lesson/R-ecology-lesson/site/built/data_raw/portal_mammals.sqlite]</span></span>
<span><span class="co">#&gt; tbls: plots, species, surveys</span></span></code></pre>
</div>
<p>Just like a spreadsheet with multiple worksheets, a SQLite database
can contain multiple tables. In this case three of them are listed in
the <code>tbls</code> row in the output above:</p>
<ul>
<li>plots</li>
<li>species</li>
<li>surveys</li>
</ul>
<p>Now that we know we can connect to the database, let’s explore how to
get the data from its tables into R.</p>
<div class="section level3">
<h3 id="querying-the-database-with-the-sql-syntax">Querying the database with the SQL syntax<a class="anchor" aria-label="anchor" href="#querying-the-database-with-the-sql-syntax"></a>
</h3>
<p>To connect to tables within a database, you can use the
<code>tbl()</code> function from <strong><code>dplyr</code></strong>.
This function can be used to send SQL queries to the database. To
demonstrate this functionality, let’s select the columns “year”,
“species_id”, and “plot_id” from the <code>surveys</code> table:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tbl</span><span class="op">(</span><span class="va">mammals</span>, <span class="fu">sql</span><span class="op">(</span><span class="st">"SELECT year, species_id, plot_id FROM surveys"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>With this approach you can use any of the SQL queries we have seen in
the database lesson.</p>
</div>
<div class="section level3">
<h3 id="querying-the-database-with-the-dplyr-syntax">Querying the database with the dplyr syntax<a class="anchor" aria-label="anchor" href="#querying-the-database-with-the-dplyr-syntax"></a>
</h3>
<p>One of the strengths of <strong><code>dplyr</code></strong> is that
the same operation can be done using
<strong><code>dplyr</code></strong>’s verbs instead of writing SQL.
First, we select the table on which to do the operations by creating the
<code>surveys</code> object, and then we use the standard
<strong><code>dplyr</code></strong> syntax as if it were a data
frame:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu">tbl</span><span class="op">(</span><span class="va">mammals</span>, <span class="st">"surveys"</span><span class="op">)</span></span>
<span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">species_id</span>, <span class="va">plot_id</span><span class="op">)</span></span></code></pre>
</div>
<p>In this case, the <code>surveys</code> object behaves like a data
frame. Several functions that can be used with data frames can also be
used on tables from a database. For instance, the <code>head()</code>
function can be used to check the first 10 rows of the table:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">surveys</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; # Source:   SQL [10 x 9]</span></span>
<span><span class="co">#&gt; # Database: sqlite 3.44.2 [/home/runner/work/R-ecology-lesson/R-ecology-lesson/site/built/data_raw/portal_mammals.sqlite]</span></span>
<span><span class="co">#&gt;    record_id month   day  year plot_id species_id sex   hindfoot_length weight</span></span>
<span><span class="co">#&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;int&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1         1     7    16  1977       2 NL         M                  32     NA</span></span>
<span><span class="co">#&gt;  2         2     7    16  1977       3 NL         M                  33     NA</span></span>
<span><span class="co">#&gt;  3         3     7    16  1977       2 DM         F                  37     NA</span></span>
<span><span class="co">#&gt;  4         4     7    16  1977       7 DM         M                  36     NA</span></span>
<span><span class="co">#&gt;  5         5     7    16  1977       3 DM         M                  35     NA</span></span>
<span><span class="co">#&gt;  6         6     7    16  1977       1 PF         M                  14     NA</span></span>
<span><span class="co">#&gt;  7         7     7    16  1977       2 PE         F                  NA     NA</span></span>
<span><span class="co">#&gt;  8         8     7    16  1977       1 DM         M                  37     NA</span></span>
<span><span class="co">#&gt;  9         9     7    16  1977       1 DM         F                  34     NA</span></span>
<span><span class="co">#&gt; 10        10     7    16  1977       6 PF         F                  20     NA</span></span></code></pre>
</div>
<p>This output of the <code>head</code> command looks just like a
regular <code>data.frame</code>: The table has 9 columns and the
<code>head()</code> command shows us the first 10 rows. Note that the
columns <code>plot_type</code>, <code>taxa</code>, <code>genus</code>,
and <code>species</code> are missing. These are now located in the
tables <code>plots</code> and <code>species</code> which we will join
together in a moment.</p>
<p>However, some functions don’t work quite as expected. For instance,
let’s check how many rows there are in total using
<code>nrow()</code>:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] NA</span></span></code></pre>
</div>
<p>That’s strange - R doesn’t know how many rows the
<code>surveys</code> table contains - it returns <code>NA</code>
instead. You might have already noticed that the first line of the
<code>head()</code> output included <code>??</code> indicating that the
number of rows wasn’t known.</p>
<p>The reason for this behavior highlights a key difference between
using <strong><code>dplyr</code></strong> on datasets in memory
(e.g. loaded into your R session via <code>read_csv()</code>) and those
provided by a database. To understand it, we take a closer look at how
<strong><code>dplyr</code></strong> communicates with our SQLite
database.</p>
</div>
<div class="section level3">
<h3 id="sql-translation">SQL translation<a class="anchor" aria-label="anchor" href="#sql-translation"></a>
</h3>
<p>Relational databases typically use a special-purpose language, <a href="https://en.wikipedia.org/wiki/SQL" class="external-link">Structured Query Language
(SQL)</a>, to manage and query data.</p>
<p>For example, the following SQL query returns the first 10 rows from
the <code>surveys</code> table:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> `surveys`</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">10</span></span></code></pre>
</div>
<p>Behind the scenes, <strong><code>dplyr</code></strong>:</p>
<ol style="list-style-type: decimal">
<li>translates your R code into SQL</li>
<li>submits it to the database</li>
<li>translates the database’s response into an R data frame</li>
</ol>
<p>To lift the curtain, we can use <strong><code>dplyr</code></strong>’s
<code>show_query()</code> function to show which SQL commands are
actually sent to the database:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show_query</span><span class="op">(</span><span class="fu">head</span><span class="op">(</span><span class="va">surveys</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>The output shows the actual SQL query sent to the database; it
matches our manually constructed <code>SELECT</code> statement
above.</p>
<p>Instead of having to formulate the SQL query ourselves - and having
to mentally switch back and forth between R and SQL syntax - we can
delegate this translation to <strong><code>dplyr</code></strong>. (You
don’t even need to know SQL to interact with a database via
<strong><code>dplyr</code></strong>!)</p>
<p><strong><code>dplyr</code></strong>, in turn, doesn’t do the real
work of subsetting the table, either. Instead, it merely sends the query
to the database, waits for its response and returns it to us.</p>
<p>That way, R never gets to see the full <code>surveys</code> table -
and that’s why it could not tell us how many rows it contains. On the
bright side, this allows us to work with large datasets - even too large
to fit into our computer’s memory.</p>
<p><strong><code>dplyr</code></strong> can translate many different
query types into SQL allowing us to, e.g., <code>select()</code>
specific columns, <code>filter()</code> rows, or join tables.</p>
<p>To see this in action, let’s compose a few queries with
<strong><code>dplyr</code></strong>.</p>
</div>
</section><section id="simple-database-queries"><h2 class="section-heading">Simple database queries<a class="anchor" aria-label="anchor" href="#simple-database-queries"></a>
</h2>
<hr class="half-width">
<p>First, let’s only request rows of the <code>surveys</code> table in
which <code>weight</code> is less than 5 and keep only the species_id,
sex, and weight columns.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">weight</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span>, <span class="va">weight</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; # Source:   SQL [?? x 3]</span></span>
<span><span class="co">#&gt; # Database: sqlite 3.44.2 [/home/runner/work/R-ecology-lesson/R-ecology-lesson/site/built/data_raw/portal_mammals.sqlite]</span></span>
<span><span class="co">#&gt;    species_id sex   weight</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 PF         M          4</span></span>
<span><span class="co">#&gt;  2 PF         F          4</span></span>
<span><span class="co">#&gt;  3 PF         &lt;NA&gt;       4</span></span>
<span><span class="co">#&gt;  4 PF         F          4</span></span>
<span><span class="co">#&gt;  5 PF         F          4</span></span>
<span><span class="co">#&gt;  6 RM         M          4</span></span>
<span><span class="co">#&gt;  7 RM         F          4</span></span>
<span><span class="co">#&gt;  8 RM         M          4</span></span>
<span><span class="co">#&gt;  9 RM         M          4</span></span>
<span><span class="co">#&gt; 10 RM         M          4</span></span>
<span><span class="co">#&gt; # ℹ more rows</span></span></code></pre>
</div>
<p>Executing this command will return a table with 10 rows and the
requested <code>species_id</code>, <code>sex</code> and
<code>weight</code> columns. Great!</p>
<p>… but wait, why are there only 10 rows?</p>
<p>The last line:</p>
<pre><code><span><span class="co"># ... with more rows</span></span></code></pre>
<p>indicates that there are more results that fit our filtering
criterion. Why was R lazy and only retrieved 10 of them?</p>
</section><section id="laziness"><h2 class="section-heading">Laziness<a class="anchor" aria-label="anchor" href="#laziness"></a>
</h2>
<hr class="half-width">
<p>Hadley Wickham, the author of <strong><code>dplyr</code></strong> <a href="https://cran.r-project.org/web/packages/dbplyr/vignettes/dbplyr.html" class="external-link">explains</a>:</p>
<div class="blockquote">
<p>When working with databases, <strong><code>dplyr</code></strong>
tries to be as lazy as possible:</p>
<ul>
<li>It never pulls data into R unless you explicitly ask for it.</li>
<li>It delays doing any work until the last possible moment - it
collects together everything you want to do and then sends it to the
database in one step.</li>
</ul>
</div>
<p>When you construct a <strong><code>dplyr</code></strong> query, you
can connect multiple verbs into a single pipeline. For example, we
combined the <code>filter()</code> and <code>select()</code> verbs using
the <code>%&gt;%</code> pipe.</p>
<p>If we wanted to, we could add on even more steps, e.g. remove the
<code>sex</code> column in an additional <code>select</code> call:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_subset</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">weight</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span>, <span class="va">weight</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_subset</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; # Source:   SQL [?? x 2]</span></span>
<span><span class="co">#&gt; # Database: sqlite 3.44.2 [/home/runner/work/R-ecology-lesson/R-ecology-lesson/site/built/data_raw/portal_mammals.sqlite]</span></span>
<span><span class="co">#&gt;    species_id weight</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 PF              4</span></span>
<span><span class="co">#&gt;  2 PF              4</span></span>
<span><span class="co">#&gt;  3 PF              4</span></span>
<span><span class="co">#&gt;  4 PF              4</span></span>
<span><span class="co">#&gt;  5 PF              4</span></span>
<span><span class="co">#&gt;  6 RM              4</span></span>
<span><span class="co">#&gt;  7 RM              4</span></span>
<span><span class="co">#&gt;  8 RM              4</span></span>
<span><span class="co">#&gt;  9 RM              4</span></span>
<span><span class="co">#&gt; 10 RM              4</span></span>
<span><span class="co">#&gt; # ℹ more rows</span></span></code></pre>
</div>
<p>Just like the first <code>select(species_id, sex, weight)</code>
call, the <code>select(-sex)</code> command is not executed by R. It is
sent to the database instead. Only the <em>final</em> result is
retrieved and displayed to you.</p>
<p>Of course, we could always add on more steps, e.g., we could filter
by <code>species_id</code> or minimum <code>weight</code>. That’s why R
doesn’t retrieve the full set of results - instead it only retrieves the
first 10 results from the database by default. (After all, you might
want to add an additional step and get the database to do more
work…)</p>
<p>To instruct R to stop being lazy, e.g. to retrieve all of the query
results from the database, we add the <code>collect()</code> command to
our pipe. It indicates that our database query is finished: time to get
the <em>final</em> results and load them into the R session.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_subset</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">weight</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span>, <span class="va">weight</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we have all 17 rows that match our query in a
<code>data.frame</code> and can continue to work with them exclusively
in R, without communicating with the database.</p>
</section><section id="complex-database-queries"><h2 class="section-heading">Complex database queries<a class="anchor" aria-label="anchor" href="#complex-database-queries"></a>
</h2>
<hr class="half-width">
<p><strong><code>dplyr</code></strong> enables database queries across
one or multiple database tables, using the same single- and
multiple-table verbs you encountered previously. This means you can use
the same commands regardless of whether you interact with a remote
database or local dataset! This is a really useful feature if you work
with large datasets: you can first prototype your code on a small subset
that fits into memory, and when your code is ready, you can change the
input dataset to your full database without having to change the
syntax.</p>
<p>On the other hand, being able to use SQL queries directly can be
useful if your collaborators have already put together complex queries
to prepare the dataset that you need for your analysis.</p>
<p>To illustrate how to use <strong><code>dplyr</code></strong> with
these complex queries, we are going to join the <code>plots</code> and
<code>surveys</code> tables. The <code>plots</code> table in the
database contains information about the different plots surveyed by the
researchers. To access it, we point the <code>tbl()</code> command to
it:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu">tbl</span><span class="op">(</span><span class="va">mammals</span>, <span class="st">"plots"</span><span class="op">)</span></span>
<span><span class="va">plots</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; # Source:   table&lt;plots&gt; [?? x 2]</span></span>
<span><span class="co">#&gt; # Database: sqlite 3.44.2 [/home/runner/work/R-ecology-lesson/R-ecology-lesson/site/built/data_raw/portal_mammals.sqlite]</span></span>
<span><span class="co">#&gt;    plot_id plot_type                </span></span>
<span><span class="co">#&gt;      &lt;int&gt; &lt;chr&gt;                    </span></span>
<span><span class="co">#&gt;  1       1 Spectab exclosure        </span></span>
<span><span class="co">#&gt;  2       2 Control                  </span></span>
<span><span class="co">#&gt;  3       3 Long-term Krat Exclosure </span></span>
<span><span class="co">#&gt;  4       4 Control                  </span></span>
<span><span class="co">#&gt;  5       5 Rodent Exclosure         </span></span>
<span><span class="co">#&gt;  6       6 Short-term Krat Exclosure</span></span>
<span><span class="co">#&gt;  7       7 Rodent Exclosure         </span></span>
<span><span class="co">#&gt;  8       8 Control                  </span></span>
<span><span class="co">#&gt;  9       9 Spectab exclosure        </span></span>
<span><span class="co">#&gt; 10      10 Rodent Exclosure         </span></span>
<span><span class="co">#&gt; # ℹ more rows</span></span></code></pre>
</div>
<p>The <code>plot_id</code> column also features in the
<code>surveys</code> table:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; # Source:   table&lt;surveys&gt; [?? x 9]</span></span>
<span><span class="co">#&gt; # Database: sqlite 3.44.2 [/home/runner/work/R-ecology-lesson/R-ecology-lesson/site/built/data_raw/portal_mammals.sqlite]</span></span>
<span><span class="co">#&gt;    record_id month   day  year plot_id species_id sex   hindfoot_length weight</span></span>
<span><span class="co">#&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;int&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1         1     7    16  1977       2 NL         M                  32     NA</span></span>
<span><span class="co">#&gt;  2         2     7    16  1977       3 NL         M                  33     NA</span></span>
<span><span class="co">#&gt;  3         3     7    16  1977       2 DM         F                  37     NA</span></span>
<span><span class="co">#&gt;  4         4     7    16  1977       7 DM         M                  36     NA</span></span>
<span><span class="co">#&gt;  5         5     7    16  1977       3 DM         M                  35     NA</span></span>
<span><span class="co">#&gt;  6         6     7    16  1977       1 PF         M                  14     NA</span></span>
<span><span class="co">#&gt;  7         7     7    16  1977       2 PE         F                  NA     NA</span></span>
<span><span class="co">#&gt;  8         8     7    16  1977       1 DM         M                  37     NA</span></span>
<span><span class="co">#&gt;  9         9     7    16  1977       1 DM         F                  34     NA</span></span>
<span><span class="co">#&gt; 10        10     7    16  1977       6 PF         F                  20     NA</span></span>
<span><span class="co">#&gt; # ℹ more rows</span></span></code></pre>
</div>
<p>Because <code>plot_id</code> is listed in both tables, we can use it
to look up matching records, and join the two tables.</p>
<p>If we have two tables named x and y with a common column called “ID”,
we can join them using ‘join’ functions, two of which are described and
illustrated below.</p>
<ol style="list-style-type: decimal">
<li><p>inner_join() : This returns all rows from x where there are
matching values in y, and all columns from x and y.</p></li>
<li><p>left_join() : This return all rows from x, and all columns from x
and y. Rows in x with no match in y will have NA values in the new
columns.</p></li>
</ol>
<p>In both forms of join, if there are multiple matches between x and y,
all combinations of the matches are returned. For the full list of
‘join’ functions, check out the <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">tidyverse
join page.</a></p>
<p>In our example, the two tables we want to join are ‘plots’ and
‘surveys’.</p>
<figure><img src=".././fig/joins.svg" alt="diagram illustrating inner and left joins" class="figure mx-auto d-block"></figure><p>For example, to extract all surveys for the first plot, which has
<code>plot_id</code> 1, we can do:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">plot_id</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; Joining with `by = join_by(plot_id)`</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; # A tibble: 1,995 × 10</span></span>
<span><span class="co">#&gt;    plot_id plot_type         record_id month   day  year species_id sex  </span></span>
<span><span class="co">#&gt;      &lt;int&gt; &lt;chr&gt;                 &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1       1 Spectab exclosure         6     7    16  1977 PF         M    </span></span>
<span><span class="co">#&gt;  2       1 Spectab exclosure         8     7    16  1977 DM         M    </span></span>
<span><span class="co">#&gt;  3       1 Spectab exclosure         9     7    16  1977 DM         F    </span></span>
<span><span class="co">#&gt;  4       1 Spectab exclosure        78     8    19  1977 PF         M    </span></span>
<span><span class="co">#&gt;  5       1 Spectab exclosure        80     8    19  1977 DS         M    </span></span>
<span><span class="co">#&gt;  6       1 Spectab exclosure       218     9    13  1977 PF         M    </span></span>
<span><span class="co">#&gt;  7       1 Spectab exclosure       222     9    13  1977 DS         M    </span></span>
<span><span class="co">#&gt;  8       1 Spectab exclosure       239     9    13  1977 DS         M    </span></span>
<span><span class="co">#&gt;  9       1 Spectab exclosure       263    10    16  1977 DM         M    </span></span>
<span><span class="co">#&gt; 10       1 Spectab exclosure       270    10    16  1977 DM         F    </span></span>
<span><span class="co">#&gt; # ℹ 1,985 more rows</span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: hindfoot_length &lt;int&gt;, weight &lt;int&gt;</span></span></code></pre>
</div>
<p><strong>Important Note:</strong> Without the <code>collect()</code>
statement, only the first 10 matching rows are returned. By adding
<code>collect()</code>, the full set of 1,985 is retrieved.</p>
<div id="challenge" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge"></a>
</h3>
<div class="callout-content">
<p>Write a query that returns the number of rodents observed in each
plot in each year.</p>
<p>Hint: Connect to the species table and write a query that joins the
species and survey tables together to exclude all non-rodents. The query
should return counts of rodents by year.</p>
<p>Optional: Write a query in SQL that will produce the same result. You
can join multiple tables together using the following syntax where
foreign key refers to your unique id (e.g.,
<code>species_id</code>):</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">table</span>.col, <span class="kw">table</span>.col</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> table1 <span class="kw">JOIN</span> table2</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> table1.<span class="kw">key</span> <span class="op">=</span> table2.<span class="kw">key</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> table3 <span class="kw">ON</span> table2.<span class="kw">key</span> <span class="op">=</span> table3.<span class="kw">key</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## with dplyr syntax</span></span>
<span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu">tbl</span><span class="op">(</span><span class="va">mammals</span>, <span class="st">"species"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">left_join</span><span class="op">(</span><span class="va">surveys</span>, <span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">taxa</span> <span class="op">==</span> <span class="st">"Rodent"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">taxa</span>, <span class="va">year</span>, <span class="va">plot_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; Joining with `by = join_by(species_id)`</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## with SQL syntax</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="fu">paste</span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">SELECT a.year, b.taxa,count(*) as count</span></span>
<span><span class="st">FROM surveys a</span></span>
<span><span class="st">JOIN species b</span></span>
<span><span class="st">ON a.species_id = b.species_id</span></span>
<span><span class="st">AND b.taxa = 'Rodent'</span></span>
<span><span class="st">GROUP BY b.taxa, a.year, a.plot_id"</span>,</span>
<span>sep <span class="op">=</span> <span class="st">""</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu">tbl</span><span class="op">(</span><span class="va">mammals</span>, <span class="fu">sql</span><span class="op">(</span><span class="va">query</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>Write a query that returns the total number of rodents in each genus
caught in the different plot types.</p>
<p>Hint: Write a query that joins the species, plot, and survey tables
together. The query should return counts of genus by plot type.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu">tbl</span><span class="op">(</span><span class="va">mammals</span>, <span class="st">"species"</span><span class="op">)</span></span>
<span><span class="va">genus_counts</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">surveys</span>, <span class="va">plots</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">taxa</span> <span class="op">==</span> <span class="st">"Rodent"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">plot_type</span>, <span class="va">genus</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>This is useful if we are interested in estimating the number of
individuals belonging to each genus found in each plot type. But what if
we were interested in the number of genera found in each plot type?
Using <code>tally()</code> gives the number of individuals, instead we
need to use <code>n_distinct()</code> to count the number of unique
values found in a column.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu">tbl</span><span class="op">(</span><span class="va">mammals</span>, <span class="st">"species"</span><span class="op">)</span></span>
<span><span class="va">unique_genera</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">surveys</span>, <span class="va">plots</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">left_join</span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">plot_type</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span></span>
<span>        n_genera <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">genus</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; Joining with `by = join_by(plot_id)`</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(species_id)`</span></span></code></pre>
</div>
<p><code>n_distinct</code>, like the other
<strong><code>dplyr</code></strong> functions we have used in this
lesson, works not only on database connections but also on regular data
frames.</p>
</section><section id="creating-a-new-sqlite-database"><h2 class="section-heading">Creating a new SQLite database<a class="anchor" aria-label="anchor" href="#creating-a-new-sqlite-database"></a>
</h2>
<hr class="half-width">
<p>So far, we have used a previously prepared SQLite database. But we
can also use R to create a new database, e.g. from existing
<code>csv</code> files. Let’s recreate the mammals database that we’ve
been working with, in R. First let’s download and read in the
<code>csv</code> files. We’ll import
<strong><code>tidyverse</code></strong> to gain access to the
<code>read_csv()</code> function.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">download.file</span><span class="op">(</span><span class="st">"https://ndownloader.figshare.com/files/3299483"</span>,</span>
<span>              <span class="st">"data_raw/species.csv"</span><span class="op">)</span></span>
<span><span class="fu">download.file</span><span class="op">(</span><span class="st">"https://ndownloader.figshare.com/files/10717177"</span>,</span>
<span>              <span class="st">"data_raw/surveys.csv"</span><span class="op">)</span></span>
<span><span class="fu">download.file</span><span class="op">(</span><span class="st">"https://ndownloader.figshare.com/files/3299474"</span>,</span>
<span>              <span class="st">"data_raw/plots.csv"</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data_raw/species.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; Rows: 54 Columns: 4</span></span>
<span><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Delimiter: ","</span></span>
<span><span class="co">#&gt; chr (4): species_id, genus, species, taxa</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data_raw/surveys.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; Rows: 35549 Columns: 9</span></span>
<span><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Delimiter: ","</span></span>
<span><span class="co">#&gt; chr (2): species_id, sex</span></span>
<span><span class="co">#&gt; dbl (7): record_id, month, day, year, plot_id, hindfoot_length, weight</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data_raw/plots.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; Rows: 24 Columns: 2</span></span>
<span><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Delimiter: ","</span></span>
<span><span class="co">#&gt; chr (1): plot_type</span></span>
<span><span class="co">#&gt; dbl (1): plot_id</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
</div>
<p>Also, you can create new SQLite database with
<strong><code>dplyr</code></strong> by adding an argument to the same
command we used above to open an existing <code>.sqlite</code> file. The
<code>create = TRUE</code> argument instructs R to create a new, empty
database instead.</p>
<p><strong>Caution:</strong> When <code>create = TRUE</code> is added,
any existing database at the same location is overwritten <em>without
warning</em>.</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_db_file</span> <span class="op">&lt;-</span> <span class="st">"data/portal-database-output.sqlite"</span></span>
<span><span class="va">my_db</span> <span class="op">&lt;-</span> <span class="fu">src_sqlite</span><span class="op">(</span><span class="va">my_db_file</span>, create <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code><span><span class="co">#&gt; Warning: `src_sqlite()` was deprecated in dplyr 1.0.0.</span></span>
<span><span class="co">#&gt; ℹ Please use `tbl()` directly with a database connection</span></span>
<span><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span>
<span><span class="co">#&gt; generated.</span></span></code></pre>
</div>
<p>Currently, our new database is empty, it doesn’t contain any
tables:</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_db</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; src:  sqlite 3.44.2 [/home/runner/work/R-ecology-lesson/R-ecology-lesson/site/built/data/portal-database-output.sqlite]</span></span>
<span><span class="co">#&gt; tbls:</span></span></code></pre>
</div>
<p>To add tables, we copy the existing data.frames into the database one
by one:</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">copy_to</span><span class="op">(</span><span class="va">my_db</span>, <span class="va">surveys</span><span class="op">)</span></span>
<span><span class="fu">copy_to</span><span class="op">(</span><span class="va">my_db</span>, <span class="va">plots</span><span class="op">)</span></span>
<span><span class="va">my_db</span></span></code></pre>
</div>
<p>If you check the location of our database you’ll see that data is
automatically being written to disk. R and
<strong><code>dplyr</code></strong> not only provide ways to query
existing databases, they also provide functionality to create your own
databases from flat files!</p>
<div id="challenge-2" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<p>Add the remaining species table to the <code>my_db</code> database
and run some of your queries from earlier in the lesson to verify that
you have faithfully recreated the mammals database.</p>
</div>
</div>
</div>
<p><strong>Note:</strong> In this example, we first loaded all of the
data into the R session by reading the three <code>csv</code> files.
Because all the data has to flow through R, this is not suitable for
very large datasets.</p>
<p><strong>Note:</strong> Finally, to close the connection to the
mammals database you may use <code>DBI::dbDisconnect(mammals)</code>;
this discards all pending work and frees resources, e.g. memory.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>
<code>tbl</code> connects to a database and can send SQL
queries.</li>
<li>use <code>dplyr</code> syntax to extract information from SQL
tables.</li>
<li>
<code>dplyr</code> laziness only pulls the needed information,
speeding up data retrieval.</li>
<li>use <code>src_sqlite()</code> to create a new empty SQLite database
and <code>copy_to()</code> to add data to it.</li>
</ul>
</div>
</div>
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/datacarpentry/R-ecology-lesson/edit/main/README.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/datacarpentry/R-ecology-lesson/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/datacarpentry/R-ecology-lesson/" class="external-link">Source</a></p>
				<p><a href="https://github.com/datacarpentry/R-ecology-lesson/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:curriculum@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.2" class="external-link">sandpaper (0.16.2)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.3" class="external-link">pegboard (0.7.3)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.1" class="external-link">varnish (1.0.1)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://datacarpentry.github.io/R-ecology-lesson/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://datacarpentry.github.io/R-ecology-lesson/instructor/aio.html",
  "identifier": "https://datacarpentry.github.io/R-ecology-lesson/instructor/aio.html",
  "dateCreated": "2015-04-02",
  "dateModified": "2024-02-13",
  "datePublished": "2024-02-13"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

