<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Data Analysis and Visualisation in R for Ecologists: SQL databases and R</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav data"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Data Carpentry" src="assets/images/data-logo.svg"></div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/05-r-and-databases.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="assets/images/data-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Data Analysis and Visualisation in R for Ecologists
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Data Analysis and Visualisation in R for Ecologists
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Learners' Reference</a></li>
          </ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Data Analysis and Visualisation in R for Ecologists
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 83%" class="percentage">
    83%
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: 83%" aria-valuenow="83" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/05-r-and-databases.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Data Analysis and Visualization in R for Ecologists</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="00-before-we-start.html">1. Before we start</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="01-intro-to-r.html">2. Introduction to R</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="02-starting-with-data.html">3. Starting with data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="03-dplyr.html">4. Manipulating, analyzing and exporting data with tidyverse</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="04-visualization-ggplot2.html">5. Data visualization with ggplot2</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        6. SQL databases and R
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#introduction">Introduction</a></li>
<li><a href="#connecting-to-databases">Connecting to databases</a></li>
<li><a href="#simple-database-queries">Simple database queries</a></li>
<li><a href="#laziness">Laziness</a></li>
<li><a href="#complex-database-queries">Complex database queries</a></li>
<li><a href="#creating-a-new-sqlite-database">Creating a new SQLite database</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Learners' Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="04-visualization-ggplot2.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="04-visualization-ggplot2.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Data visualization
        </a>
        <a class="chapter-link float-end" href="index.html" rel="next">
          Next: Data Analysis and... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>SQL databases and R</h1>
        <p>Last updated on 2023-11-21 |
        
        <a href="https://github.com/datacarpentry/R-ecology-lesson/edit/main/episodes/05-r-and-databases.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<hr><div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can I connect and get data from a database in R?</li>
<li>How can I retrieve data from multiple database tables?</li>
<li>How can I create an SQLite database?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Access a database from R.</li>
<li>Run SQL queries in R using <strong><code>RSQLite</code></strong> and
<strong><code>dplyr</code></strong>.</li>
<li>Describe the lazy behavior of dplyr on data stored in a database
outside of R.</li>
<li>Prototype queries and retrieve all final results.</li>
<li>Create complex queries across one or multiple database tables.</li>
<li>Create an SQLite database from existing .csv files.</li>
</ul></div>
</div>
</div>
</div>
</div>
<hr><section id="introduction"><h2 class="section-heading">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width"><p>So far, we have dealt with small datasets that easily fit into your
computer’s memory. But what about datasets that are too large for your
computer to handle as a whole? In this case, storing the data outside of
R and organizing it in a database is helpful. Connecting to the database
allows you to retrieve only the chunks needed for the current
analysis.</p>
<p>Even better, many large datasets are already available in public or
private databases. You can query them without having to download the
data first.</p>
<p>R can connect to almost any existing database type. Most common
database types have R packages that allow you to connect to them (e.g.,
<strong><code>RSQLite</code></strong>, RMySQL, etc). Furthermore, the <a href="https://cran.r-project.org/web/packages/dplyr/index.html" class="external-link"><strong><code>dplyr</code></strong></a>
package you used in the previous chapter, in conjunction with <a href="https://cran.r-project.org/package=dbplyr" class="external-link"><strong><code>dbplyr</code></strong></a>
supports connecting to the widely-used open source databases <a href="https://sqlite.org/" class="external-link">sqlite</a>, <a href="https://www.mysql.com/" class="external-link">mysql</a> and <a href="https://www.postgresql.org/" class="external-link">postgresql</a>, as well as Google’s
<a href="https://cloud.google.com/bigquery/" class="external-link">bigquery</a>, and it can
also be extended to other database types (a <a href="https://cran.r-project.org/web/packages/dbplyr/vignettes/new-backend.html" class="external-link">vignette</a>
in the <strong><code>dplyr</code></strong> package explains how to do
it). RStudio has created <a href="https://db.rstudio.com/" class="external-link">a website</a>
that provides documentation and best practices to work on database
interfaces.</p>
<p>Interfacing with databases using <strong><code>dplyr</code></strong>
focuses on retrieving and analyzing datasets by generating
<code>SELECT</code> SQL statements, but it doesn’t modify the database
itself. <strong><code>dplyr</code></strong> does not offer functions to
<code>UPDATE</code> or <code>DELETE</code> entries. If you need these
functionalities, you will need to use additional R packages (e.g.,
<strong><code>RSQLite</code></strong>). Here we will demonstrate how to
interact with a database using <strong><code>dplyr</code></strong>,
using both the <strong><code>dplyr</code></strong>’s verb syntax and the
SQL syntax.</p>
<div class="section level3">
<h3 id="the-portal_mammals-database">The portal_mammals database<a class="anchor" aria-label="anchor" href="#the-portal_mammals-database"></a></h3>
<p>We will continue to explore the <code>surveys</code> data you are
already familiar with from previous lessons. First, we are going to
install the <strong><code>dbplyr</code></strong> package:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"dbplyr"</span>, <span class="st">"RSQLite"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>The SQLite database is contained in a single file
<code>portal_mammals.sqlite</code> that you generated during <a href="https://datacarpentry.org/sql-ecology-lesson/00-sql-introduction/index.html" class="external-link">the
SQL lesson</a>. If you don’t have it, you can download it from Figshare
into the <code>data_raw</code> subdirectory using:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dir.create</span><span class="op">(</span><span class="st">"data_raw"</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">download.file</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://ndownloader.figshare.com/files/2292171"</span>,</span>
<span>              destfile <span class="op">=</span> <span class="st">"data_raw/portal_mammals.sqlite"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span></code></pre>
</div>
</div>
</section><section id="connecting-to-databases"><h2 class="section-heading">Connecting to databases<a class="anchor" aria-label="anchor" href="#connecting-to-databases"></a>
</h2>
<hr class="half-width"><p>We can point R to this database using:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dbplyr</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dbplyr'</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; The following objects are masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     ident, sql</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mammals</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu">dbConnect</span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu">SQLite</span><span class="op">(</span><span class="op">)</span>, <span class="st">"data_raw/portal_mammals.sqlite"</span><span class="op">)</span></span></code></pre>
</div>
<p>This command uses 2 packages that helps
<strong><code>dbplyr</code></strong> and
<strong><code>dplyr</code></strong> talk to the SQLite database.
<strong><code>DBI</code></strong> is not something that you’ll use
directly as a user. It allows R to send commands to databases
irrespective of the database management system used. The
<strong><code>RSQLite</code></strong> package allows R to interface with
SQLite databases.</p>
<p>This command does not load the data into the R session (as the
<code>read_csv()</code> function did). Instead, it merely instructs R to
connect to the <code>SQLite</code> database contained in the
<code>portal_mammals.sqlite</code> file.</p>
<p>Using a similar approach, you could connect to many other database
management systems that are supported by R including MySQL, PostgreSQL,
BigQuery, etc.</p>
<p>Let’s take a closer look at the <code>mammals</code> database we just
connected to:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">src_dbi</span><span class="op">(</span><span class="va">mammals</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; src:  sqlite 3.41.2 [/home/runner/work/R-ecology-lesson/R-ecology-lesson/site/built/data_raw/portal_mammals.sqlite]</span></span>
<span><span class="co">#&gt; tbls: plots, species, surveys</span></span></code></pre>
</div>
<p>Just like a spreadsheet with multiple worksheets, a SQLite database
can contain multiple tables. In this case three of them are listed in
the <code>tbls</code> row in the output above:</p>
<ul><li>plots</li>
<li>species</li>
<li>surveys</li>
</ul><p>Now that we know we can connect to the database, let’s explore how to
get the data from its tables into R.</p>
<div class="section level3">
<h3 id="querying-the-database-with-the-sql-syntax">Querying the database with the SQL syntax<a class="anchor" aria-label="anchor" href="#querying-the-database-with-the-sql-syntax"></a></h3>
<p>To connect to tables within a database, you can use the
<code>tbl()</code> function from <strong><code>dplyr</code></strong>.
This function can be used to send SQL queries to the database. To
demonstrate this functionality, let’s select the columns “year”,
“species_id”, and “plot_id” from the <code>surveys</code> table:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tbl</span><span class="op">(</span><span class="va">mammals</span>, <span class="fu">sql</span><span class="op">(</span><span class="st">"SELECT year, species_id, plot_id FROM surveys"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>With this approach you can use any of the SQL queries we have seen in
the database lesson.</p>
</div>
<div class="section level3">
<h3 id="querying-the-database-with-the-dplyr-syntax">Querying the database with the dplyr syntax<a class="anchor" aria-label="anchor" href="#querying-the-database-with-the-dplyr-syntax"></a></h3>
<p>One of the strengths of <strong><code>dplyr</code></strong> is that
the same operation can be done using
<strong><code>dplyr</code></strong>’s verbs instead of writing SQL.
First, we select the table on which to do the operations by creating the
<code>surveys</code> object, and then we use the standard
<strong><code>dplyr</code></strong> syntax as if it were a data
frame:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu">tbl</span><span class="op">(</span><span class="va">mammals</span>, <span class="st">"surveys"</span><span class="op">)</span></span>
<span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">species_id</span>, <span class="va">plot_id</span><span class="op">)</span></span></code></pre>
</div>
<p>In this case, the <code>surveys</code> object behaves like a data
frame. Several functions that can be used with data frames can also be
used on tables from a database. For instance, the <code>head()</code>
function can be used to check the first 10 rows of the table:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">surveys</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; # Source:   SQL [10 x 9]</span></span>
<span><span class="co">#&gt; # Database: sqlite 3.41.2 [/home/runner/work/R-ecology-lesson/R-ecology-lesson/site/built/data_raw/portal_mammals.sqlite]</span></span>
<span><span class="co">#&gt;    record_id month   day  year plot_id species_id sex   hindfoot_length weight</span></span>
<span><span class="co">#&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;int&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1         1     7    16  1977       2 NL         M                  32     NA</span></span>
<span><span class="co">#&gt;  2         2     7    16  1977       3 NL         M                  33     NA</span></span>
<span><span class="co">#&gt;  3         3     7    16  1977       2 DM         F                  37     NA</span></span>
<span><span class="co">#&gt;  4         4     7    16  1977       7 DM         M                  36     NA</span></span>
<span><span class="co">#&gt;  5         5     7    16  1977       3 DM         M                  35     NA</span></span>
<span><span class="co">#&gt;  6         6     7    16  1977       1 PF         M                  14     NA</span></span>
<span><span class="co">#&gt;  7         7     7    16  1977       2 PE         F                  NA     NA</span></span>
<span><span class="co">#&gt;  8         8     7    16  1977       1 DM         M                  37     NA</span></span>
<span><span class="co">#&gt;  9         9     7    16  1977       1 DM         F                  34     NA</span></span>
<span><span class="co">#&gt; 10        10     7    16  1977       6 PF         F                  20     NA</span></span></code></pre>
</div>
<p>This output of the <code>head</code> command looks just like a
regular <code>data.frame</code>: The table has 9 columns and the
<code>head()</code> command shows us the first 10 rows. Note that the
columns <code>plot_type</code>, <code>taxa</code>, <code>genus</code>,
and <code>species</code> are missing. These are now located in the
tables <code>plots</code> and <code>species</code> which we will join
together in a moment.</p>
<p>However, some functions don’t work quite as expected. For instance,
let’s check how many rows there are in total using
<code>nrow()</code>:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nrow</span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; [1] NA</span></span></code></pre>
</div>
<p>That’s strange - R doesn’t know how many rows the
<code>surveys</code> table contains - it returns <code>NA</code>
instead. You might have already noticed that the first line of the
<code>head()</code> output included <code>??</code> indicating that the
number of rows wasn’t known.</p>
<p>The reason for this behavior highlights a key difference between
using <strong><code>dplyr</code></strong> on datasets in memory
(e.g. loaded into your R session via <code>read_csv()</code>) and those
provided by a database. To understand it, we take a closer look at how
<strong><code>dplyr</code></strong> communicates with our SQLite
database.</p>
</div>
<div class="section level3">
<h3 id="sql-translation">SQL translation<a class="anchor" aria-label="anchor" href="#sql-translation"></a></h3>
<p>Relational databases typically use a special-purpose language, <a href="https://en.wikipedia.org/wiki/SQL" class="external-link">Structured Query Language
(SQL)</a>, to manage and query data.</p>
<p>For example, the following SQL query returns the first 10 rows from
the <code>surveys</code> table:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> `surveys`</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">10</span></span></code></pre>
</div>
<p>Behind the scenes, <strong><code>dplyr</code></strong>:</p>
<ol style="list-style-type: decimal"><li>translates your R code into SQL</li>
<li>submits it to the database</li>
<li>translates the database’s response into an R data frame</li>
</ol><p>To lift the curtain, we can use <strong><code>dplyr</code></strong>’s
<code>show_query()</code> function to show which SQL commands are
actually sent to the database:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show_query</span><span class="op">(</span><span class="fu">head</span><span class="op">(</span><span class="va">surveys</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>The output shows the actual SQL query sent to the database; it
matches our manually constructed <code>SELECT</code> statement
above.</p>
<p>Instead of having to formulate the SQL query ourselves - and having
to mentally switch back and forth between R and SQL syntax - we can
delegate this translation to <strong><code>dplyr</code></strong>. (You
don’t even need to know SQL to interact with a database via
<strong><code>dplyr</code></strong>!)</p>
<p><strong><code>dplyr</code></strong>, in turn, doesn’t do the real
work of subsetting the table, either. Instead, it merely sends the query
to the database, waits for its response and returns it to us.</p>
<p>That way, R never gets to see the full <code>surveys</code> table -
and that’s why it could not tell us how many rows it contains. On the
bright side, this allows us to work with large datasets - even too large
to fit into our computer’s memory.</p>
<p><strong><code>dplyr</code></strong> can translate many different
query types into SQL allowing us to, e.g., <code>select()</code>
specific columns, <code>filter()</code> rows, or join tables.</p>
<p>To see this in action, let’s compose a few queries with
<strong><code>dplyr</code></strong>.</p>
</div>
</section><section id="simple-database-queries"><h2 class="section-heading">Simple database queries<a class="anchor" aria-label="anchor" href="#simple-database-queries"></a>
</h2>
<hr class="half-width"><p>First, let’s only request rows of the <code>surveys</code> table in
which <code>weight</code> is less than 5 and keep only the species_id,
sex, and weight columns.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">weight</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span>, <span class="va">weight</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; # Source:   SQL [?? x 3]</span></span>
<span><span class="co">#&gt; # Database: sqlite 3.41.2 [/home/runner/work/R-ecology-lesson/R-ecology-lesson/site/built/data_raw/portal_mammals.sqlite]</span></span>
<span><span class="co">#&gt;    species_id sex   weight</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 PF         M          4</span></span>
<span><span class="co">#&gt;  2 PF         F          4</span></span>
<span><span class="co">#&gt;  3 PF         &lt;NA&gt;       4</span></span>
<span><span class="co">#&gt;  4 PF         F          4</span></span>
<span><span class="co">#&gt;  5 PF         F          4</span></span>
<span><span class="co">#&gt;  6 RM         M          4</span></span>
<span><span class="co">#&gt;  7 RM         F          4</span></span>
<span><span class="co">#&gt;  8 RM         M          4</span></span>
<span><span class="co">#&gt;  9 RM         M          4</span></span>
<span><span class="co">#&gt; 10 RM         M          4</span></span>
<span><span class="co">#&gt; # ℹ more rows</span></span></code></pre>
</div>
<p>Executing this command will return a table with 10 rows and the
requested <code>species_id</code>, <code>sex</code> and
<code>weight</code> columns. Great!</p>
<p>… but wait, why are there only 10 rows?</p>
<p>The last line:</p>
<pre><code><span><span class="co"># ... with more rows</span></span></code></pre>
<p>indicates that there are more results that fit our filtering
criterion. Why was R lazy and only retrieved 10 of them?</p>
</section><section id="laziness"><h2 class="section-heading">Laziness<a class="anchor" aria-label="anchor" href="#laziness"></a>
</h2>
<hr class="half-width"><p>Hadley Wickham, the author of <strong><code>dplyr</code></strong> <a href="https://cran.r-project.org/web/packages/dbplyr/vignettes/dbplyr.html" class="external-link">explains</a>:</p>
<div class="blockquote">
<p>When working with databases, <strong><code>dplyr</code></strong>
tries to be as lazy as possible:</p>
<ul><li>It never pulls data into R unless you explicitly ask for it.</li>
<li>It delays doing any work until the last possible moment - it
collects together everything you want to do and then sends it to the
database in one step.</li>
</ul></div>
<p>When you construct a <strong><code>dplyr</code></strong> query, you
can connect multiple verbs into a single pipeline. For example, we
combined the <code>filter()</code> and <code>select()</code> verbs using
the <code>%&gt;%</code> pipe.</p>
<p>If we wanted to, we could add on even more steps, e.g. remove the
<code>sex</code> column in an additional <code>select</code> call:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_subset</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">weight</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span>, <span class="va">weight</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_subset</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; # Source:   SQL [?? x 2]</span></span>
<span><span class="co">#&gt; # Database: sqlite 3.41.2 [/home/runner/work/R-ecology-lesson/R-ecology-lesson/site/built/data_raw/portal_mammals.sqlite]</span></span>
<span><span class="co">#&gt;    species_id weight</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 PF              4</span></span>
<span><span class="co">#&gt;  2 PF              4</span></span>
<span><span class="co">#&gt;  3 PF              4</span></span>
<span><span class="co">#&gt;  4 PF              4</span></span>
<span><span class="co">#&gt;  5 PF              4</span></span>
<span><span class="co">#&gt;  6 RM              4</span></span>
<span><span class="co">#&gt;  7 RM              4</span></span>
<span><span class="co">#&gt;  8 RM              4</span></span>
<span><span class="co">#&gt;  9 RM              4</span></span>
<span><span class="co">#&gt; 10 RM              4</span></span>
<span><span class="co">#&gt; # ℹ more rows</span></span></code></pre>
</div>
<p>Just like the first <code>select(species_id, sex, weight)</code>
call, the <code>select(-sex)</code> command is not executed by R. It is
sent to the database instead. Only the <em>final</em> result is
retrieved and displayed to you.</p>
<p>Of course, we could always add on more steps, e.g., we could filter
by <code>species_id</code> or minimum <code>weight</code>. That’s why R
doesn’t retrieve the full set of results - instead it only retrieves the
first 10 results from the database by default. (After all, you might
want to add an additional step and get the database to do more
work…)</p>
<p>To instruct R to stop being lazy, e.g. to retrieve all of the query
results from the database, we add the <code>collect()</code> command to
our pipe. It indicates that our database query is finished: time to get
the <em>final</em> results and load them into the R session.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_subset</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">weight</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">species_id</span>, <span class="va">sex</span>, <span class="va">weight</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we have all 17 rows that match our query in a
<code>data.frame</code> and can continue to work with them exclusively
in R, without communicating with the database.</p>
</section><section id="complex-database-queries"><h2 class="section-heading">Complex database queries<a class="anchor" aria-label="anchor" href="#complex-database-queries"></a>
</h2>
<hr class="half-width"><p><strong><code>dplyr</code></strong> enables database queries across
one or multiple database tables, using the same single- and
multiple-table verbs you encountered previously. This means you can use
the same commands regardless of whether you interact with a remote
database or local dataset! This is a really useful feature if you work
with large datasets: you can first prototype your code on a small subset
that fits into memory, and when your code is ready, you can change the
input dataset to your full database without having to change the
syntax.</p>
<p>On the other hand, being able to use SQL queries directly can be
useful if your collaborators have already put together complex queries
to prepare the dataset that you need for your analysis.</p>
<p>To illustrate how to use <strong><code>dplyr</code></strong> with
these complex queries, we are going to join the <code>plots</code> and
<code>surveys</code> tables. The <code>plots</code> table in the
database contains information about the different plots surveyed by the
researchers. To access it, we point the <code>tbl()</code> command to
it:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu">tbl</span><span class="op">(</span><span class="va">mammals</span>, <span class="st">"plots"</span><span class="op">)</span></span>
<span><span class="va">plots</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; # Source:   table&lt;plots&gt; [?? x 2]</span></span>
<span><span class="co">#&gt; # Database: sqlite 3.41.2 [/home/runner/work/R-ecology-lesson/R-ecology-lesson/site/built/data_raw/portal_mammals.sqlite]</span></span>
<span><span class="co">#&gt;    plot_id plot_type                </span></span>
<span><span class="co">#&gt;      &lt;int&gt; &lt;chr&gt;                    </span></span>
<span><span class="co">#&gt;  1       1 Spectab exclosure        </span></span>
<span><span class="co">#&gt;  2       2 Control                  </span></span>
<span><span class="co">#&gt;  3       3 Long-term Krat Exclosure </span></span>
<span><span class="co">#&gt;  4       4 Control                  </span></span>
<span><span class="co">#&gt;  5       5 Rodent Exclosure         </span></span>
<span><span class="co">#&gt;  6       6 Short-term Krat Exclosure</span></span>
<span><span class="co">#&gt;  7       7 Rodent Exclosure         </span></span>
<span><span class="co">#&gt;  8       8 Control                  </span></span>
<span><span class="co">#&gt;  9       9 Spectab exclosure        </span></span>
<span><span class="co">#&gt; 10      10 Rodent Exclosure         </span></span>
<span><span class="co">#&gt; # ℹ more rows</span></span></code></pre>
</div>
<p>The <code>plot_id</code> column also features in the
<code>surveys</code> table:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; # Source:   table&lt;surveys&gt; [?? x 9]</span></span>
<span><span class="co">#&gt; # Database: sqlite 3.41.2 [/home/runner/work/R-ecology-lesson/R-ecology-lesson/site/built/data_raw/portal_mammals.sqlite]</span></span>
<span><span class="co">#&gt;    record_id month   day  year plot_id species_id sex   hindfoot_length weight</span></span>
<span><span class="co">#&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;int&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1         1     7    16  1977       2 NL         M                  32     NA</span></span>
<span><span class="co">#&gt;  2         2     7    16  1977       3 NL         M                  33     NA</span></span>
<span><span class="co">#&gt;  3         3     7    16  1977       2 DM         F                  37     NA</span></span>
<span><span class="co">#&gt;  4         4     7    16  1977       7 DM         M                  36     NA</span></span>
<span><span class="co">#&gt;  5         5     7    16  1977       3 DM         M                  35     NA</span></span>
<span><span class="co">#&gt;  6         6     7    16  1977       1 PF         M                  14     NA</span></span>
<span><span class="co">#&gt;  7         7     7    16  1977       2 PE         F                  NA     NA</span></span>
<span><span class="co">#&gt;  8         8     7    16  1977       1 DM         M                  37     NA</span></span>
<span><span class="co">#&gt;  9         9     7    16  1977       1 DM         F                  34     NA</span></span>
<span><span class="co">#&gt; 10        10     7    16  1977       6 PF         F                  20     NA</span></span>
<span><span class="co">#&gt; # ℹ more rows</span></span></code></pre>
</div>
<p>Because <code>plot_id</code> is listed in both tables, we can use it
to look up matching records, and join the two tables.</p>
<p>If we have two tables named x and y with a common column called “ID”,
we can join them using ‘join’ functions, two of which are described and
illustrated below.</p>
<ol style="list-style-type: decimal"><li><p>inner_join() : This returns all rows from x where there are
matching values in y, and all columns from x and y.</p></li>
<li><p>left_join() : This return all rows from x, and all columns from x
and y. Rows in x with no match in y will have NA values in the new
columns.</p></li>
</ol><p>In both forms of join, if there are multiple matches between x and y,
all combinations of the matches are returned. For the full list of
‘join’ functions, check out the <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">tidyverse
join page.</a></p>
<p>In our example, the two tables we want to join are ‘plots’ and
‘surveys’.</p>
<figure><img src="./fig/joins.svg" alt="diagram illustrating inner and left joins" class="figure mx-auto d-block"></figure><p>For example, to extract all surveys for the first plot, which has
<code>plot_id</code> 1, we can do:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">plot_id</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">surveys</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; Joining with `by = join_by(plot_id)`</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; # A tibble: 1,995 × 10</span></span>
<span><span class="co">#&gt;    plot_id plot_type         record_id month   day  year species_id sex  </span></span>
<span><span class="co">#&gt;      &lt;int&gt; &lt;chr&gt;                 &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1       1 Spectab exclosure         6     7    16  1977 PF         M    </span></span>
<span><span class="co">#&gt;  2       1 Spectab exclosure         8     7    16  1977 DM         M    </span></span>
<span><span class="co">#&gt;  3       1 Spectab exclosure         9     7    16  1977 DM         F    </span></span>
<span><span class="co">#&gt;  4       1 Spectab exclosure        78     8    19  1977 PF         M    </span></span>
<span><span class="co">#&gt;  5       1 Spectab exclosure        80     8    19  1977 DS         M    </span></span>
<span><span class="co">#&gt;  6       1 Spectab exclosure       218     9    13  1977 PF         M    </span></span>
<span><span class="co">#&gt;  7       1 Spectab exclosure       222     9    13  1977 DS         M    </span></span>
<span><span class="co">#&gt;  8       1 Spectab exclosure       239     9    13  1977 DS         M    </span></span>
<span><span class="co">#&gt;  9       1 Spectab exclosure       263    10    16  1977 DM         M    </span></span>
<span><span class="co">#&gt; 10       1 Spectab exclosure       270    10    16  1977 DM         F    </span></span>
<span><span class="co">#&gt; # ℹ 1,985 more rows</span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: hindfoot_length &lt;int&gt;, weight &lt;int&gt;</span></span></code></pre>
</div>
<p><strong>Important Note:</strong> Without the <code>collect()</code>
statement, only the first 10 matching rows are returned. By adding
<code>collect()</code>, the full set of 1,985 is retrieved.</p>
<div id="challenge" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge"></a>
</h3>
<div class="callout-content">
<p>Write a query that returns the number of rodents observed in each
plot in each year.</p>
<p>Hint: Connect to the species table and write a query that joins the
species and survey tables together to exclude all non-rodents. The query
should return counts of rodents by year.</p>
<p>Optional: Write a query in SQL that will produce the same result. You
can join multiple tables together using the following syntax where
foreign key refers to your unique id (e.g.,
<code>species_id</code>):</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">SQL<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode sql" tabindex="0"><code class="sourceCode sql"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">table</span>.col, <span class="kw">table</span>.col</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> table1 <span class="kw">JOIN</span> table2</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ON</span> table1.<span class="kw">key</span> <span class="op">=</span> table2.<span class="kw">key</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> table3 <span class="kw">ON</span> table2.<span class="kw">key</span> <span class="op">=</span> table3.<span class="kw">key</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## with dplyr syntax</span></span>
<span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu">tbl</span><span class="op">(</span><span class="va">mammals</span>, <span class="st">"species"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">left_join</span><span class="op">(</span><span class="va">surveys</span>, <span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">taxa</span> <span class="op">==</span> <span class="st">"Rodent"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">taxa</span>, <span class="va">year</span>, <span class="va">plot_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; Joining with `by = join_by(species_id)`</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## with SQL syntax</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="fu">paste</span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">SELECT a.year, b.taxa,count(*) as count</span></span>
<span><span class="st">FROM surveys a</span></span>
<span><span class="st">JOIN species b</span></span>
<span><span class="st">ON a.species_id = b.species_id</span></span>
<span><span class="st">AND b.taxa = 'Rodent'</span></span>
<span><span class="st">GROUP BY b.taxa, a.year, a.plot_id"</span>,</span>
<span>sep <span class="op">=</span> <span class="st">""</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu">tbl</span><span class="op">(</span><span class="va">mammals</span>, <span class="fu">sql</span><span class="op">(</span><span class="va">query</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>Write a query that returns the total number of rodents in each genus
caught in the different plot types.</p>
<p>Hint: Write a query that joins the species, plot, and survey tables
together. The query should return counts of genus by plot type.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu">tbl</span><span class="op">(</span><span class="va">mammals</span>, <span class="st">"species"</span><span class="op">)</span></span>
<span><span class="va">genus_counts</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">surveys</span>, <span class="va">plots</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">taxa</span> <span class="op">==</span> <span class="st">"Rodent"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">plot_type</span>, <span class="va">genus</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>This is useful if we are interested in estimating the number of
individuals belonging to each genus found in each plot type. But what if
we were interested in the number of genera found in each plot type?
Using <code>tally()</code> gives the number of individuals, instead we
need to use <code>n_distinct()</code> to count the number of unique
values found in a column.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu">tbl</span><span class="op">(</span><span class="va">mammals</span>, <span class="st">"species"</span><span class="op">)</span></span>
<span><span class="va">unique_genera</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">surveys</span>, <span class="va">plots</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">left_join</span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">plot_type</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span></span>
<span>        n_genera <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">genus</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; Joining with `by = join_by(plot_id)`</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(species_id)`</span></span></code></pre>
</div>
<p><code>n_distinct</code>, like the other
<strong><code>dplyr</code></strong> functions we have used in this
lesson, works not only on database connections but also on regular data
frames.</p>
</section><section id="creating-a-new-sqlite-database"><h2 class="section-heading">Creating a new SQLite database<a class="anchor" aria-label="anchor" href="#creating-a-new-sqlite-database"></a>
</h2>
<hr class="half-width"><p>So far, we have used a previously prepared SQLite database. But we
can also use R to create a new database, e.g. from existing
<code>csv</code> files. Let’s recreate the mammals database that we’ve
been working with, in R. First let’s download and read in the
<code>csv</code> files. We’ll import
<strong><code>tidyverse</code></strong> to gain access to the
<code>read_csv()</code> function.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">download.file</span><span class="op">(</span><span class="st">"https://ndownloader.figshare.com/files/3299483"</span>,</span>
<span>              <span class="st">"data_raw/species.csv"</span><span class="op">)</span></span>
<span><span class="fu">download.file</span><span class="op">(</span><span class="st">"https://ndownloader.figshare.com/files/10717177"</span>,</span>
<span>              <span class="st">"data_raw/surveys.csv"</span><span class="op">)</span></span>
<span><span class="fu">download.file</span><span class="op">(</span><span class="st">"https://ndownloader.figshare.com/files/3299474"</span>,</span>
<span>              <span class="st">"data_raw/plots.csv"</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data_raw/species.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; Rows: 54 Columns: 4</span></span>
<span><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Delimiter: ","</span></span>
<span><span class="co">#&gt; chr (4): species_id, genus, species, taxa</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data_raw/surveys.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; Rows: 35549 Columns: 9</span></span>
<span><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Delimiter: ","</span></span>
<span><span class="co">#&gt; chr (2): species_id, sex</span></span>
<span><span class="co">#&gt; dbl (7): record_id, month, day, year, plot_id, hindfoot_length, weight</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data_raw/plots.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; Rows: 24 Columns: 2</span></span>
<span><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Delimiter: ","</span></span>
<span><span class="co">#&gt; chr (1): plot_type</span></span>
<span><span class="co">#&gt; dbl (1): plot_id</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
</div>
<p>Also, you can create new SQLite database with
<strong><code>dplyr</code></strong> by adding an argument to the same
command we used above to open an existing <code>.sqlite</code> file. The
<code>create = TRUE</code> argument instructs R to create a new, empty
database instead.</p>
<p><strong>Caution:</strong> When <code>create = TRUE</code> is added,
any existing database at the same location is overwritten <em>without
warning</em>.</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_db_file</span> <span class="op">&lt;-</span> <span class="st">"data/portal-database-output.sqlite"</span></span>
<span><span class="va">my_db</span> <span class="op">&lt;-</span> <span class="fu">src_sqlite</span><span class="op">(</span><span class="va">my_db_file</span>, create <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code><span><span class="co">#&gt; Warning: `src_sqlite()` was deprecated in dplyr 1.0.0.</span></span>
<span><span class="co">#&gt; ℹ Please use `tbl()` directly with a database connection</span></span>
<span><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span>
<span><span class="co">#&gt; generated.</span></span></code></pre>
</div>
<p>Currently, our new database is empty, it doesn’t contain any
tables:</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_db</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#&gt; src:  sqlite 3.41.2 [/home/runner/work/R-ecology-lesson/R-ecology-lesson/site/built/data/portal-database-output.sqlite]</span></span>
<span><span class="co">#&gt; tbls:</span></span></code></pre>
</div>
<p>To add tables, we copy the existing data.frames into the database one
by one:</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">copy_to</span><span class="op">(</span><span class="va">my_db</span>, <span class="va">surveys</span><span class="op">)</span></span>
<span><span class="fu">copy_to</span><span class="op">(</span><span class="va">my_db</span>, <span class="va">plots</span><span class="op">)</span></span>
<span><span class="va">my_db</span></span></code></pre>
</div>
<p>If you check the location of our database you’ll see that data is
automatically being written to disk. R and
<strong><code>dplyr</code></strong> not only provide ways to query
existing databases, they also provide functionality to create your own
databases from flat files!</p>
<div id="challenge-2" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<p>Add the remaining species table to the <code>my_db</code> database
and run some of your queries from earlier in the lesson to verify that
you have faithfully recreated the mammals database.</p>
</div>
</div>
</div>
<p><strong>Note:</strong> In this example, we first loaded all of the
data into the R session by reading the three <code>csv</code> files.
Because all the data has to flow through R, this is not suitable for
very large datasets.</p>
<p><strong>Note:</strong> Finally, to close the connection to the
mammals database you may use <code>DBI::dbDisconnect(mammals)</code>;
this discards all pending work and frees resources, e.g. memory.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>
<code>tbl</code> connects to a database and can send SQL
queries.</li>
<li>use <code>dplyr</code> syntax to extract information from SQL
tables.</li>
<li>
<code>dplyr</code> laziness only pulls the needed information,
speeding up data retrieval.</li>
<li>use <code>src_sqlite()</code> to create a new empty SQLite database
and <code>copy_to()</code> to add data to it.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="04-visualization-ggplot2.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="04-visualization-ggplot2.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Data visualization
        </a>
        <a class="chapter-link float-end" href="index.html" rel="next">
          Next: Data Analysis and... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/datacarpentry/R-ecology-lesson/edit/main/episodes/05-r-and-databases.Rmd" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/datacarpentry/R-ecology-lesson/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/datacarpentry/R-ecology-lesson/" class="external-link">Source</a></p>
				<p><a href="https://github.com/datacarpentry/R-ecology-lesson/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:curriculum@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.2" class="external-link">sandpaper (0.16.2)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.3" class="external-link">pegboard (0.7.3)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.1" class="external-link">varnish (1.0.1)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://datacarpentry.github.io/R-ecology-lesson/05-r-and-databases.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "SQL databases and R",
  "creativeWorkStatus": "active",
  "url": "https://datacarpentry.github.io/R-ecology-lesson/05-r-and-databases.html",
  "identifier": "https://datacarpentry.github.io/R-ecology-lesson/05-r-and-databases.html",
  "dateCreated": "2015-04-02",
  "dateModified": "2023-11-21",
  "datePublished": "2023-12-26"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

